(function(g){var window=this;'use strict';var BrS=function(R){var l=new g.uS("und",new g.TL("Default","und",!0));l.captionTracks=R.captionTracks;return l},HaA=function(R){return new g.$v(function(l,y){var f=R.length,A=[];
if(f)for(var K=function(n,m){f--;A[n]=m;f==0&&l(A)},G=function(n){y(n)},B,H=0;H<R.length;H++)B=R[H],g.JTj(B,g.nX(K,H),G);
else l(A)})},xj=function(R){this.Z=R},IO=function(){xj.apply(this,arguments)},nZS=function(){IO.apply(this,arguments)},mXK=function(){IO.apply(this,arguments)},oZS=function(){IO.apply(this,arguments)},hmU=function(){IO.apply(this,arguments)},clr=function(){IO.apply(this,arguments)},EZr=function(){IO.apply(this,arguments)},W_t=function(){xj.apply(this,arguments)},L_Z=function(){IO.apply(this,arguments)},OaX=function(){IO.apply(this,arguments)},iaO=function(){IO.apply(this,arguments)},PnU=function(){IO.apply(this,
arguments)},ubK=function(){IO.apply(this,arguments)},F_d=function(){IO.apply(this,arguments)},QkK=function(){IO.apply(this,arguments)},$XU=function(){IO.apply(this,arguments)},emU=function(){IO.apply(this,arguments)},baU=function(){IO.apply(this,arguments)},XXS=function(){IO.apply(this,arguments)},Tr5=function(){IO.apply(this,arguments)},dXD=function(){xj.apply(this,arguments)},rlU=function(){IO.apply(this,arguments)},vZD=function(){IO.apply(this,arguments)},zmO=function(){IO.apply(this,arguments)},
wXD=function(){IO.apply(this,arguments)},xXt=function(){IO.apply(this,arguments)},ITX=function(){IO.apply(this,arguments)},NrS=function(){IO.apply(this,arguments)},pXO=function(){IO.apply(this,arguments)},UX8=function(){IO.apply(this,arguments)},SOU=function(){xj.apply(this,arguments)},jkS=function(){xj.apply(this,arguments)},kgK=function(){xj.apply(this,arguments)},DXU=function(){IO.apply(this,arguments)},ZaO=function(){IO.apply(this,arguments)},Jlt=function(){IO.apply(this,arguments)},gZO=function(){IO.apply(this,
arguments)},Vld=function(){IO.apply(this,arguments)},CnZ=function(){IO.apply(this,arguments)},qOZ=function(){IO.apply(this,arguments)},tlU=function(){IO.apply(this,arguments)},YOA=function(){IO.apply(this,arguments)},MlS=function(){IO.apply(this,arguments)},RqU=function(){IO.apply(this,arguments)},l9Z=function(){IO.apply(this,arguments)},yg5=function(){IO.apply(this,arguments)},f9K=function(){IO.apply(this,arguments)},Agt=function(){IO.apply(this,arguments)},Kod=function(){IO.apply(this,arguments)},
GYU=function(){IO.apply(this,arguments)},a9O=function(){IO.apply(this,arguments)},sst=function(){IO.apply(this,arguments)},BJX=function(){IO.apply(this,arguments)},Hrr=function(){IO.apply(this,arguments)},n25=function(){IO.apply(this,arguments)},mgS=function(){IO.apply(this,arguments)},o2r=function(){IO.apply(this,arguments)},hqS=function(){IO.apply(this,arguments)},cgS=function(){IO.apply(this,arguments)},E2d=function(){IO.apply(this,arguments)},WoS=function(){xj.apply(this,arguments)},LoU=function(){IO.apply(this,
arguments)},OrA=function(){IO.apply(this,arguments)},ird=function(){IO.apply(this,arguments)},POX=function(){IO.apply(this,arguments)},u4K=function(){IO.apply(this,arguments)},FoA=function(){IO.apply(this,arguments)},QsU=function(){IO.apply(this,arguments)},$gt=function(){IO.apply(this,arguments)},eqU=function(){IO.apply(this,arguments)},brD=function(){IO.apply(this,arguments)},XbS=function(){IO.apply(this,arguments)},TJK=function(){IO.apply(this,arguments)},dg5=function(){IO.apply(this,arguments)},
rgd=function(){IO.apply(this,arguments)},v2t=function(){IO.apply(this,arguments)},zq5=function(){IO.apply(this,arguments)},wbU=function(){IO.apply(this,arguments)},xg8=function(){IO.apply(this,arguments)},I9U=function(){IO.apply(this,arguments)},NJK=function(){IO.apply(this,arguments)},pbD=function(){IO.apply(this,arguments)},UgU=function(){IO.apply(this,arguments)},Sjd=function(){IO.apply(this,arguments)},js8=function(){IO.apply(this,arguments)},kYr=function(){IO.apply(this,arguments)},Dgt=function(){IO.apply(this,
arguments)},ZrU=function(){IO.apply(this,arguments)},Jg5=function(){IO.apply(this,arguments)},g2r=function(){IO.apply(this,arguments)},VHA=function(){IO.apply(this,arguments)},COr=function(){IO.apply(this,arguments)},qjS=function(){IO.apply(this,arguments)},tHS=function(){IO.apply(this,arguments)},Yj8=function(R){R=R.key||R.id;
if(!R)throw Error("Entity key is missing");return R},MH8=function(){if(Nm)return Nm();
var R={};Nm=g.M1("PersistentEntityStoreDb",{L8:(R.EntityStore={y3:1},R.EntityAssociationStore={y3:2},R),shared:!1,upgrade:function(l,y){y(1)&&g.w4(g.Xv(l,"EntityStore",{keyPath:"key"}),"entityType","entityType");y(2)&&(l=g.Xv(l,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.w4(l,"byParentEntityKey","parentEntityKey"),g.w4(l,"byChildEntityKey","childEntityKey"))},
version:3});return Nm()},RaU=function(R){return g.kR(MH8(),R)},lYS=function(R){return g.kR((0,g.NXS)(),R)},pt=function(R){this.token=R},UL=function(R,l){l=l===void 0?{}:l;
g.JD.call(this,g.p0K[R],Object.assign({},{name:"PESEncoderError",type:R},l));this.type=R;this.level="WARNING";Object.setPrototypeOf(this,UL.prototype)},y_O=function(R){return new UL("WRONG_DATA_TYPE",{Io:R})},fYS=function(R){return R instanceof Error?new UL("UNKNOWN_ENCODE_ERROR",{originalMessage:R.message}):new UL("UNKNOWN_ENCODE_ERROR")},A_O=function(R){return R instanceof Error?new UL("UNKNOWN_DECODE_ERROR",{originalMessage:R.message}):new UL("UNKNOWN_DECODE_ERROR")},KyO=function(R,l){R=R instanceof
UL?R:l(R);
g.Tw(R);throw R;},GZA=function(){},aYA=function(R,l,y){try{return R.L(l,y)}catch(f){KyO(f,fYS)}},sut=function(R){R=(new TextEncoder).encode(R).subarray(0,16);
var l=new Uint8Array(16);l.set(R);return l},Ss=function(R){this.Z=R},HvU=function(R){var l=BCU[R];
if(l)return l;g.dP(new g.JD("Entity model not found.",{entityType:R}))},nvU=function(R,l){this.Z=R;
this.X=l;this.L={}},ovX=function(R,l){a:{R=m_K(R.X,l.version);
try{var y=R.X(l.data,l.key);break a}catch(f){KyO(f,A_O)}y=void 0}return y},js=function(R,l,y){return R.Z.objectStore("EntityStore").get(l).then(function(f){if(f){if(y&&f.entityType!==y)throw Error("Incorrect entity type");
return ovX(R,f)}})},kj=function(R,l,y){return y?(y=y.map(function(f){return js(R,f,l)}),g.ud.all(y)):R.Z.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(l)).then(function(f){return f.map(function(A){return ovX(R,A)})})},ZO=function(R,l,y){var f=Yj8(l),A=m_K(R.X,1),K=Object.assign({},l);
return R.Z.objectStore("EntityStore").get(f).then(function(G){if(G){if(G.entityType!==y)throw Error("Incorrect entity type");K.entityMetadata||(G=ovX(R,G),K.entityMetadata=G.entityMetadata)}}).then(function(){var G={key:f,
entityType:y,data:aYA(A,K,f),version:1};return g.ud.all([g.r4(R.Z.objectStore("EntityStore"),G),ha5(R,K,y)])}).then(function(){DO(R,f,y);
return f})},c_8=function(R,l,y){l=l.map(function(f){return ZO(R,f,y)});
return g.ud.all(l)},J3=function(R,l,y){if(y==null?0:y.Zr){var f=new Set;
return Evt(R,l,f).then(function(){for(var K=[],G=g.u(f),B=G.next();!B.done;B=G.next())K.push(J3(R,B.value));return g.ud.all(K).then(function(){})})}var A=g.qU(l).entityType;
return g.ud.all([R.Z.objectStore("EntityStore").delete(l),Wyr(R,l)]).then(function(){DO(R,l,A)})},LyK=function(R,l){return g.pO(R.Z.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(l)},function(y){return g.ud.all([y.delete(),
Wyr(R,y.cursor.primaryKey)]).then(function(){DO(R,y.cursor.primaryKey,l);return g.Iq(y)})})},Ovr=function(R,l,y,f){var A=m_K(R.X,1);
return js(R,l,f).then(function(K){if(K){K=g.Ax(K,y);var G={key:l,entityType:f,data:aYA(A,K,l),version:1};return g.ud.all([g.r4(R.Z.objectStore("EntityStore"),G),ha5(R,K,f)])}}).then(function(){DO(R,l,f);
return l})},DO=function(R,l,y){var f=R.L[y];
f||(f=new Set,R.L[y]=f);f.add(l)},ivU=function(R,l,y){var f=Yj8(l);
y=HvU(y);if(!y)return g.ud.resolve([]);y=new y(l);R=R.Z.objectStore("EntityAssociationStore");l=[];y=g.u(y.X());for(var A=y.next();!A.done;A=y.next())l.push(g.r4(R,{parentEntityKey:f,childEntityKey:A.value}));return g.ud.all(l).then(function(K){return K.map(function(G){return G[1]})})},Wyr=function(R,l){return R.Z.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(l))},ha5=function(R,l,y){var f=Yj8(l);
return Wyr(R,f).then(function(){return ivU(R,l,y)})},Evt=function(R,l,y){if(y.has(l))return g.ud.resolve(void 0);
y.add(l);return PxU(R,l).then(function(f){return R.Z.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(l)).then(function(){return f})}).then(function(f){var A=g.ud.resolve(void 0);
f=g.u(f);for(var K=f.next(),G={};!K.done;G={DQ:void 0},K=f.next())G.DQ=K.value,A=A.then(function(B){return function(){return Evt(R,B.DQ,y)}}(G));
return A}).then(function(){})},PxU=function(R,l){var y=R.Z.objectStore("EntityAssociationStore");
return y.index("byParentEntityKey").getAll(IDBKeyRange.only(l)).then(function(f){var A=[];f=g.u(f);for(var K=f.next();!K.done;K=f.next())K=K.value,A.push(y.index("byChildEntityKey").getAll(K.childEntityKey));return g.ud.all(A)}).then(function(f){var A=[];
f=g.u(f);for(var K=f.next();!K.done;K=f.next())K=K.value,K.length===1&&A.push(K[0].childEntityKey);return A})},g6=function(){},uCU=function(){this.Z={};
this.Z[0]=new g6;if(!g.O1("aes_pes_encoder_killswitch")){var R=this.Z;try{var l=g.g0();var y=sut(l);var f=new Ss(new g.m7(y),new g.nH(y))}catch(A){throw R=A instanceof Error?new UL("KEY_CREATION_FAILED",{originalMessage:A.message}):new UL("KEY_CREATION_FAILED"),g.Tw(R),R;}R[1]=f}},m_K=function(R,l){l=l===void 0?0:l;
R=R.Z[l];if(!R)throw l=new UL("INVALID_ENCODER_VERSION",{Io:l}),g.Tw(l),l;return R},V4=function(R,l){g.p.call(this);
this.token=R;this.Z=l;this.observers=[];R=new g.Mo.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.g0());R.onmessage=this.X.bind(this);this.channel=R},Ct=function(R,l,y){var f,A,K,G;
return g.w(function(B){if(B.X==1)return g.v(B,RaU(R.token),2);if(B.X!=3)return f=B.Z,g.v(B,g.d4(f,["EntityStore","EntityAssociationStore"],l,function(H){A=new nvU(H,R.Z);return y(A)}),3);
K=B.Z;A&&(G=A.L,Object.keys(G).length>0&&(R.channel.postMessage(G),FyS(R,G)));return B.return(K)})},qm=function(R,l,y){return Ct(R,{mode:"readwrite",
CA:!0},function(f){return ZO(f,l,y)})},Qur=function(R,l){return Ct(R,{mode:"readwrite",
CA:!0},function(y){return c_8(y,l,"offlineOrchestrationActionWrapperEntity")})},$_D=function(R,l){return Ct(R,{mode:"readwrite",
CA:!0},function(y){return J3(y,l)})},ead=function(R){return Ct(R,{mode:"readwrite",
CA:!0},function(l){return LyK(l,"videoPlaybackPositionEntity")})},t3=function(R,l,y){return Ct(R,{mode:"readonly",
CA:!0},function(f){return js(f,l,y)})},Yj=function(R,l,y){return Ct(R,{mode:"readonly",
CA:!0},function(f){return kj(f,l,y)})},FyS=function(R,l){R=g.u(R.observers);
for(var y=R.next();!y.done;y=R.next())y=y.value,y(l)},bvr=function(){var R,l,y;
return g.w(function(f){if(f.X==1)return g.$7(f,2),g.v(f,g.tv(),4);if(f.X!=2){R=f.Z;if(!R||!g.V8()||typeof g.Mo.BroadcastChannel==="undefined")return f.return();l=new uCU;return f.return(new V4(R,l))}y=g.TT(f);y instanceof Error&&g.Tw(y);return f.return()})},Mm=function(){XKU||(XKU=bvr());
return XKU},TCO=function(R){var l;
R=(l=R.options)==null?void 0:l.persistenceOption;return R==="ENTITY_PERSISTENCE_OPTION_PERSIST"||R==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},d_D=function(R){var l;
return g.w(function(y){return y.X==1?g.v(y,Mm(),2):(l=y.Z)?g.v(y,Ct(l,"readwrite",function(f){for(var A={},K=g.u(R),G=K.next(),B={};!G.done;B={Vs:void 0,P9:void 0},G=K.next())B.Vs=G.value,B.Vs.entityKey&&TCO(B.Vs)&&(B.P9=g.Ga(B.Vs.payload),G=void 0,B.Vs.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(G=function(H){return function(){return ZO(f,H.Vs.payload[H.P9],H.P9)}}(B)),B.Vs.type==="ENTITY_MUTATION_TYPE_DELETE"&&(G=function(H){return function(){return J3(f,H.Vs.entityKey)}}(B)),B.Vs.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(G=function(H){return function(){return Ovr(f,H.Vs.entityKey,H.Vs.payload[H.P9],H.P9)}}(B)),G&&(A[B.Vs.entityKey]=A[B.Vs.entityKey]?A[B.Vs.entityKey].then(G):G()));
return g.ud.all(Object.values(A))}),0):y.return()})},r_r=function(R){var l;
return g.w(function(y){if(y.X==1){l=R.mutations;if(!l||l.length<=0)return y.return();if(g.cZ){var f={type:"ENTITY_LOADED"};l!==void 0&&(f.payload=l);g.cZ.dispatch(f)}return g.v(y,d_D(l),2)}l.length=0;g.Q9(y)})},vvK=function(R){return R!==void 0},zaK=function(R){var l=g.Dv();
l=Object.assign({},l);R=Object.assign({},R);for(var y in l)R[y]?(l[y]!==4&&(l[y]=R[y]),delete R[y]):l[y]!==2&&(l[y]=4);Object.assign(l,R);g.Pkr(l);JSON.stringify(l);return l},wKr=function(R){var l,y;
return g.w(function(f){if(f.X==1)return g.v(f,g.tv(),2);if(f.X!=3)return(l=f.Z)?g.v(f,g.g3(l),3):f.return();y=f.Z;return f.return(g.d4(y,["index","media","captions"],{mode:"readwrite",CA:!0},function(A){var K=IDBKeyRange.bound(R+"|",R+"~");A=[A.objectStore("index").delete(K),A.objectStore("media").delete(K),A.objectStore("captions").delete(K)];return g.ud.all(A).then(function(){})}))})},x_t=function(){var R,l;
return g.w(function(y){if(y.X==1)return g.v(y,g.tv(),2);if(y.X!=3){R=y.Z;if(!R)throw g.id("rvdfd");return g.v(y,g.g3(R),3)}l=y.Z;return y.return(g.d4(l,["index","media"],{mode:"readwrite",CA:!0},function(f){var A={};return g.xR(f.objectStore("index"),{},function(K){var G=K.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),B=g.ud.resolve(void 0);if(G){var H=G[1];G=G[2];A[H]=A[H]||{};var n;A[H][G]=g.eEo((n=K.getValue())==null?void 0:n.fmts)}else B=K.delete().then(function(){});
return g.ud.all([g.Iq(K),B]).then(function(m){return g.u(m).next().value})}).then(function(){for(var K={},G=g.u(Object.keys(A)),B=G.next();!B.done;B=G.next()){B=B.value;
var H=A[B].v;K[B]=A[B].a&&H?1:2}var n=zaK(K);return g.X6Q(f.objectStore("media"),{},function(m){var h=m.cursor.key.match(g.dYQ);h&&K[h[1]]||f.objectStore("media").delete(m.cursor.key);return g.Ozc(m)}).then(function(){return n})})}))})},IYK=function(R,l){var y,f;
return g.w(function(A){if(A.X==1)return g.v(A,g.tv(),2);if(A.X!=3){y=A.Z;if(!y)throw g.id("wct");return g.v(A,g.g3(y),3)}f=A.Z;return g.v(A,g.d4(f,["captions"],{mode:"readwrite",CA:!0},function(K){var G=[];K=K.objectStore("captions");for(var B=0;B<l.length;B++){var H=g.r4(K,l[B],R+"|"+l[B].metadata.vss_id);G.push(H)}return g.ud.all(G)}),0)})},NCX=function(R){var l,y,f;
return g.w(function(A){if(A.X==1)return l=IDBKeyRange.bound(R+"|",R+"~"),g.v(A,g.tv(),2);if(A.X!=3){y=A.Z;if(!y)throw g.id("gactfv");return g.v(A,g.g3(y),3)}f=A.Z;return A.return(f.getAll("captions",l))})},pKO=function(R){return g.w(function(l){g.Jn(R,0);
return l.return(wKr(R))})},U_A=function(R){return{context:g.qL(),
videoIds:R}},STO=function(R){return{context:g.qL(),
playlistIds:R}},juU=function(R){return{context:g.qL(),
offlinePlaylistSyncChecks:R}},kZr=function(){this.Z=new Map},ZvS=function(){D_5||(D_5=new kZr);
return D_5},J_U=function(R,l){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:R},metadata:l,statusCode:void 0,csn:void 0,can:void 0}},gv5=function(R,l,y){if(!y){var f=f===void 0?!1:f;
y=R.Z.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!y||f)y=g.L6(16),R.Z.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",y)}R={flowNonce:y,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:l.eventType};l.metadata&&(R.flowMetadata=l.metadata);l.statusCode!==void 0&&(R.flowEventStatus=l.statusCode);l.csn&&(R.csn=l.csn);l.can&&(R.can=l.can);g.sE("flowEvent",R,void 0)},VfK=function(R){var l,y,f,A,K,G,B,H,n,m,h,c,E,W,Q,e,r,d,z,N,D,t,C,Ac,Bi,ar,nk,Y,Pi,wq,Rt,pX,O5,pk,tK,c8,DU,lN,T,IL;
return g.w(function(rO){if(rO.X==1)return g.v(rO,Ct(R,{mode:"readonly",CA:!0},function(fk){return kj(fk,"playbackData").then(function(XS){var F=XS.map(function(U5){return U5.transfer}).filter(function(U5){return!!U5}),y9=XS.map(function(U5){return U5.offlineVideoPolicy}).filter(function(U5){return!!U5}),Dc=XS.filter(function(U5){return!!U5.key}).map(function(U5){return g.tx(g.qU(U5.key).entityId,"downloadStatusEntity")});
F=kj(fk,"transfer",F);y9=kj(fk,"offlineVideoPolicy",y9);Dc=kj(fk,"downloadStatusEntity",Dc);var KG=F.then(function(U5){U5=U5.reduce(function(gq,Y7){(Y7==null?0:Y7.offlineVideoStreams)&&gq.push.apply(gq,g.ci(Y7.offlineVideoStreams));return gq},[]).filter(function(gq){return!!gq});
return kj(fk,"offlineVideoStreams",U5)});
return g.ud.all([F,y9,KG,Dc]).then(function(U5){var gq=g.u(U5);U5=gq.next().value;var Y7=gq.next().value;var q5=gq.next().value;gq=gq.next().value;return[XS,U5,Y7,q5,gq]})})}),2);
if(rO.X!=3)return l=rO.Z,g.v(rO,Ct(R,{mode:"readonly",CA:!0},function(fk){return kj(fk,"mainDownloadsListEntity").then(function(XS){var F,y9;return(y9=(F=XS[0])==null?void 0:F.downloads)!=null?y9:[]})}),3);
y=rO.Z;f=g.u(l);A=f.next().value;K=f.next().value;G=f.next().value;B=f.next().value;H=f.next().value;n=A;m=K;h=G;c=B;E=H;W={};Q={};e={};r={};d={};z=[];N=g.u(m);for(D=N.next();!D.done;D=N.next())(t=D.value)&&(W[t.key]=t);C=g.u(h);for(Ac=C.next();!Ac.done;Ac=C.next())(Bi=Ac.value)&&(Q[Bi.key]=Bi);ar=g.u(E);for(nk=ar.next();!nk.done;nk=ar.next())(Y=nk.value)&&(e[Y.key]=Y);Pi=g.u(c);for(wq=Pi.next();!wq.done;wq=Pi.next())(Rt=wq.value)&&(r[Rt.key]=Rt);pX=g.u(y);for(O5=pX.next();!O5.done;O5=pX.next())pk=
O5.value,tK=void 0,d[(tK=pk.videoItem)!=null?tK:""]=!0,pk.videoItem&&(DU=c8=void 0,lN=(DU=(c8=g.qU(pk.videoItem))==null?void 0:c8.entityId)!=null?DU:"",z.push({externalVideoId:lN}));T=n.filter(function(fk){if(!fk||!fk.key||!fk.offlineVideoPolicy)return!1;fk=g.qU(fk.key).entityId;fk=g.tx(fk,"downloadStatusEntity");var XS;return!(fk&&((XS=e[fk])==null?void 0:XS.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
IL=T.map(function(fk){var XS=W[fk.transfer],F=[];if(XS==null?0:XS.offlineVideoStreams)for(var y9=g.u(XS.offlineVideoStreams),Dc=y9.next();!Dc.done;Dc=y9.next())(Dc=r[Dc.value])&&F.push(Dc);y9=Q[fk.offlineVideoPolicy];Dc=d;var KG=fk==null?void 0:fk.playerResponseTimestamp,U5=g.qU(y9.key).entityId;fk=g.tx(U5,"mainVideoEntity");if(y9.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var gq="OFFLINE_VIDEO_STATE_DISABLED";y9.expirationTimestamp&&Number(y9.expirationTimestamp)<Date.now()/1E3&&(gq="OFFLINE_VIDEO_STATE_EXPIRED")}else if(y9.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")gq="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(XS==null?void 0:XS.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":gq="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":gq="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":gq="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":gq="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":gq="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":gq="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:gq="OFFLINE_VIDEO_STATE_UNKNOWN"}if(gq==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(XS==null?void 0:XS.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":gq="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":gq="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":gq=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}U5={id:U5,videoState:gq};if(XS==null?0:XS.cotn)U5.cotn=XS.cotn;if(XS==null?0:XS.maximumDownloadQuality)U5.selectedVideoQuality=XS==null?void 0:XS.maximumDownloadQuality;if(XS==null?0:XS.lastProgressTimeMs)U5.lastProgressTimeMs=XS.lastProgressTimeMs;KG&&(U5.playerResponseSavedTimeMs=String(Number(KG)*1E3));XS=String;KG=0;F=g.u(F);for(gq=F.next();!gq.done;gq=F.next())if(gq=gq.value,gq.streamsProgress){gq=g.u(gq.streamsProgress);for(var Y7=gq.next();!Y7.done;Y7=gq.next()){var q5=
void 0;KG+=Number((q5=Y7.value.numBytesDownloaded)!=null?q5:0)}}U5.downloadedBytes=XS(KG);U5.selectedOfflineMode=Dc[fk]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";y9.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(U5.offlinePlaybackDisabledReason=y9.offlinePlaybackDisabledReason);return U5});
return rO.return({offlineVideos:IL,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:z}}})})},CxD=function(){this.locks=navigator.locks},qTU=function(){try{var R=g.yr("ytglobal.locks_");
if(R)return R;var l;if(l=navigator){var y=navigator;l="locks"in y&&!!y.locks}if(l)return g.Mo.localStorage&&g.Mo.localStorage.getItem("noop"),R=new CxD,g.lA("ytglobal.locks_",R),R}catch(f){}},R5=function(){},tfZ=function(){},YTd=function(R){if(R.includes(":"))throw Error("Invalid user cache name: "+R);
return R+":"+g.g0("CacheStorage get")},MfZ=function(){return g.w(function(R){if(lB!==void 0)return R.return(lB);
lB=new Promise(function(l){var y;return g.w(function(f){switch(f.X){case 1:return g.$7(f,2),g.v(f,yw.open("test-only"),4);case 4:return g.v(f,yw.delete("test-only"),5);case 5:g.XZ(f,3);break;case 2:if(y=g.TT(f),y instanceof Error&&y.name==="SecurityError")return l(!1),f.return();case 3:l("caches"in window),g.Q9(f)}})});
return R.return(lB)})},lnX=function(){return g.w(function(R){if(R.X==1)return g.v(R,MfZ(),2);
if(!R.Z)return R.return(void 0);Rxr||(Rxr=new tfZ);return R.return(Rxr)})},fB=function(R,l,y){g.dP(new g.JD("Woffle: "+R,y?{cotn:y}:""));
l instanceof Error&&g.dP(l)},yRU=function(R){var l;
return g.w(function(y){if(y.X==1)return g.v(y,VfK(R),2);l=y.Z;g.sE("offlineStateSnapshot",l);g.Q9(y)})},Am=function(R){g.p.call(this);
var l=this;this.api=R;this.yu={Na4:function(){return l.Z},
ia7:function(){return l.X}};
typeof g.Mo.BroadcastChannel!=="undefined"&&(this.Z=new g.Mo.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.g0()),this.Z.onmessage=this.L.bind(this),this.X=new g.Mo.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.g0()),this.X.onmessage=this.Y.bind(this))},KB=function(R,l){R.api.KX("onOfflineOperationFailure",l);
var y;(y=R.Z)==null||y.postMessage(l)},fnr=function(R,l,y,f){var A=this;
this.W=R;this.B=l;this.visibility=y;this.C=f;this.J=this.V=this.D=this.L=this.Z=!1;this.Y=new g.Vg(function(){A.eM()});
this.yu={Yc:function(){return A.X},
eM:function(){A.eM()},
Yx7:function(){return A.Y}};
this.visibility.subscribe("visibilitystatechange",function(){A.cA()})},ARD=function(R){if(!R.L&&!R.Z){var l=qTU();
if(l){R.L=!0;var y=g.g0("OfflineLockManager");l.request("woffle_orchestration_leader:"+y,{},function(){var f,A,K,G;return g.w(function(B){switch(B.X){case 1:return g.$7(B,2),R.X=new g.o2,R.Z=!0,R.L=!1,g.v(B,R.W(),4);case 4:return g.v(B,R.X.promise,5);case 5:g.XZ(B,0);break;case 2:f=g.TT(B),((K=(A=R).C)==null?0:K.call(A,"wo_relinquish_leadership_on_lock_request_error"))||R.eM(),f instanceof Error&&(G=f,G.args=[{name:"WoLockManagerError",kU:f.name}],g.Tw(G)),g.Q9(B)}})})}}},KgA=function(R){R.Z&&(R.J=
!0,Gy(R))},GNS=function(R,l){R.Z&&(R.D=l,Gy(R))},anZ=function(R,l){R.Z&&(R.V=l,Gy(R))},Gy=function(R){R.V&&R.D&&R.J&&R.visibility.isBackground()?g.Cz(R.Y,6E4):R.Y.stop()},a5=function(R){var l;
R.offlineDeleteReason=(l=R.offlineDeleteReason)!=null?l:"OFFLINE_DELETE_REASON_UNKNOWN";var y;R.offlineModeType=(y=R.offlineModeType)!=null?y:"OFFLINE_NOW";g.sE("offlineDeleteEvent",R)},sZ=function(R,l){var y=l.videoId;
var f=l.ly;l=l.offlineModeType;R.encryptedVideoId=y;R.cotn=f==null?void 0:f.cotn;R.offlineabilityFormatType=f==null?void 0:f.maximumDownloadQuality;var A;R.isRefresh=(A=f==null?void 0:f.isRefresh)!=null?A:!1;var K;R.softErrorCount=(K=f==null?void 0:f.transferRetryCount)!=null?K:0;R.offlineModeType=l!=null?l:"OFFLINE_NOW";(R.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&R.statusType==="UNKNOWN_STATUS_TYPE"||!R.transferStatusType&&!R.statusType)&&g.dP(Error("Woffle unknown transfer status"));
g.sE("offlineTransferStatusChanged",R)},s25=function(R){sZ({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},R)},BeU=function(R,l,y,f){f={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!f};l&&y&&(l=Math.floor(l/1024).toFixed(),y=Math.floor(y/1024).toFixed(),f.alreadyDownloadedKbytes=l,f.totalFetchedKbytes=l,f.totalContentKbytes=y);sZ(f,R)},H3t=function(R){sZ({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},R)},nlU=function(R){sZ({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},R)},mlZ=function(R){switch(R){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Bj=function(R){var l,y,f;
return((f=(l=R.actionMetadata)==null?void 0:(y=l.retryScheduleIntervalsInSeconds)==null?void 0:y.length)!=null?f:0)>0},Hj=function(R){return R.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!R.entityKey},nB=function(R){return R.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!R.entityKey},m4=function(R){return R.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!R.entityKey},ol5=function(R){return R.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!R.entityKey},
o5=function(R,l,y,f,A){A=A===void 0?!1:A;
var K,G,B,H,n,m;return g.w(function(h){if(h.X==1)return K=g.tx(R,l),G=g.tx(R,"downloadStatusEntity"),g.v(h,Ct(y,{mode:"readonly",CA:!0},function(c){return g.ud.all([js(c,K,l),js(c,G,"downloadStatusEntity")])}),2);
B=h.Z;H=B.length?B[0]:void 0;if(!H)return h.bQ(0);n=hx5;if(m=B.length>1?B[1]:void 0){if(m.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!A)return h.return();m.downloadState=f}else m={key:G,downloadState:f};g.x$(H,n,m);return g.v(h,Ct(y,{mode:"readwrite",CA:!0},function(c){return g.ud.all([ZO(c,H,l),ZO(c,m,"downloadStatusEntity")])}),0)})},hm=function(R,l){return R.actionType===l.actionType&&R.entityKey===l.entityKey},cj=function(R,l){if(R&&R.transferState!=="TRANSFER_STATE_COMPLETE"&&R.transferState!==
"TRANSFER_STATE_FAILED"){var y=g.qU(R.key).entityId;
sZ({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:y,ly:R,offlineModeType:l})}},EZ=function(R){if(!R||!R.thumbnails)return[];
var l=[];R=g.u(R.thumbnails);for(var y=R.next();!y.done;y=R.next())y=y.value,y.url&&l.push(y.url);return l},cRK=function(R,l,y){y=y===void 0?[]:y;
var f,A,K,G,B,H,n,m,h,c,E,W,Q;return g.w(function(e){if(e.X==1)return y.length?g.v(e,Yj(R,l),2):e.return([]);f=e.Z;A=new Set;K=g.u(f);for(G=K.next();!G.done;G=K.next())if(B=G.value,H=B.id||B.key)n=g.qU(H).entityId,A.add(n);m=[];h=g.u(y);for(c=h.next();!c.done;c=h.next())E=c.value,W=E.offlineVideoData,Q=void 0,((Q=W)==null?0:Q.videoId)&&!A.has(W.videoId)&&m.push(E);return e.return(m)})},ElK=function(R,l,y){return new g.KC(R,{cotn:l,
raw_player_response:y,download_media:!0,start:Infinity,disable_watch_next:!0})},WgU=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},Wj=function(R,l,y,f,A,K,G,B,H,n,m){this.entityType=R;
this.actionId=l;this.action=y;this.parentActionId=f;this.rootActionId=A===void 0?l:A;this.childActionIds=K;this.prereqActionId=G;this.postreqActionIds=B;this.hasChildActionFailed=n;this.retryScheduleIndex=0;this.Z=m||Date.now();this.retryScheduleIndex=H||0},LB=function(R){if(!R.key)throw Error("Entity key is required.");
if(!R.actionProto)throw Error("OfflineOrchestrationAction is required.");var l=g.qU(R.key),y=g.qU(R.actionProto.entityKey);return new Wj(y.entityType,l.entityId,R.actionProto,R.parentActionId,R.rootActionId,R.childActionIds,R.prereqActionId,R.postreqActionIds,R.retryScheduleIndex,R.hasChildActionFailed,Number(R.enqueueTimeSec)*1E3)},OZ=function(R){return{key:g.tx(R.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:R.action,parentActionId:R.parentActionId,rootActionId:R.rootActionId,childActionIds:R.childActionIds,prereqActionId:R.prereqActionId,postreqActionIds:R.postreqActionIds,retryScheduleIndex:R.retryScheduleIndex,hasChildActionFailed:R.hasChildActionFailed,enqueueTimeSec:(R.Z/1E3).toFixed()}},Lg5=function(){var R;
return g.w(function(l){return l.X==1?g.v(l,lnX(),2):(R=l.Z)?l.return(R.delete("yt-player-local-img")):l.return(!0)})},iB=function(R){var l,y;
return g.w(function(f){if(f.X==1)return g.v(f,lnX(),2);if(f.X!=3){l=f.Z;if(!l)throw Error("Cache API not supported");return R.length?g.v(f,l.open("yt-player-local-img"),3):f.return()}y=f.Z;return g.v(f,Promise.all(R.map(function(A){return y.delete(A)})),0)})},Pj=function(R){var l,y;
return g.w(function(f){if(f.X==1)return g.v(f,lnX(),2);if(f.X!=3){l=f.Z;if(!l)throw Error("Cache API not supported");return R.length?g.v(f,l.open("yt-player-local-img"),3):f.return()}y=f.Z;return g.v(f,y.addAll(R),0)})},uB=function(R,l,y,f,A){var K,G,B,H,n,m,h,c,E,W,Q,e,r,d,z,N,D,t,C,Ac,Bi,ar,nk,Y,Pi,wq,Rt,pX,O5,pk,tK;
return g.w(function(c8){switch(c8.X){case 1:return K=g.tx(R,"mainVideoEntity"),G=g.tx(R,"ytMainChannelEntity"),B=g.tx(R,"transfer"),H=g.tx(R,"videoDownloadContextEntity"),g.v(c8,Ct(l,{mode:"readonly",CA:!0},function(DU){return g.ud.all([js(DU,K,"mainVideoEntity"),js(DU,G,"ytMainChannelEntity"),js(DU,B,"transfer"),js(DU,H,"videoDownloadContextEntity"),kj(DU,"ytMainChannelEntity"),kj(DU,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:n=c8.Z;m=g.u(n);h=m.next().value;c=m.next().value;E=m.next().value;W=m.next().value;Q=m.next().value;e=m.next().value;r=h;d=c;z=E;N=W;D=Q;t=e;if(!r&&!d){c8.bQ(3);break}C=r?EZ(r.thumbnail):[];if(!d){Ac=[];c8.bQ(4);break}return g.v(c8,O3D(d,D),5);case 5:Ac=c8.Z;case 4:return Bi=Ac,g.v(c8,iB(C.concat(Bi)),3);case 3:ar=[];nk=g.tx(R,"downloadStatusEntity");Y=g.u(t);for(Pi=Y.next();!Pi.done;Pi=Y.next())wq=Pi.value,Rt=g.qU(wq.key).entityId,pX=LB(wq),O5=g.qU(pX.action.entityKey).entityId,Rt!==R&&O5!==
R||hm(y,wq.actionProto)||ar.push(wq.key);return g.v(c8,Ct(l,{mode:"readwrite",CA:!0},function(DU){var lN=ar.map(function(T){return J3(DU,T)});
lN.push(J3(DU,K,{Zr:!0}));lN.push(J3(DU,nk,{Zr:!0}));return g.ud.all(lN)}),7);
case 7:tK=(pk=N)==null?void 0:pk.offlineModeType,A&&(a5(A),A.offlineModeType&&(tK=A.offlineModeType)),cj(z,tK),KB(f,{entityKey:K,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Q9(c8)}})},ud8=function(R,l,y,f){var A,K,G,B,H,n,m,h,c,E,W,Q,e,r,d,z,N,D,t,C,Ac,Bi,ar,nk,Y,Pi,wq,Rt,pX,O5,pk,tK,c8,DU,lN,T,IL,rO,fk,XS,F,y9,Dc,KG,U5,gq,Y7,q5,N5,b;
return g.w(function(P){switch(P.X){case 1:return A=g.tx(R,"mainPlaylistEntity"),K=g.tx(R,"ytMainChannelEntity"),g.v(P,Ct(l,{mode:"readonly",CA:!0},function(X){return g.ud.all([js(X,A,"mainPlaylistEntity"),js(X,K,"ytMainChannelEntity"),kj(X,"mainPlaylistEntity"),kj(X,"mainDownloadsListEntity"),kj(X,"ytMainChannelEntity"),kj(X,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:G=P.Z;B=g.u(G);H=B.next().value;n=B.next().value;m=B.next().value;h=B.next().value;c=B.next().value;E=B.next().value;W=H;Q=n;e=m;r=h;d=c;z=E;if(!W&&!Q){P.bQ(3);break}N=W?i38(W):[];if(!Q){D=[];P.bQ(4);break}return g.v(P,O3D(Q,d),5);case 5:D=P.Z;case 4:return t=D,g.v(P,iB(N.concat(t)),3);case 3:C=[];Ac=new Map;if(!W){P.bQ(7);break}return g.v(P,PGA(W,e,r),8);case 8:C=P.Z;Bi=g.u(C);for(ar=Bi.next();!ar.done;ar=Bi.next())nk=ar.value,Ac.set(nk,{videoId:nk,playlistId:R,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.v(P,Ct(l,{mode:"readonly",CA:!0},function(X){return g.ud.all([kj(X,"transfer"),kj(X,"videoDownloadContextEntity")])}),9);
case 9:Y=P.Z;Pi=g.u(Y);wq=Pi.next().value;Rt=Pi.next().value;pX=wq;O5=Rt;pk=g.u(pX);for(tK=pk.next();!tK.done;tK=pk.next())c8=tK.value,DU=g.qU(c8.key).entityId,(lN=Ac.get(DU))&&c8&&(lN.cotn=c8.cotn);T=g.u(O5);for(IL=T.next();!IL.done;IL=T.next())rO=IL.value,fk=g.qU(rO.key).entityId,(XS=Ac.get(fk))&&rO&&(XS.offlineModeType=rO.offlineModeType);case 7:F=[];y9=g.u(z);for(Dc=y9.next();!Dc.done;Dc=y9.next())KG=Dc.value,U5=g.qU(KG.key).entityId,gq=LB(KG),U5!==R&&gq.rootActionId!==R||hm(y,KG.actionProto)||
F.push(KG.key);Y7=g.tx(R,"mainPlaylistEntity");return g.v(P,Ct(l,{mode:"readwrite",CA:!0},function(X){var x=F.map(function(S){return J3(X,S)});
x.push(J3(X,Y7,{Zr:!0}));return g.ud.all(x)}),10);
case 10:if(!W){P.bQ(0);break}C.reverse();if(!C){P.bQ(0);break}q5=g.u(C);N5=q5.next();case 13:if(N5.done){P.bQ(0);break}b=N5.value;return g.v(P,uB(b,l,y,f,Ac.get(b)),14);case 14:N5=q5.next(),P.bQ(13)}})},Q2K=function(R,l,y,f){var A,K,G,B,H,n,m,h,c;
return g.w(function(E){if(E.X==1)return A=g.tx("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),K=new Map,g.v(E,Ct(R,{mode:"readwrite",CA:!0},function(W){var Q=kj(W,"transfer"),e=kj(W,"offlineOrchestrationActionWrapperEntity"),r=kj(W,"videoDownloadContextEntity"),d=js(W,A,"mainDownloadsListEntity");return g.ud.all([Q,e,r,d]).then(function(z){z=g.u(z);var N=z.next().value;var D=z.next().value;var t=z.next().value;var C=z.next().value;z=FgK.map(function(Bi){return LyK(W,Bi)});
D=g.u(D);for(var Ac=D.next();!Ac.done;Ac=D.next())Ac=Ac.value,hm(l,Ac.actionProto)||z.push(J3(W,Ac.key,{Zr:!0}));C&&(C.downloads=[],z.push(ZO(W,C,"mainDownloadsListEntity")));if(t)for(t=g.u(t),C=t.next();!C.done;C=t.next())C=C.value,D=g.qU(C.key).entityId,D=g.tx(D,"transfer"),K.set(D,C.offlineModeType);return g.ud.all(z).then(function(){return N})})}),2);
G=E.Z;B=g.u(G);for(H=B.next();!H.done;H=B.next())n=H.value,cj(n,K.get(n.key)),m=g.qU(n.key).entityId,h={videoId:m,offlineDeleteReason:f,cotn:n.cotn,offlineModeType:K.get(n.key)},a5(h),c=g.tx(m,"mainVideoEntity"),KB(y,{entityKey:c,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.v(E,Lg5(),0)})},i38=function(R,l){var y=[];
if(R.thumbnailStyleData){R=g.u(R.thumbnailStyleData);for(var f=R.next();!f.done;f=R.next()){var A=void 0,K=void 0,G=void 0;y=y.concat(EZ((A=f.value)==null?void 0:(K=A.value)==null?void 0:(G=K.collageThumbnail)==null?void 0:G.coverThumbnail))}}l=EZ(l);return y.concat(l)},PGA=function(R,l,y){var f,A,K,G,B,H,n,m,h,c,E,W,Q,e,r,d,z,N,D,t,C,Ac,Bi;
return g.w(function(ar){f=[];A=new Set;if(y.length)for(K=g.u(y),G=K.next();!G.done;G=K.next())if(B=G.value,H=void 0,(H=B.downloads)==null?0:H.length)for(n=g.u(B.downloads),m=n.next();!m.done;m=n.next())h=m.value,h.videoItem&&(c=g.qU(h.videoItem).entityId,A.add(c));if(R.videos){E=g.u(R.videos);for(W=E.next();!W.done;W=E.next())Q=W.value,e=JSON.parse(g.qU(Q).entityId),e.videoId&&!A.has(e.videoId)&&f.push(e.videoId);r=g.u(l);for(d=r.next();!d.done;d=r.next())if(z=d.value,z.key!==R.key&&(N=z.videos))for(D=
g.u(N),t=D.next();!t.done;t=D.next())C=t.value,Ac=JSON.parse(g.qU(C).entityId),Ac.videoId&&(Bi=f.indexOf(Ac.videoId),Bi!==-1&&f.splice(Bi,1))}return ar.return(f)})},O3D=function(R,l){var y,f,A,K,G,B,H,n;
return g.w(function(m){y=EZ(R.avatar);f=g.u(l);for(A=f.next();!A.done;A=f.next())if(K=A.value,K.id!==R.id)for(G=g.u(EZ(K.avatar)),B=G.next();!B.done;B=G.next())H=B.value,n=y.indexOf(H),n!==-1&&y.splice(n,1);return m.return(y)})},$lr=function(R){var l;
return g.w(function(y){l=g.k(R.frameworkUpdates,Fk);return R.frameworkUpdates&&l?g.v(y,r_r(l),0):y.return()})},b3D=function(R){var l;
if((l=R.onResponseReceivedActions)!=null&&l.length){var y;R=(y=g.k(g.k(R.onResponseReceivedActions[0],exA),g.xsS))==null?void 0:y.actions;if(R!=null&&R.length)return R}},XGd=function(R){var l,y,f;
return g.w(function(A){if(A.X==1)return R?g.v(A,t3(R,g.Um,"mainDownloadsListEntity"),2):A.return([]);l=A.Z;return((y=l)==null?0:(f=y.downloads)==null?0:f.length)?A.return(l.downloads.map(function(K){var G;return(G=K.videoItem)!=null?G:""})):A.return([])})},dl8=function(R,l){var y;
return g.w(function(f){return f.X==1?g.v(f,TeK(R,l),2):(y=f.Z)?g.v(f,Ct(R,{mode:"readwrite",CA:!0},function(A){var K=[ZO(A,y.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];y.mainDownloadsListEntity&&K.push(ZO(A,y.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.ud.all(K)}),0):f.bQ(0)})},TeK=function(R,l){var y,f,A,K,G,B,H,n,m,h,c,E,W,Q,e,r,d,z;
return g.w(function(N){if(N.X==1)return y=g.tx("main_downloads_library_id","mainDownloadsLibraryEntity"),f=g.tx("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.v(N,Ct(R,{mode:"readonly",CA:!0},function(D){return g.ud.all([js(D,y,"mainDownloadsLibraryEntity"),js(D,f,"mainDownloadsListEntity")])}),2);
A=N.Z;K=g.u(A);G=K.next().value;B=K.next().value;H=G;n=B;H||(H={id:y});m=g.u(l);for(h=m.next();!h.done;h=m.next())if(c=h.value,c===g.Um){if(H.smartDownloadsList)return N.return();H.smartDownloadsList=c}else if(E=g.qU(c).entityType,W={},E==="mainPlaylistEntity"?W.playlistItem=c:E==="mainVideoEntity"&&(W.videoItem=c),!g.oL(W)){Q=void 0;if((Q=n)==null?0:Q.downloads){e=!1;r=g.u(n.downloads);for(d=r.next();!d.done;d=r.next())if(z=d.value,z.playlistItem===c||z.videoItem===c){e=!0;break}e||n.downloads.push(W)}else n=
{id:f,downloads:[W]};H.downloadsList=f}return N.return({mainDownloadsLibraryEntity:H,mainDownloadsListEntity:n})})},rRK=function(R,l){var y,f,A,K,G,B,H,n,m,h,c,E,W,Q,e;
return g.w(function(r){if(r.X==1)return y=g.tx("main_downloads_library_id","mainDownloadsLibraryEntity"),f=g.tx("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.v(r,Ct(R,{mode:"readonly",CA:!0},function(d){return g.ud.all([js(d,y,"mainDownloadsLibraryEntity"),js(d,f,"mainDownloadsListEntity"),js(d,g.Um,"mainDownloadsListEntity")])}),2);
A=r.Z;K=g.u(A);G=K.next().value;B=K.next().value;H=K.next().value;n=G;m=B;h=H;if(!n)return r.bQ(0);if(l===g.Um&&((c=h)==null?0:c.downloads))h.downloads=[];else if((E=m)==null?0:E.downloads)for(W=g.qU(l).entityType,Q=0;Q<m.downloads.length;Q++)if(e=m.downloads[Q],W==="mainVideoEntity"&&e.videoItem===l){m.downloads.splice(Q,1);break}else if(W==="mainPlaylistEntity"&&e.playlistItem===l){m.downloads.splice(Q,1);break}return g.v(r,Ct(R,{mode:"readwrite",CA:!0},function(d){var z=[ZO(d,n,"mainDownloadsLibraryEntity")];
m&&z.push(ZO(d,m,"mainDownloadsListEntity"));h&&z.push(ZO(d,h,"mainDownloadsListEntity"));return g.ud.all(z)}),0)})},Qw=function(R,l){var y,f,A,K,G,B,H,n,m,h,c;
return g.w(function(E){if(E.X==1)return y=g.tx(l,"transfer"),f=g.tx(l,"videoDownloadContextEntity"),g.v(E,Ct(R,{mode:"readonly",CA:!0},function(W){return g.ud.all([js(W,y,"transfer"),js(W,f,"videoDownloadContextEntity")])}),2);
A=E.Z;K=g.u(A);G=K.next().value;B=K.next().value;H=G;n=B;c={videoId:l,cotn:(m=H)==null?void 0:m.cotn,offlineModeType:(h=n)==null?void 0:h.offlineModeType};return E.return(c)})},$p=function(R,l,y,f,A){var K,G,B,H,n,m,h,c,E,W,Q,e,r,d,z,N,D,t,C,Ac;
return g.w(function(Bi){switch(Bi.X){case 1:return K=g.tx(R,"musicTrack"),G=g.tx(R,"transfer"),g.v(Bi,Ct(l,{mode:"readonly",CA:!0},function(ar){return g.ud.all([js(ar,K,"musicTrack"),js(ar,G,"transfer"),kj(ar,"musicTrack"),kj(ar,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:B=Bi.Z;H=g.u(B);n=H.next().value;m=H.next().value;h=H.next().value;c=H.next().value;E=n;W=m;Q=h;e=c;if(!E){Bi.bQ(3);break}return g.v(Bi,vlO(E,Q),4);case 4:return r=Bi.Z,g.v(Bi,iB(r),3);case 3:d=[];z=g.u(e);for(N=z.next();!N.done;N=z.next())D=N.value,t=g.qU(D.key).entityId,C=LB(D),Ac=g.qU(C.action.entityKey).entityId,t!==R&&Ac!==R||hm(y,D.actionProto)||d.push(D.key);return g.v(Bi,Ct(l,{mode:"readwrite",CA:!0},function(ar){var nk=d.map(function(Y){return J3(ar,Y)});
nk.push(J3(ar,K,{Zr:!0}));return g.ud.all(nk)}),6);
case 6:cj(W),A&&a5(A),KB(f,{entityKey:K,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Q9(Bi)}})},e_=function(R,l,y,f,A){var K,G,B,H,n,m,h,c,E,W,Q,e,r,d,z,N,D,t,C,Ac,Bi,ar,nk,Y,Pi,wq,Rt,pX,O5,pk,tK,c8,DU,lN,T,IL;
return g.w(function(rO){switch(rO.X){case 1:return K=g.tx(R,l),G=g.tx("music_downloads_library_id","musicDownloadsLibraryEntity"),g.v(rO,Ct(y,{mode:"readonly",CA:!0},function(fk){return g.ud.all([js(fk,K,l),js(fk,G,"musicDownloadsLibraryEntity"),kj(fk,l),kj(fk,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:B=rO.Z;H=g.u(B);n=H.next().value;m=H.next().value;h=H.next().value;c=H.next().value;E=n;W=m;Q=h;e=c;if(!E){rO.bQ(3);break}return g.v(rO,vlO(E,Q),4);case 4:return r=rO.Z,g.v(rO,iB(r),3);case 3:d=[];z=new Map;if(!E){rO.bQ(6);break}return g.v(rO,zxU(E,Q,W),7);case 7:d=rO.Z;N=g.u(d);for(D=N.next();!D.done;D=N.next())t=D.value,C=g.qU(t).entityId,z.set(C,{videoId:C,playlistId:R,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.v(rO,Yj(y,"transfer"),8);case 8:for(Ac=rO.Z,Bi=
g.u(Ac),ar=Bi.next();!ar.done;ar=Bi.next())nk=ar.value,Y=g.qU(nk.key).entityId,(Pi=z.get(Y))&&nk&&(Pi.cotn=nk.cotn);case 6:wq=[];Rt=g.u(e);for(pX=Rt.next();!pX.done;pX=Rt.next())O5=pX.value,pk=g.qU(O5.key).entityId,tK=LB(O5),pk!==R&&tK.rootActionId!==R||hm(f,O5.actionProto)||wq.push(O5.key);c8=g.tx(R,l);return g.v(rO,Ct(y,{mode:"readwrite",CA:!0},function(fk){var XS=wq.map(function(F){return J3(fk,F)});
XS.push(J3(fk,c8,{Zr:!0}));return g.ud.all(XS)}),9);
case 9:if(!E){rO.bQ(0);break}d.reverse();if(!d.length){rO.bQ(0);break}DU=g.u(d);lN=DU.next();case 12:if(lN.done){rO.bQ(0);break}T=lN.value;IL=g.qU(T).entityId;if(!IL){rO.bQ(13);break}return g.v(rO,$p(IL,y,f,A,z.get(IL)),13);case 13:lN=DU.next(),rO.bQ(12)}})},bB=function(R,l,y){var f,A,K,G,B,H,n;
return g.w(function(m){if(m.X==1)return g.v(m,Ct(R,{mode:"readwrite",CA:!0},function(h){var c=kj(h,"transfer"),E=kj(h,"offlineOrchestrationActionWrapperEntity");return g.ud.all([c,E]).then(function(W){W=g.u(W);var Q=W.next().value;var e=W.next().value;W=wGU.map(function(N){return LyK(h,N)});
e=g.u(e);for(var r=e.next();!r.done;r=e.next()){r=r.value;var d=g.qU(r.actionProto.entityKey).entityType==="musicTrack",z=r.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";hm(l,r.actionProto)||d&&(!d||z)||W.push(J3(h,r.key,{Zr:!0}))}return g.ud.all(W).then(function(){return Q})})}),2);
f=m.Z;A=g.u(f);for(K=A.next();!K.done;K=A.next())G=K.value,cj(G),B=g.qU(G.key).entityId,H={videoId:B,offlineDeleteReason:void 0,cotn:G.cotn},a5(H),n=g.tx(B,"musicTrack"),KB(y,{entityKey:n,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.v(m,Lg5(),0)})},xlD=function(R){for(var l,y=g.u(R.additionalMetadatas),f=y.next();!f.done;f=y.next())f=f.value,f.offlineMusicVideoData&&(l=f.offlineMusicVideoData);
var A,K,G,B,H;return{id:g.tx(R.videoId,"musicTrack"),videoId:R.videoId,title:R.title,thumbnailDetails:R.thumbnail,lengthMs:String(Number(R.lengthSeconds)*1E3),albumTitle:(A=l)==null?void 0:A.releaseTitle,musicVideoType:(K=l)==null?void 0:K.musicVideoType,contentRating:{explicitType:(G=l)==null?void 0:G.explicitType},artistNames:((B=l)==null?void 0:B.byline)||((H=l)==null?void 0:H.channelName),downloadMetadata:g.tx(R.videoId,"musicTrackDownloadMetadataEntity")}},zxU=function(R,l,y){var f,A,K,G,B,H,
n,m,h,c,E,W,Q,e,r,d,z,N;
return g.w(function(D){f=[];A=new Set;if((K=y)==null?0:(G=K.downloadedTracks)==null?0:G.length)for(B=g.u(y.downloadedTracks),H=B.next();!H.done;H=B.next())n=H.value,A.add(n);if(R.tracks){m=g.u(R.tracks);for(h=m.next();!h.done;h=m.next())c=h.value,A.has(c)||f.push(c);E=g.u(l);for(W=E.next();!W.done;W=E.next())if(Q=W.value,Q.id!==R.id&&(e=Q.tracks))for(r=g.u(e),d=r.next();!d.done;d=r.next())z=d.value,N=f.indexOf(z),N!==-1&&f.splice(N,1)}return D.return(f)})},vlO=function(R,l){var y,f,A,K,G,B,H,n;
return g.w(function(m){y=EZ(R.thumbnailDetails);f=g.u(l);for(A=f.next();!A.done;A=f.next())if(K=A.value,K.id!==R.id)for(G=g.u(EZ(K.thumbnailDetails)),B=G.next();!B.done;B=G.next())H=B.value,n=y.indexOf(H),n!==-1&&y.splice(n,1);return m.return(y)})},Int=function(R,l){var y,f,A,K,G,B,H,n,m;
return g.w(function(h){if(h.X==1)return y=g.tx("music_downloads_library_id","musicDownloadsLibraryEntity"),g.v(h,t3(R,y,"musicDownloadsLibraryEntity"),2);(f=h.Z)||(f={id:y});A=g.qU(l).entityType;A==="musicTrack"?(K=f.downloadedTracks)!=null&&K.includes(l)||(f.downloadedTracks=((G=f.downloadedTracks)!=null?G:[]).concat(l)):A==="musicPlaylist"?(B=f.downloadedPlaylists)!=null&&B.includes(l)||(f.downloadedPlaylists=((H=f.downloadedPlaylists)!=null?H:[]).concat(l)):A!=="musicAlbumRelease"||(n=f.downloadedAlbumReleases)!=
null&&n.includes(l)||(f.downloadedAlbumReleases=((m=f.downloadedAlbumReleases)!=null?m:[]).concat(l));return g.v(h,qm(R,f,"musicDownloadsLibraryEntity"),0)})},NeU=function(R,l){var y,f,A,K,G,B,H;
return g.w(function(n){if(n.X==1)return y=g.tx("music_downloads_library_id","musicDownloadsLibraryEntity"),g.v(n,t3(R,y,"musicDownloadsLibraryEntity"),2);f=n.Z;if(!f)return n.bQ(0);A=g.qU(l).entityType;A==="musicTrack"?K=f.downloadedTracks:A==="musicPlaylist"&&(K=f.downloadedPlaylists);if((G=K)==null?0:G.length)for(B=0;B<K.length;B++)if(H=K[B],H===l){K.splice(B,1);break}return g.v(n,qm(R,f,"musicDownloadsLibraryEntity"),0)})},pGU=function(R){var l=R.videos;
R=[];var y=[];if(l){l=g.u(l);for(var f=l.next();!f.done;f=l.next()){var A=f.value.offlineVideoData.videoId;f=g.tx(A,"musicTrack");A=g.tx(A,"musicTrackDownloadMetadataEntity");R.push(f);y.push(A)}}return{bL:R,y5:y}},Xk=function(R,l,y){l={track:xlD(l)};
y&&(l.playlistId=y);if(R=g.k(R.actionMetadata,Ult))l.maximumDownloadQuality=R.maximumDownloadQuality;return{musicTrackEntityActionMetadata:l}},j28=function(R){var l,y,f,A,K,G,B,H;
return g.w(function(n){switch(n.X){case 1:return l=g.gh(),y=U_A(R),f=g.ML(SPD),g.$7(n,2),K={fN:!0},g.v(n,g.xr(l,y,f,void 0,K),4);case 4:A=n.Z;g.XZ(n,3);break;case 2:G=g.TT(n);if(G instanceof g.D3)throw B="GetOffline network manager error: "+G.message,fB(B,G),Error(B);fB("GetOffline fetch request error",G);throw Error("GetOffline fetch request error");case 3:H=Ty(A);if(!A)throw fB("Network request failed"),Error("Network request failed");if(H!==void 0)dK(H);else if(!A.videos||!A.videos.length)throw fB("No data"),
Error("No data");return n.return(A.videos.map(function(m){return m.offlineVideoData}))}})},kNr=function(R){var l,y,f,A,K,G,B,H;
return g.w(function(n){switch(n.X){case 1:return l=g.gh(),y=STO(R),f=g.ML(SPD),g.$7(n,2),K={fN:!0},g.v(n,g.xr(l,y,f,void 0,K),4);case 4:A=n.Z;g.XZ(n,3);break;case 2:G=g.TT(n);if(G instanceof g.D3)throw B="GetOffline network manager error for playlist: "+G.message,fB(B,G),Error(B);fB("GetOffline fetch request error for playlist",G);throw Error("GetOffline fetch request error for playlist");case 3:H=Ty(A);if(!A)throw fB("Network request failed for playlist"),Error("Network request failed for playlist");
if(H!==void 0)dK(H,"playlist");else if(!A.playlists||!A.playlists.length)throw fB("No data for playlist"),Error("No data for playlist");return n.return(A.playlists.map(function(m){return m.offlinePlaylistData}))}})},Z3K=function(R,l,y,f){var A,K,G,B,H,n,m,h,c,E,W,Q,e,r,d,z,N,D,t,C,Ac,Bi,ar,nk,Y,Pi,wq,Rt,pX,O5;
return g.w(function(pk){switch(pk.X){case 1:return g.v(pk,Mm(),2);case 2:A=pk.Z;if(!A)return pk.return([]);K=[];if((G=f)==null?0:G.length){K=f;pk.bQ(3);break}return g.v(pk,Yj(A,"mainPlaylistEntity"),4);case 4:K=pk.Z;case 3:if(!K.length)return pk.return([]);B=[];H=Date.now()/1E3;n=g.u(K);m=n.next();case 5:if(m.done)return B.length?g.v(pk,Dld(B),10):pk.return([]);h=m.value;if(!h.downloadState){c=void 0;pk.bQ(8);break}return g.v(pk,t3(A,h.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:c=
pk.Z;case 8:E=c;W=void 0;e=(Q=(W=h)==null?void 0:W.entityMetadata)&&Q.nextAutoRefreshIntervalSeconds?Number(Q.nextAutoRefreshIntervalSeconds):NaN;r=Number.isNaN(e)?R:e;z=d=void 0;N=((d=E)==null?0:d.lastSyncedTimestampMillis)?Number((z=E)==null?void 0:z.lastSyncedTimestampMillis)/1E3:0;t=D=void 0;C=((D=E)==null?0:D.addedTimestampMillis)?Number((t=E)==null?void 0:t.addedTimestampMillis)/1E3:0;if(y||!Q||N+r<=H){Ac=[];Bi=void 0;if((Bi=h.videos)==null?0:Bi.length)for(ar=g.u(h.videos),nk=ar.next();!nk.done;nk=
ar.next())Y=nk.value,Pi=JSON.parse(g.qU(Y).entityId),Pi.videoId&&Ac.push(Pi.videoId);wq="0";Q&&(Rt=void 0,wq=String(Number((Rt=Q.offlineLastModifiedTimestampSeconds)!=null?Rt:0).toFixed()));pX={playlistId:h.playlistId,videoIds:Ac,offlineLastModifiedTimestamp:wq,autoSync:l,offlineDateAddedTimestamp:String(C.toFixed())};B.push(pX)}m=n.next();pk.bQ(5);break;case 10:return O5=pk.Z,pk.return(O5)}})},JRU=function(){var R,l,y,f,A;
return g.w(function(K){if(K.X==1)return g.v(K,Mm(),2);if(K.X!=3)return(R=K.Z)?g.v(K,Yj(R,"refresh"),3):K.return(!1);l=K.Z;if((y=l[0])==null||!y.refreshTime)return K.return(!1);f=Number(l[0].refreshTime);A=Date.now()/1E3;return K.return(isFinite(f)&&A>=f)})},V1d=function(R,l){var y,f,A;
return g.w(function(K){switch(K.X){case 1:return g.$7(K,2),g.v(K,glS(R,l),4);case 4:return f=K.Z,g.v(K,$lr(f),5);case 5:y=b3D(f);g.XZ(K,3);break;case 2:A=g.TT(K),fB("getAndProcessSmartDownloadsResponse request or processing error",A);case 3:return K.return(y)}})},CGK=function(R,l,y,f){var A,K,G,B,H,n,m,h,c,E,W,Q,e,r,d,z,N,D,t,C,Ac,Bi,ar,nk,Y,Pi,wq,Rt,pX,O5;
return g.w(function(pk){switch(pk.X){case 1:return g.v(pk,Mm(),2);case 2:A=pk.Z;if(!A)return pk.return([]);K=[];if((G=f)==null?0:G.length){K=f;pk.bQ(3);break}return g.v(pk,Yj(A,"musicPlaylist"),4);case 4:K=pk.Z;case 3:if(!K.length)return pk.return([]);B=[];H=Date.now()/1E3;n=g.u(K);m=n.next();case 5:if(m.done)return B.length?g.v(pk,Dld(B),10):pk.return([]);h=m.value;c=void 0;W=(E=(c=h)==null?void 0:c.entityMetadata)&&E.nextAutoRefreshIntervalSeconds?Number(E.nextAutoRefreshIntervalSeconds):NaN;Q=
Number.isNaN(W)?R:W;r=e=0;d="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!h.downloadMetadata){pk.bQ(8);break}return g.v(pk,t3(A,h.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:z=pk.Z,D=N=void 0,e=Number((D=(N=z)==null?void 0:N.addedTimestampMillis)!=null?D:"0")/1E3,C=t=void 0,r=Number((C=(t=z)==null?void 0:t.lastModifiedTimestampMillis)!=null?C:"0")/1E3,Bi=Ac=void 0,d=(Bi=(Ac=z)==null?void 0:Ac.syncState)!=null?Bi:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:ar=void 0;if(y||d!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!E||Number((ar=E.lastSyncedTimestampSeconds)!=null?ar:0)+Q<=H){nk=[];Y=void 0;if((Y=h.tracks)==null?0:Y.length)for(Pi=g.u(h.tracks),wq=Pi.next();!wq.done;wq=Pi.next())Rt=wq.value,nk.push(g.qU(Rt).entityId);pX={playlistId:h.playlistId,videoIds:nk,offlineLastModifiedTimestamp:String(r.toFixed()),autoSync:l,offlineDateAddedTimestamp:String(e.toFixed())};B.push(pX)}m=n.next();pk.bQ(5);break;case 10:return O5=pk.Z,pk.return(O5)}})},glS=function(R,l){var y,f,A,K,G,B,H,n,m,h;
return g.w(function(c){switch(c.X){case 1:return y=g.gh(),g.v(c,Mm(),2);case 2:f=c.Z;if(!f){c.bQ(3);break}return g.v(c,VfK(f),4);case 4:A=c.Z;case 3:var E=A;K={context:g.qL(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:R},offlineClientState:E,clientStateRequestData:{preferredFormatType:l}}}};G=g.ML(qPZ);g.$7(c,5);H={fN:!0};return g.v(c,g.xr(y,K,G,void 0,H),7);case 7:B=c.Z;g.XZ(c,6);break;case 5:n=g.TT(c);if(n instanceof g.D3)throw m=
"DPS network manager error for smart downloads: "+n.message,fB(m,n),Error(m);fB("DPS fetch request error for smart downloads",n);throw Error("DPS fetch request error for smart downloads");case 6:h=Ty(B);if(B)h!==void 0&&dK(h,"smart downloads");else throw fB("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return c.return(B)}})},YPD=function(R,l){var y,f,A,K,G,B,H,n;
return g.w(function(m){switch(m.X){case 1:return y=g.gh(),f={context:g.qL(),videoPlaybackPositionEntities:R,lastSyncTimestampUsec:l},A=g.ML(t1d),g.$7(m,2),G={fN:!0},g.v(m,g.xr(y,f,A,void 0,G),4);case 4:K=m.Z;g.XZ(m,3);break;case 2:B=g.TT(m);if(B instanceof g.D3)throw H="VPPS network manager error: "+B.message,fB(H,B),Error(H);fB("VPPS fetch request error",B);throw Error("VPPS fetch request error");case 3:n=Ty(K);if(K)n!==void 0&&dK(n,"position sync");else throw fB("Network request failed for position sync"),
Error("Network request failed for position sync");return m.return(K)}})},RWO=function(R,l,y){var f,A,K,G,B,H,n,m;
return g.w(function(h){switch(h.X){case 1:f=g.gh();var c=y.refreshData,E=y.isEnqueuedForExpiredStreamUrlRefetch,W=y.M7,Q=y.offlineSourceData,e=y.mediaCapabilities,r={entityKey:R};c&&(r.refreshData=c);E&&(r.isExpiredStreamUrlRefetch=E);W&&(r.downloadParameters=W);Q&&(r.offlineSourceData=Q);c={context:g.oE(l),signatureTimestamp:20249,videos:[r]};e&&(c.mediaCapabilities=e);A=c;K=g.ML(M1K);g.$7(h,2);B={fN:!0};return g.v(h,g.xr(f,A,K,void 0,B),4);case 4:G=h.Z;g.XZ(h,3);break;case 2:H=g.TT(h);if(H instanceof
g.D3)throw n="GetPDE network manager error: "+H.message,fB(n,H),Error(n);fB("GetPDE fetch request error",H);throw Error("GetPDE fetch request error");case 3:m=Ty(G);if(G)m!==void 0&&dK(m,"PDE");else throw fB("Network request failed for PDE"),Error("Network request failed for PDE");return h.return(G)}})},Ty=function(R){var l;
return(l=R.errorMetadata)==null?void 0:l.status},dK=function(R,l){l=l?" for "+l:"";
if(R===0)throw R="Empty response body"+l,fB(R),Error(R);R="Response with error"+l;fB(R);throw Error(R);},Dld=function(R){var l,y,f,A,K,G,B,H;
return g.w(function(n){switch(n.X){case 1:return l=g.gh(),y=juU(R),f=g.ML(lFr),g.$7(n,2),K={fN:!0},g.v(n,g.xr(l,y,f,void 0,K),4);case 4:A=n.Z;g.XZ(n,3);break;case 2:G=g.TT(n);if(G instanceof g.D3)throw B="offlinePlaylistSyncCheck network manager error: "+G.message,fB(B,G),Error(B);fB("offlinePlaylistSyncCheck fetch request error",G);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:H=Ty(A);if(!A)throw fB("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(H!==void 0)dK(H,"playlist sync");else if(!A.offlinePlaylistSyncCheckDatas||!A.offlinePlaylistSyncCheckDatas.length)throw fB("No data for playlist sync"),Error("No data for playlist sync");return n.return(A.offlinePlaylistSyncCheckDatas.map(function(m){return m.offlinePlaylistSyncCheckData}))}})},rK=function(R){this.Z=R},yIO=function(R,l){var y,f,A,K,G,B;
return g.w(function(H){switch(H.X){case 1:y=new Map,f=g.u(l),A=f.next();case 2:if(A.done){H.bQ(4);break}K=A.value;G=y;B=G.set;return g.v(H,R.X(K),5);case 5:B.call(G,K,H.Z);A=f.next();H.bQ(2);break;case 4:return H.return(y)}})},vj=function(R,l,y,f,A,K){l=g.tx(l,y);
f=Object.assign({},K,{priority:f,retryScheduleIntervalsInSeconds:A});return{actionType:R,entityKey:l,actionMetadata:f}},zy=function(R,l,y,f,A,K){this.status=R;
this.Z=l;this.Y=y;this.X=f;this.L=A;this.downloadState=K},fFZ=function(R,l,y){this.Z=R;
this.Zq=l;this.L=y},GS5=function(R,l){var y,f,A,K,G,B,H,n,m;
return g.w(function(h){switch(h.X){case 1:return y=l.entityKey,A=(f=g.k(l.actionMetadata,wK))==null?void 0:f.isEnqueuedForExpiredStreamUrlRefetch,g.$7(h,2),K=void 0,g.v(h,AID(R,l),4);case 4:K=h.Z;g.$7(h,5);var c=(c=g.k(l.actionMetadata,wK))?{maximumDownloadQuality:c.maximumDownloadQuality}:void 0;return g.v(h,RWO(y,R.Zq,{isEnqueuedForExpiredStreamUrlRefetch:A,M7:c,offlineSourceData:K}),7);case 7:G=h.Z;g.XZ(h,6,2);break;case 5:return g.TT(h,2),B=Bj(l)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",fB("PDE handleAdd error"),h.return(xp(l,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",B,"DOWNLOAD_STATE_FAILED"));case 6:return g.v(h,KjZ(R,G,l),8);case 8:return h.return(xp(l,!0,G.orchestrationActions));case 2:return H=g.TT(h),n="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",H instanceof g.cx&&H.type==="QUOTA_EXCEEDED"&&(n="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
m="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),fB("PDE handleAdd error"),h.return(xp(l,!1,void 0,n,m,"DOWNLOAD_STATE_FAILED"))}})},BUO=function(R,l){var y,f,A,K,G,B,H,n,m,h,c,E,W,Q,e,r,d,z,N,D,t,C,Ac,Bi;
return g.w(function(ar){switch(ar.X){case 1:return y=l.entityKey,f=g.qU(y).entityId,g.v(ar,Ct(R.Z,{mode:"readonly",CA:!0},function(nk){var Y=js(nk,y,"playbackData"),Pi=js(nk,g.tx(f,"offlineVideoPolicy"),"offlineVideoPolicy");nk=js(nk,g.tx(f,"transfer"),"transfer");return g.ud.all([Y,Pi,nk])}),2);
case 2:A=ar.Z;K=g.u(A);G=K.next().value;B=K.next().value;H=K.next().value;n=G;m=B;h=H;if(!n||!m)return ar.return(xp(l,!0));c=[];Q=((W=n)==null?0:W.playerResponseJson)?JSON.parse(n.playerResponseJson):null;if(!(h&&Q&&R.Zq.C("html5_refresh_deprecated_downloads"))){ar.bQ(3);break}E=aFK(R,Q,h);return g.v(ar,sjU(R,h),4);case 4:c=ar.Z;case 3:e={lastPlayerResponseTimestampSeconds:n.playerResponseTimestamp,offlineToken:m.offlineToken,formatIds:c};r={};if((d=h)==null?0:d.maximumDownloadQuality)r.maximumDownloadQuality=
h.maximumDownloadQuality;g.$7(ar,5);z=void 0;return g.v(ar,AID(R,l),7);case 7:return z=ar.Z,g.$7(ar,8),g.v(ar,RWO(y,R.Zq,{refreshData:e,M7:r,offlineSourceData:z,mediaCapabilities:E}),10);case 10:N=ar.Z;g.XZ(ar,9,5);break;case 8:return g.TT(ar,5),D=Bj(l)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",fB("PDE handleRefresh error"),ar.return(xp(l,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",D,
"DOWNLOAD_STATE_FAILED"));case 9:return g.v(ar,KjZ(R,N,l),11);case 11:return ar.return(xp(l,!0,N.orchestrationActions));case 5:return t=g.TT(ar),C="PDE handleRefresh error",t instanceof Error&&(C="PDE handleRefresh error: "+t.message),Ac="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Bi="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t instanceof g.cx&&t.type==="QUOTA_EXCEEDED"&&(Ac="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Bi="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
fB(C),ar.return(xp(l,!1,void 0,Ac,Bi,"DOWNLOAD_STATE_FAILED"))}})},AID=function(R,l){var y,f,A,K;
return g.w(function(G){if(G.X==1)return y=g.qU(l.entityKey).entityId,f=g.tx(y,"videoDownloadContextEntity"),g.v(G,t3(R.Z,f,"videoDownloadContextEntity"),2);A=G.Z;return(K=A)!=null&&K.offlineModeType?G.return({offlineModeType:A.offlineModeType}):G.return(void 0)})},KjZ=function(R,l,y){var f,A,K,G,B;
return g.w(function(H){if(H.X==1){if(!l.frameworkUpdates||!g.k(l.frameworkUpdates,Fk))return H.return();if(!(g.k(l.frameworkUpdates,Fk).mutations&&g.k(l.frameworkUpdates,Fk).mutations.length>0&&g.k(l.frameworkUpdates,Fk).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return H.bQ(2);f=g.qU(g.k(l.frameworkUpdates,Fk).mutations[0].entityKey).entityId;return g.v(H,Qw(R.Z,f),3)}if(H.X!=2){A=H.Z;K=g.k(y.actionMetadata,wK);if(B=(G=K)==null?void 0:G.playlistId)A.playlistId=B;A.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Hm(R.Zq)?g.v(H,uB(f,R.Z,y,R.L,A),2):g.xi(R.Zq)?g.v(H,$p(f,R.Z,y,R.L),2):H.bQ(2)}return g.v(H,r_r(g.k(l.frameworkUpdates,Fk)),0)})},xp=function(R,l,y,f,A,K){return new zy(l?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Bj(R),y,f,A,K)},aFK=function(R,l,y){l=ElK(R.Zq,y.cotn,l);
y=g.up(l);return g.YAK(l,y,R.Zq)},sjU=function(R,l){var y,f,A,K,G,B,H,n,m,h,c;
return g.w(function(E){if(E.X==1)return y=[],g.v(E,Ct(R.Z,{mode:"readonly",CA:!0},function(W){var Q=[],e=l.offlineVideoStreams;if(e){e=g.u(e);for(var r=e.next();!r.done;r=e.next())Q.push(js(W,r.value,"offlineVideoStreams"))}return g.ud.all(Q)}),2);
if(f=E.Z)for(A=g.u(f),K=A.next();!K.done;K=A.next())if(G=K.value,B=void 0,(B=G)==null?0:B.streamsProgress)for(H=G.streamsProgress,n=0;n<H.length;n++)m=H[n],h=JSON.parse(m.formatStreamBytes),c={itag:h.itag,lmt:h.lastModified,xtags:h.xtags},y.push(c);return E.return(y)})},HzK=function(R,l){this.Z=R;
this.Zq=l},nAA=function(R,l){var y,f,A,K,G,B,H,n,m,h,c,E;
return g.w(function(W){switch(W.X){case 1:return y=Bj(l),g.v(W,Yj(R.Z,"videoPlaybackPositionEntity"),2);case 2:f=W.Z;if(f.length===0)return W.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));g.$7(W,3);return g.v(W,pt.getInstance(),5);case 5:A=W.Z;if(!A)throw Error("prefStorage is undefined");return g.v(W,A.get("psi"),6);case 6:return K=W.Z,H=(B=(G=K)==null?void 0:G.Qn)!=null?B:"0",g.v(W,YPD(f,H),7);case 7:return n=W.Z,m={isPaused:n.watchHistoryPaused,Qn:n.syncTimestampUsec},g.v(W,A.set("psi",
m),8);case 8:if(m.isPaused){W.bQ(9);break}h=g.k(n.frameworkUpdates,Fk);if(!n.frameworkUpdates||!h){W.bQ(9);break}return g.v(W,r_r(h),9);case 9:g.XZ(W,4);break;case 3:return c=g.TT(W),E="PPE handleRefresh error: "+(c instanceof Error?c.message:"unknown error"),fB(E),W.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return W.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y))}})},oAX=function(R,l){var y,f,A,K,G,B,H,n;
return g.w(function(m){switch(m.X){case 1:return y=Bj(l),f=g.qU(l.entityKey).entityId,g.$7(m,2),g.v(m,pt.getInstance(),4);case 4:A=m.Z;if(!A)throw Error("prefStorage is undefined");return g.v(m,A.get("psi"),5);case 5:K=m.Z;G=g.k(l.actionMetadata,mTt);if(((B=K)==null?void 0:B.isPaused)!==!1||(H=G)==null||!H.lastPlaybackPositionSeconds){m.bQ(6);break}n={key:g.tx(f,"videoPlaybackPositionEntity"),videoId:f,lastPlaybackPositionSeconds:G.lastPlaybackPositionSeconds};return g.v(m,qm(R.Z,n,"videoPlaybackPositionEntity"),
6);case 6:g.XZ(m,3);break;case 2:return g.TT(m),m.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return m.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y))}})},hWK=function(R,l){var y,f,A;
return g.w(function(K){switch(K.X){case 1:y=Bj(l);g.$7(K,2);f=g.qU(l.entityKey).entityId;if(f==="!*$_ALL_ENTITIES_!*$")return g.v(K,ead(R.Z),5);A=g.tx(f,"videoPlaybackPositionEntity");return g.v(K,$_D(R.Z,A),5);case 5:g.XZ(K,3);break;case 2:return g.TT(K),K.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return K.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y))}})},cIr=function(R,l){this.api=R;
this.Z=l;this.logger=new g.WC("woffle");this.X=!1;this.yu={tK:this.tK};this.logger.debug("Initialized OfflineMediaManager")},EAt=function(R){return g.w(function(l){return l.return(pKO(R))})},Wj8=function(R){var l;
return g.w(function(y){if(y.X==1)return g.v(y,g.bWi(R),2);l=y.Z;return y.return(l.filter(function(f){return!!f.url}).map(function(f){return f.url}))})},I5=function(R,l){var y=g.Zv(l);
if(y===1||y===0)return Promise.resolve();(y=Ljd(R,l))&&y.stopVideo();R.L=0;return EAt(l)},N8=function(R,l,y,f){y=y===void 0?!1:y;
f=f===void 0?!0:f;var A=typeof l==="string"?l:l.videoDetails.videoId;g.Zv(A)===2&&((l=Ljd(R,A))?l.stopVideo():R.logger.info(function(){return"Corresponding player for "+A+" not found. Pausing anyway"}),g.Jn(A,2),R.L=2,y?OzK(R.Z):f&&izU(R.Z))},Ljd=function(R,l){var y;
return((y=R.player)==null?void 0:y.getVideoData().videoId)===l?R.player:null},PwA=function(R,l,y){l.getPlayerResponse();
g.Jn(l.videoId,2);R.L=2;R.X=!1;var f;(f=R.player)==null||f.dispose();R.player=R.api.nh(l);l={};R.player.SQ((l.localmediachange=R.oZ,l.signatureexpired=R.xE,l.statechange=R.qLL,l),R);var A=R.tK(y);R.player.lc(g.Qz(A,A,!0,"m"),!1);R.logger.debug(function(){return"Starting headless playback with quality: "+A});
R.player.A9(!1)},uDA=function(R,l){this.Z=R;
this.Zq=l},Qj8=function(R,l){var y,f;
return g.w(function(A){switch(A.X){case 1:return y=Bj(l),g.v(A,t3(R.Z,l.entityKey,"transfer"),2);case 2:if(f=A.Z)return A.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));g.$7(A,3);return g.v(A,Fjr(R,l),5);case 5:g.XZ(A,4);break;case 3:return g.TT(A),A.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return A.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y))}})},$TK=function(R,l){var y,f;
return g.w(function(A){switch(A.X){case 1:return y=Bj(l),g.v(A,t3(R.Z,l.entityKey,"transfer"),2);case 2:f=A.Z;if(!f||f.transferState!=="TRANSFER_STATE_COMPLETE")return A.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));g.$7(A,3);return g.v(A,Fjr(R,l,!0),5);case 5:g.XZ(A,4);break;case 3:return g.TT(A),A.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return A.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y))}})},eW5=function(R,l){var y,f,A,K,G,B,H,n,m,h;
return g.w(function(c){switch(c.X){case 1:return y=Bj(l),f=g.qU(l.entityKey).entityId,g.v(c,Ct(R.Z,{mode:"readonly",CA:!0},function(E){var W=js(E,l.entityKey,"transfer");E=js(E,g.tx(f,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.ud.all([W,E])}),2);
case 2:A=c.Z;K=g.u(A);G=K.next().value;B=K.next().value;H=G;n=B;if(!H||H.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return c.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));g.$7(c,3);H.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.v(c,qm(R.Z,H,"transfer"),5);case 5:m=g.qU(H.key).entityId;H3t({videoId:m,ly:H,offlineModeType:(h=n)==null?void 0:h.offlineModeType});g.XZ(c,4);break;case 3:return g.TT(c),c.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return c.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y))}})},Fjr=function(R,l,y){y=y===void 0?!1:y;
var f,A,K,G,B,H,n,m,h,c,E,W,Q,e,r;return g.w(function(d){switch(d.X){case 1:return f=g.k(l.actionMetadata,bzX),A=g.qU(l.entityKey).entityId,K=g.tx(A,"downloadStatusEntity"),g.v(d,Ct(R.Z,{mode:"readonly",CA:!0},function(z){var N=js(z,K,"downloadStatusEntity");z=js(z,g.tx(A,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.ud.all([N,z])}),2);
case 2:return G=d.Z,B=g.u(G),H=B.next().value,n=B.next().value,m=H,h=n,c="TRANSFER_STATE_TRANSFER_IN_QUEUE",((E=m)==null?void 0:E.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(c="TRANSFER_STATE_PAUSED_BY_USER"),e={key:l.entityKey,transferState:c,cotn:g.L6(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(W=f)==null?void 0:W.maximumDownloadQuality,preferredAudioTrack:(Q=f)==null?void 0:Q.preferredAudioTrack,transferRetryCount:0,isRefresh:y,hasLoggedFirstStarted:!1},g.v(d,Ct(R.Z,
{mode:"readwrite",CA:!0},function(z){var N=[];y&&N.push(J3(z,g.tx(A,"offlineVideoStreams")));N.push(ZO(z,e,"transfer"));return g.ud.all(N)}),3);
case 3:if(!y){d.bQ(4);break}return g.v(d,EAt(A),4);case 4:s25({videoId:A,ly:e,offlineModeType:(r=h)==null?void 0:r.offlineModeType}),g.Q9(d)}})},TUd=function(R,l,y,f){if(!R.action.entityKey)throw Error("entityKey is missing.");
var A=g.qU(R.action.entityKey);A={entityType:A.pH,entityId:A.entityId,offlineOrchestrationActionType:R.action.actionType,orchestrationAction:{orchestrationActionId:R.actionId}};l&&(A.offlineOrchestrationActionResult=l.status,A.isRetryable=y?!1:l.Z,l.L&&(A.offlineOrchestrationFailureReason=X6D(l.L,A.isRetryable)));var K,G;if((K=R.action.actionMetadata)==null?0:(G=K.offlineLoggingData)==null?0:G.offlineModeType)A.offlineModeType=R.action.actionMetadata.offlineLoggingData.offlineModeType;f&&(A.additionalOrchestrationActions=
f.map(function(B){return{orchestrationActionId:B.actionId}}));
return A},X6D=function(R,l){return R!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||l?R==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&l?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":R:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},dTA=function(R,l){var y={offlineOrchestrationContext:TUd(R)};
l=J_U(l,y);gv5(ZvS(),l,R.rootActionId)},rIU=function(R,l,y,f){f=f===void 0?[]:f;
l={offlineOrchestrationContext:TUd(R,l,y,f)};l=J_U(3,l);gv5(ZvS(),l,R.rootActionId)},vAr=function(){this.actions=[]},zWU=function(R,l){l=g.u(l);
for(var y=l.next();!y.done;y=l.next())y=y.value,dTA(y,1),R.actions.push(y);R.actions.sort(R.Z)},w6X=function(R,l){if(l)for(var y=0;y<R.actions.length;y++)if(l==="!*$_ALL_ENTITIES_!*$"&&R.actions[y].actionId!==l||l!=="!*$_ALL_ENTITIES_!*$"&&R.actions[y].rootActionId===l&&R.actions[y].actionId!==l)R.actions.splice(y,1),y--},xTO=function(R,l){R=g.u(R.actions);
for(var y=R.next();!y.done;y=R.next())if(y.value.actionId===l)return!0;return!1},pB=function(R,l,y,f,A){g.p.call(this);
var K=this;this.X=R;this.xb=l;this.LX=y;this.V=f;this.Zq=A;this.Z=new vAr;this.D=new g.kS;this.L=new g.Vg(function(){K.retry()});
this.W=NaN;this.J=!1;this.yu={Xo4:function(){return K.Z},
Gh:function(){return K.D},
GKX:function(){return K.L},
retry:function(){return K.retry()}};
g.U(this,this.L);this.B=this.X.observe(this.Yb.bind(this))},p6D=function(R,l,y,f,A){var K;
return g.w(function(G){if(G.X==1)return K=new pB(R,l,y,f,A),g.v(G,IF5(K),2);NUd(K);return G.return(K)})},NUd=function(R){var l=R.Z.actions[0];
return R.Y?((l==null?void 0:l.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&R.Y[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(R.J=!0),Promise.resolve()):UT5(R)},UT5=function(R){var l,y,f,A,K,G,B,H,n,m,h,c,E,W,Q,e,r;
return g.w(function(d){switch(d.X){case 1:if(R.Y)throw Error("Already processing an action");if(R.Fx())return d.return();l=R.Z.actions.shift();GNS(R.LX,!l);if(l===void 0)return d.return();l.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&l.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&w6X(R.Z,l.actionId);y="";l.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&l.rootActionId===l.actionId&&(y=l.actionId);f=[l];R.Y=f;if(A=R.xb[l.entityType]){d.bQ(2);break}R.Y=
void 0;return g.v(d,UT5(R),3);case 3:return d.return();case 2:K=g.u(f);for(G=K.next();!G.done;G=K.next())B=G.value,dTA(B,2);g.$7(d,4,5);return g.v(d,yIO(A,f.map(function(z){return z.action})),7);
case 7:H=d.Z,n=g.u(f),m=n.next();case 8:if(m.done){d.bQ(10);break}h=m.value;c=H.get(h.action);return g.v(d,SlD(R,h,c),9);case 9:m=n.next();d.bQ(8);break;case 10:w6X(R.Z,y);case 5:g.zT(d);R.Y=void 0;g.x7(d,6);break;case 4:return E=g.TT(d),fB("Orchestration error",E),g.$7(d,12),g.v(d,jjA(R,f),14);case 14:g.XZ(d,5);break;case 12:W=g.TT(d);fB("Orchestration retry error",W);Q=g.u(f);for(e=Q.next();!e.done;e=Q.next())r=e.value,r.retryScheduleIndex<3&&zWU(R.Z,[r]);d.bQ(5);break;case 6:return g.v(d,UT5(R),
0)}})},SlD=function(R,l,y){var f,A,K,G,B,H,n,m,h,c,E,W;
return g.w(function(Q){switch(Q.X){case 1:f=l.retryScheduleIndex+2===3;if(y.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){Q.bQ(2);break}if(y.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){Q.bQ(0);break}rIU(l,y,f);if(y.Z&&l.retryScheduleIndex+1<3)return g.v(Q,jjA(R,[l]),0);K=((A=y)==null?0:A.X)?y.X:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";G={entityKey:l.action.entityKey,failureReason:K};B=void 0;g.Hm(R.Zq)?B="mainVideoDownloadStateEntity":g.xi(R.Zq)&&(B="musicTrackDownloadMetadataEntity");
if(!B||!y.downloadState){Q.bQ(7);break}H=g.qU(l.action.entityKey).entityId;return g.v(Q,o5(H,B,R.X,y.downloadState),7);case 7:KB(R.V,G);if(y.downloadState==="DOWNLOAD_STATE_FAILED"&&R.Zq.C("html5_auto_retry_failed_pde_actions")){Q.bQ(0);break}fB("Orchestration result is not retryable, deleting action");return g.v(Q,$_D(R.X,OZ(l).key),0);case 2:n=void 0;try{n=(m=y.Y)==null?void 0:m.map(function(e){return R.createAction(e,l)})}catch(e){return rIU(l,y,f),h={entityKey:l.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},KB(R.V,h),fB("Orchestration subactions creation error",e),Q.return()}rIU(l,y,f,n);if(!n){Q.bQ(12);break}c=n.map(function(e){return OZ(e)});
E=0;case 13:if(!(E<n.length)||R.J){Q.bQ(15);break}return g.v(Q,Ct(R.X,{mode:"readwrite",CA:!0},function(e){var r=[];r.push(c_8(e,c.slice(E,E+10),"offlineOrchestrationActionWrapperEntity"));return g.ud.all(r)}),16);
case 16:E+=10;Q.bQ(13);break;case 15:if(R.J)return R.J=!1,Q.return();case 12:return W=OZ(l),g.v(Q,$_D(R.X,W.key),17);case 17:dTA(l,4),g.Q9(Q)}})},JIK=function(R,l){var y,f,A,K,G,B,H,n,m,h,c,E;
return g.w(function(W){y=[];f=Infinity;A=4E3;K=g.u(l);for(G=K.next();!G.done;G=K.next())B=G.value,H=Number(B.enqueueTimeSec),n=kSr(H),m=B.retryScheduleIndex,h=m!=null&&m>0,n>0&&h?(f=Math.min(f,H),A=Math.min(n,A)):y.push(B);isFinite(f)&&(!R.L.isActive()||f<R.W)&&(R.W=f,R.L.start(A));R.D.DX()||(c=y.length,y=y.filter(function(Q){var e;Q=((e=Q.actionProto)==null?void 0:e.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!DTU.includes(Q)}),E=y.length<c,!R.L.isActive()&&E&&R.L.start(1));
y.length>0&&ZzZ(R,y);return g.v(W,NUd(R),0)})},VCU=function(R){var l,y,f,A,K,G,B;
return g.w(function(H){if(H.X==1)return g.v(H,gAZ(R),2);l=H.Z;y=[];f=g.u(l);for(A=f.next();!A.done;A=f.next())K=A.value,G=g.qU(K.key),B=G.entityId,xTO(R.Z,B)||y.push(K);return g.v(H,JIK(R,y),0)})},kSr=function(R){R=R*1E3-Date.now();
return R>4E3?4E3:R},jjA=function(R,l){var y,f,A;
return g.w(function(K){y=g.u(l);for(f=y.next();!f.done;f=y.next()){A=f.value;var G=void 0,B=void 0,H=((B=A.action)==null?void 0:(G=B.actionMetadata)==null?void 0:G.retryScheduleIntervalsInSeconds)||[1,2,4];G=1;A.retryScheduleIndex<H.length&&(G=H[A.retryScheduleIndex]);A.Z=G*1E3+Date.now();A.retryScheduleIndex++}return g.v(K,Cwd(R,l),0)})},IF5=function(R){var l;
return g.w(function(y){if(y.X==1)return g.v(y,Yj(R.X,"offlineOrchestrationActionWrapperEntity"),2);l=y.Z;return g.v(y,JIK(R,l),0)})},ZzZ=function(R,l){l.length!==0&&l.forEach(function(y){y=LB(y);
y.retryScheduleIndex<3&&zWU(R.Z,[y])})},gAZ=function(R,l){var y;
return g.w(function(f){if(f.X==1)return g.v(f,Yj(R.X,"offlineOrchestrationActionWrapperEntity",l),2);y=f.Z;return f.return(y.filter(vvK))})},Cwd=function(R,l){if(l.length===0)return Promise.resolve([]);
l=l.map(function(y){return OZ(y)});
return Qur(R.X,l)},qlS=function(R){this.VL=R;
this.Z=void 0},tCS=function(R,l){var y,f,A,K;
return g.w(function(G){y=l.videoId;f=!0;if(l.captionTracks.length)A=BrS(l),R.Z=new g.eT(R.VL,l,A);else if(l.lj)K=g.IXK(l),R.Z=new g.Xc(R.VL,l.lj,y,K,l.mN,l.eventId),f=l.mN;else return G.return();return G.return(new Promise(function(B){var H;(H=R.Z)==null||H.wH({W0:function(){return g.w(function(n){if(n.X==1)return g.v(n,R.W0(y,f),2);B();g.Q9(n)})},
fE:function(){}})}))})},Yl5=function(R){var l;
return g.w(function(y){if(y.X==1)return g.v(y,NCX(R),2);l=y.Z;return y.return(!!l&&l.length>0)})},UZ=function(R){g.p.call(this);
this.Z=R;this.X=this.Z.observe(this.L.bind(this))},MCK=function(R,l){var y,f,A,K,G,B,H;
return g.w(function(n){switch(n.X){case 1:if(l.length===0)return n.return([]);y=l.map(function(m){return g.tx(m,"transfer")});
return g.v(n,Yj(R.Z,"transfer",y),2);case 2:f=n.Z;A=f.filter(vvK).map(function(m){return g.qU(m.key).entityId});
K=l.filter(function(m){return A.indexOf(m)===-1});
if(K.length===0)return n.return([]);G=g.u(K);B=G.next();case 3:if(B.done){n.bQ(5);break}H=B.value;return g.v(n,EAt(H),4);case 4:B=G.next();n.bQ(3);break;case 5:return n.return(K)}})},yUK=function(R,l,y,f,A,K){var G,B,H;
return g.w(function(n){G="STREAM_TYPE_UNKNOWN";y.video&&y.audio?(G="STREAM_TYPE_AUDIO_AND_VIDEO",fB("unexpected stream type")):y.video&&!y.audio?G="STREAM_TYPE_VIDEO":!y.video&&y.audio&&(G="STREAM_TYPE_AUDIO");B=g.tx(l,"offlineVideoStreams");H={numBytesDownloaded:A.toFixed(),numTotalBytes:K.toFixed(),streamType:G,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(f),itag:G==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(y.itag):void 0};return g.v(n,Ct(R,{mode:"readwrite",CA:!0},
function(m){var h=js(m,B,"offlineVideoStreams"),c=js(m,g.tx(l,"transfer"),"transfer");return g.ud.all([h,c]).then(function(E){E=g.u(E);var W=E.next().value;E=E.next().value;if(!E)return J3(m,B).then(function(){});
var Q=RnK(W);W=lG5(W,f,H,B);var e=ZO(m,W,"offlineVideoStreams");RnK(W)>Q&&(E.lastProgressTimeMs=Date.now().toString());Q=[e];E.offlineVideoStreams||(E.offlineVideoStreams=[]);E.offlineVideoStreams.indexOf(B)===-1&&(E.offlineVideoStreams.push(B),Q.push(ZO(m,E,"transfer")));return g.ud.all(Q)})}),0)})},fGU=function(R,l){var y,f,A,K,G;
return g.w(function(B){if(B.X==1)return y=g.tx(l,"offlineVideoStreams"),g.v(B,t3(R,y,"offlineVideoStreams"),2);f=B.Z;if(!f||!f.streamsProgress)return B.return();A=g.u(f.streamsProgress);for(K=A.next();!K.done;K=A.next())G=K.value,G.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",G.numTotalBytes!==G.numBytesDownloaded&&(G.numBytesDownloaded=G.numTotalBytes);return g.v(B,qm(R,f,"offlineVideoStreams"),0)})},lG5=function(R,l,y,f){if(R&&R.streamsProgress){f=R;
a:{l=l.itag+";"+l.xtags;for(var A=R.streamsProgress,K=0;K<A.length;K++){var G=JSON.parse(A[K].formatStreamBytes);if(G.itag+";"+G.xtags===l){A[K]=y;y=A;break a}}A.push(y);y=A}f.streamsProgress=y}else R={key:f,streamsProgress:[y]};return R},RnK=function(R){if(R==null?0:R.streamsProgress){var l=0;
R=R.streamsProgress;for(var y=0;y<R.length;y++){var f=R[y];isNaN(Number(f.numBytesDownloaded))?fB("stream progress bytes number invalid"):l+=Number(f.numBytesDownloaded)}return l}return 0},AUU=function(R,l,y,f){g.p.call(this);
var A=this;this.X=R;this.api=l;this.jS=y;this.Yb=f;this.D=new g.kS;this.Y=new g.Vg(function(){A.Z&&A.Z.transferState==="TRANSFER_STATE_TRANSFERRING"&&A.D.DX()&&((A.Z.transferRetryCount||0)<3?N8(A.V,A.J,!1,!1):I5(A.V,A.J.videoDetails.videoId),A.vt("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.LX=this.sL=0;this.B=this.W=!1;this.UL=g.yx(this.api.U().experiments,"html5_transfer_processing_logs_interval");this.v1=new g.QW(this);this.yu={RrU:function(){return A.Y},
HaQ:function(){return A.Yb},
Gh:function(){return A.D}};
this.xb=this.X.observe(this.FV.bind(this));this.V=new cIr(l,this);this.tU=new qlS(l);this.Dq=new UZ(this.X);this.CX=this.D.listen("publicytnetworkstatus-online",this.N1.bind(this));this.P1=this.D.listen("publicytnetworkstatus-offline",this.o6L.bind(this));this.B=this.api.U().C("html5_less_transfer_processing_logs");g.U(this,this.v1);this.v1.N(l,"offlinetransferpause",this.z0U);if(g.Hm(this.api.U()))this.L="mainVideoDownloadStateEntity";else if(g.xi(this.api.U())||g.mQ(this.api.U()))this.L="musicTrackDownloadMetadataEntity"},
KO8=function(R){return g.w(function(l){if(l.X==1)l=g.v(l,x_t(),2);
else{var y=R.Dq;var f=g.Dv();f=Object.keys(f);y=MCK(y,f);l=g.v(l,y,0)}return l})},j_=function(R,l){l=l===void 0?!1:l;
var y;return g.w(function(f){if(f.X==1){if(R.Z)throw Error("Already downloading a video");R.LX=0;R.W=!1;return g.v(f,G8S(R),2)}return f.X!=4?(y=f.Z,anZ(R.jS,!y),y&&R.D.DX()?l?g.v(f,new Promise(function(A){g.h$(A,1E3)}),4):f.bQ(4):(!y&&R.Z&&S_(R),f.bQ(0))):g.v(f,aGU(R,y),0)})},scr=function(R){return g.w(function(l){if(l.X==1)return R.J?g.v(l,I5(R.V,R.J.videoDetails.videoId),3):l.bQ(0);
S_(R);g.Q9(l)})},Bxd=function(R,l){var y,f,A;
return g.w(function(K){switch(K.X){case 1:return g.$7(K,2),(y=!!l.captionTracks.length||!!l.lj)?g.v(K,Yl5(l.videoId),4):K.return();case 4:return(f=K.Z)?K.return():g.v(K,tCS(R.tU,l),5);case 5:g.XZ(K,0);break;case 2:A=g.TT(K),fB("Caption downloading error",A,l.cotn),g.Q9(K)}})},aGU=function(R,l){var y,f,A,K,G,B;
return g.w(function(H){switch(H.X){case 1:if(R.W)return H.return();R.W=!0;R.Z=l;y=g.qU(R.Z.key);f=y.entityId;A=void 0;if(R.Z.transferState==="TRANSFER_STATE_TRANSFERRING")return g.v(H,kp(R,f),7);if(R.Z.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||R.Z.transferRetryCount||R.Z.hasLoggedFirstStarted){H.bQ(3);break}return g.v(H,kp(R,f),5);case 5:return A=H.Z,R.Z.hasLoggedFirstStarted=!0,g.v(H,Hg8(R),6);case 6:BeU({videoId:f,ly:R.Z,offlineModeType:A},void 0,void 0,!0);H.bQ(3);break;case 7:A=H.Z,
sZ({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:f,ly:R.Z,offlineModeType:A});case 3:return g.v(H,n8U(R),8);case 8:return K=null,g.$7(H,9),g.v(H,m35(R,l),11);case 11:K=H.Z;R.J=K;g.XZ(H,10);break;case 9:return G=g.TT(H),fB("error getting player response",G,l.cotn),g.v(H,R.vt("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return H.return();case 10:return B=ElK(R.api.U(),l.cotn,K),g.v(H,Bxd(R,B),13);case 13:return g.v(H,Wj8(B.videoId),
14);case 14:B.ET=H.Z,PwA(R.V,B,l.maximumDownloadQuality),R.Y.start(108E5),g.Q9(H)}})},G8S=function(R){var l,y;
return g.w(function(f){if(f.X==1)return g.v(f,Yj(R.X,"transfer"),2);l=f.Z;y=l.filter(o8A).sort(hnd);return y.length===0?f.return():f.return(y[0])})},n8U=function(R){var l,y,f;
return g.w(function(A){if(A.X==1){if(!R.Z)return DL(R,"onTransferStart"),A.return();R.Y.start(108E5);return g.v(A,ZL(R,"TRANSFER_STATE_TRANSFERRING"),2)}l=R.Z;return(f=((y=l)==null?0:y.key)?g.qU(l.key).entityId:"")&&R.L?g.v(A,o5(f,R.L,R.X,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):A.bQ(0)})},OzK=function(R){var l,y,f,A;
g.w(function(K){switch(K.X){case 1:if(!R.Z){DL(R,"onTransferPausedByUser");K.bQ(2);break}l=R.Z;R.Y.stop();return g.v(K,ZL(R,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:f=((y=l)==null?0:y.key)?g.qU(l.key).entityId:"";if(!f||!R.L){K.bQ(4);break}return g.v(K,o5(f,R.L,R.X,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.v(K,kp(R,f),6);case 6:A=K.Z,nlU({videoId:f,ly:l,offlineModeType:A});case 2:S_(R),j_(R),g.Q9(K)}})},izU=function(R){var l,y,f;
g.w(function(A){if(A.X==1){if(!R.Z)return DL(R,"onTransferPausedByNetwork"),A.return();R.Y.stop();return g.v(A,ZL(R,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(A.X!=3)return l=R.Z,(f=((y=l)==null?0:y.key)?g.qU(l.key).entityId:"")&&R.L?g.v(A,o5(f,R.L,R.X,"DOWNLOAD_STATE_PAUSED"),3):A.bQ(3);S_(R);g.Q9(A)})},cUK=function(R){var l,y,f,A,K;
g.w(function(G){switch(G.X){case 1:if(!R.Z)return DL(R,"onTransferComplete"),G.return();l=R.Z;R.Y.stop();if(!l||!R.J){G.bQ(2);break}y=ElK(R.api.U(),l.cotn,R.J);return g.v(G,Bxd(R,y),2);case 2:return g.v(G,ZL(R,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:A=((f=l)==null?0:f.key)?g.qU(l.key).entityId:"";if(!A||!R.L){G.bQ(5);break}return g.v(G,o5(A,R.L,R.X,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.v(G,fGU(R.X,A),7);case 7:return g.v(G,kp(R,A),8);case 8:K=G.Z,sZ({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:A,ly:l,offlineModeType:K}),S_(R),j_(R),g.Q9(G)}})},E8K=function(R,l,y){var f,A;
g.w(function(K){switch(K.X){case 1:if(!R.Z)return DL(R,"onTransferProgress: "+l),K.return();if(R.Z.transferState==="TRANSFER_STATE_TRANSFERRING"){K.bQ(2);break}return g.v(K,n8U(R),2);case 2:f=Date.now();if(!(f-R.sL>1E3)){K.bQ(4);break}R.sL=f;return g.v(K,yUK(R.X,y.videoId,y.X,y.Pm,y.bytesDownloaded,y.Z),5);case 5:if(R.B&&!(R.B&&f-R.LX>R.UL)){K.bQ(4);break}R.LX=f;return g.v(K,kp(R,l),7);case 7:A=K.Z,BeU({videoId:l,ly:R.Z,offlineModeType:A},y.bytesDownloaded,y.Z);case 4:R.Y.start(108E5),g.Q9(K)}})},
WOD=function(R){var l=(R.Z.transferRetryCount||0)<3;
l&&(R=R.Z,R.transferRetryCount=(R.transferRetryCount||0)+1);return l},LOd=function(R,l){l=l===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":l;
var y,f,A,K;return g.w(function(G){if(G.X==1)return R.Z||DL(R,"setTransferToFailed: "+l),y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",l==="TRANSFER_FAILURE_REASON_NETWORK"?y="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":l==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.v(G,ZL(R,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",l),2);if(G.X!=3)return KB(R.Yb,{entityKey:(f=R.Z)==null?void 0:f.key,failureReason:y}),
A=R.Z?g.qU(R.Z.key).entityId:"",g.v(G,kp(R,A),3);K=G.Z;var B={videoId:A,ly:R.Z,offlineModeType:K},H=l,n={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};H&&(n.transferFailureReason=H,n.failureReason=mlZ(H));sZ(n,B);g.Q9(G)})},ZL=function(R,l,y,f){var A;
return g.w(function(K){if(K.X==1){if(!R.Z)return DL(R,"saveTransferState: "+l),K.return();R.Z.transferState=l;R.Z.failureReason=f;g.$7(K,2);return g.v(K,Hg8(R,function(G){return y?kj(G,"offlineVideoStreams",R.Z.offlineVideoStreams).then(function(B){for(var H=g.u(B),n=H.next();!n.done;n=H.next())if((n=n.value)&&n.streamsProgress){n=g.u(n.streamsProgress);for(var m=n.next();!m.done;m=n.next())m.value.streamState=y}return c_8(G,B.filter(function(h){return!!h}),"offlineVideoStreams")}):g.ud.resolve(void 0)}),
4)}if(K.X!=2)return g.XZ(K,0);
A=g.TT(K);return A instanceof g.cx&&A.type==="QUOTA_EXCEEDED"?g.v(K,R.vt("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):K.bQ(0)})},Hg8=function(R,l){var y;
return g.w(function(f){if(!R.Z)return f.return();y=R.Z;return g.v(f,Ct(R.X,{mode:"readwrite",CA:!0},function(A){var K=[ZO(A,y,"transfer")];l&&K.push(l(A));return g.ud.all(K)}),0)})},S_=function(R){R.Z=void 0;
R.J=void 0;R.Y.stop()},m35=function(R,l){var y,f,A,K,G;
return g.w(function(B){if(B.X==1)return y=g.qU(l.key),f=y.entityId,A=g.tx(f,"playbackData"),g.v(B,t3(R.X,A,"playbackData"),2);K=B.Z;if((G=K)==null?0:G.playerResponseJson)return B.return(JSON.parse(K.playerResponseJson));throw Error("No PlayerResponse found");})},DL=function(R,l){R.api.T4("woffle",{mcte:l});
fB("missing current transfer entity.")},kp=function(R,l){var y,f,A;
return g.w(function(K){if(K.X==1)return g.v(K,t3(R.X,g.tx(l,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);y=K.Z;return K.return((A=(f=y)==null?void 0:f.offlineModeType)!=null?A:void 0)})},o8A=function(R){return OgU[R.transferState]!==void 0},hnd=function(R,l){var y=OgU[R.transferState],f=OgU[l.transferState];
return y!==f?y-f:Number(R.enqueuedTimestampMs)-Number(l.enqueuedTimestampMs)},Jm=function(R,l){var y=this;
this.Zq=R;this.api=l;this.D=new g.kS;this.J=new g.o2;this.yu={Yc:function(){return y.L.yu.Yc()},
Gh:function(){return y.D},
BaU:function(){return y.L},
wK:function(){return y.wK()},
Tb:function(){return y.Tb()},
xB:function(){return y.xB()},
Fs:function(){return y.Fs()},
Rk:function(){return y.Rk()},
xm:function(f){return y.xm(f)}};
this.L=new fnr(function(){return igX(y)},function(){y.xB()},this.api.n7(),this.api.C.bind(this.api));
this.Z=new Am(this.api);ARD(this.L)},igX=function(R){return g.w(function(l){R.api.KX("onOrchestrationBecameLeader");
return g.v(l,R.Tb(),0)})},utU=function(R){var l,y;
return g.w(function(f){if(f.X==1)return g.v(f,Mm(),2);if(f.X!=3){l=f.Z;if(!l)return fB("PES is undefined"),f.return();R.X=new AUU(l,R.api,R.L,R.Z);y=R.Lj(l);return g.v(f,p6D(l,y,R.L,R.Z,R.Zq),3)}R.V=f.Z;return g.v(f,P0X(R),0)})},P0X=function(R){var l;
return g.w(function(y){switch(y.X){case 1:if(!R.X)return fB("transferManager is undefined"),y.return();if(R.X.Z){y.bQ(2);break}return g.v(y,j_(R.X),2);case 2:if(!R.Zq.C("woffle_enable_main_downloads_library")){y.bQ(4);break}return g.v(y,R.IC(),4);case 4:if(!R.Zq.C("html5_offline_playback_position_sync")){y.bQ(6);break}return g.v(y,R.o3(),7);case 7:return g.v(y,R.xm(864E5),6);case 6:return g.v(y,R.refreshAllStaleEntities(43200,!0),9);case 9:return g.v(y,R.v8(),10);case 10:if(!R.Zq.C("html5_retry_downloads_for_expiration")){y.bQ(11);
break}return g.v(y,R.Rk(),11);case 11:return R.W=g.ch(function(){R.refreshAllStaleEntities(43200,!0);R.v8()},9E5),g.tD(g.Mt(),function(){return R.Fs()}),g.v(y,Mm(),13);
case 13:return l=y.Z,g.v(y,yRU(l),14);case 14:KgA(R.L),g.Q9(y)}})},FOX=function(){var R,l,y,f,A,K;
return g.w(function(G){switch(G.X){case 1:return g.v(G,Mm(),2);case 2:R=G.Z;if(!R)return G.return([]);l=Date.now()/1E3;return g.v(G,Yj(R,"offlineVideoPolicy"),3);case 3:y=G.Z,f=g.u(y),A=f.next();case 4:if(A.done){G.bQ(6);break}K=A.value;if(!(K.expirationTimestamp&&Number(K.expirationTimestamp)<l)){G.bQ(5);break}K.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";K.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.v(G,qm(R,K,"offlineVideoPolicy"),5);
case 5:A=f.next();G.bQ(4);break;case 6:return G.return(y.map(function(B){return B.key}))}})},gK=function(R,l,y,f,A){var K,G,B;
return g.w(function(H){if(H.X==1)return g.v(H,Mm(),2);K=H.Z;if(!K)return H.return([]);G=l.map(function(n){var m=g.tx(n,y);m={actionType:f,entityKey:m,actionMetadata:Object.assign({},WgU(),A)};f!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(m.actionMetadata.priority=0);n=new Wj(y,n,m);return OZ(n)});
B=Qur(K,G);ARD(R.L);return H.return(B)})},QcK=function(R,l,y,f){var A,K,G,B,H,n,m,h;
return g.w(function(c){switch(c.X){case 1:A=[],K=g.u(l),G=K.next();case 2:if(G.done){c.bQ(4);break}B=G.value;if(B.upToDate||y&&!B.shouldAutoSyncMetadata||!B.playlistId){c.bQ(3);break}H={};switch(f){case "mainPlaylistEntity":n={nextAutoRefreshIntervalSeconds:B.checkInSeconds,autoSync:y};H={mainPlaylistEntityActionMetadata:n};break;case "musicPlaylist":m={autoSync:y},H={musicPlaylistEntityActionMetadata:m}}return g.v(c,gK(R,[B.playlistId],f,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",H),6);case 6:(h=
c.Z)&&A.push.apply(A,g.ci(h));case 3:G=K.next();c.bQ(2);break;case 4:return c.return(A)}})},$3A=function(R,l){var y;
return g.w(function(f){return l.length?(y=WgU(),g.x$(y,wK,{isEnqueuedForExpiredStreamUrlRefetch:!0}),R.api.T4("qrd",{v:l.length}),f.return(gK(R,l,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",y))):f.return([])})},enK=function(R,l,y){this.Z=R;
this.Zq=l;this.L=y},TxX=function(R,l){var y,f,A,K,G,B,H,n,m,h,c,E,W,Q,e,r,d;
return g.w(function(z){switch(z.X){case 1:return y=Bj(l),f=g.qU(l.entityKey),A=f.entityId,K=[],g.$7(z,2),g.v(z,bgZ(R,A),4);case 4:K=z.Z;if(!(R.Zq.C("woffle_enable_main_downloads_library")&&((G=K)==null?0:G.length))){z.bQ(5);break}return g.v(z,dl8(R.Z,[l.entityKey]),5);case 5:g.XZ(z,3);break;case 2:return B=g.TT(z),H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",n="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.cx&&B.type==="QUOTA_EXCEEDED"?(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
n="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):fB("Playlist add error"),z.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,H,n));case 3:m=[];if(!R.Zq.C("html5_offline_prevent_redownload_downloaded_video")){z.bQ(7);break}return g.v(z,cRK(R.Z,"mainVideoEntity",K),8);case 8:K=z.Z;case 7:if((h=K)==null?0:h.length)for(c=g.u(K),E=c.next();!E.done;E=c.next())if(W=E.value,Q=W.offlineVideoData,e=void 0,(e=Q)==null?0:e.videoId)r=void 0,d=Number(((r=l.actionMetadata)==null?void 0:r.priority)||
0)+1,m.push(vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Q.videoId,"mainVideoEntity",d,Vw,XJK(l,Q,A)));return z.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,m))}})},rUA=function(R,l){var y,f,A,K,G,B,H,n,m,h,c,E,W,Q,e,r,d,z,N,D,t,C,Ac,Bi,ar,nk,Y,Pi,wq,Rt,pX,O5,pk,tK,c8,DU,lN,T,IL,rO,fk,XS,F,y9,Dc,KG,U5,gq,Y7,q5,N5,b,P,X,x,S,ms,J,Rr,I,vi,k7,sY,H8,dq,FZ,YJ,Qr,It,bj,P0,rq,v8,$U;
return g.w(function(aL){switch(aL.X){case 1:return y=Bj(l),f=l.entityKey,A=g.qU(f).entityId,K=[],G=!1,A==="!*$_ALL_ENTITIES_!*$"?(G=!0,g.v(aL,Yj(R.Z,"mainPlaylistEntity"),5)):g.v(aL,t3(R.Z,f,"mainPlaylistEntity"),4);case 4:(B=aL.Z)&&K.push(B);aL.bQ(3);break;case 5:K=aL.Z;case 3:if((H=K)==null||!H.length)return aL.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));n=g.k(l.actionMetadata,d3r);h=(m=n)==null?void 0:m.nextAutoRefreshIntervalSeconds;E=(c=n)==null?void 0:c.autoSync;W=[];e=Q=
!0;r=!1;if(!G&&E===!1){aL.bQ(6);break}g.$7(aL,7);return g.v(aL,Z3K(0,!!E,!0,K),9);case 9:W=aL.Z;g.XZ(aL,8);break;case 7:d=g.TT(aL);if(!(d instanceof Error&&d.message==="No data")){d instanceof Error&&d.message==="Empty response body"&&fB(d.message);aL.bQ(8);break}return A==="!*$_ALL_ENTITIES_!*$"?g.v(aL,Q2K(R.Z,l,R.L,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.v(aL,ud8(A,R.Z,l,R.L),8);case 8:if(!W.length||!G&&W[0].playlistId!==A)return aL.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y));case 6:if(G){z=[];N=g.u(W);for(D=N.next();!D.done;D=N.next())t=D.value,t.upToDate||E&&!t.shouldAutoSyncMetadata||!t.playlistId||(C={nextAutoRefreshIntervalSeconds:t.checkInSeconds,autoSync:E},z.push(vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",t.playlistId,"mainPlaylistEntity",0,Vw,{mainPlaylistEntityActionMetadata:C})));return aL.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,z))}W.length&&(Ac=W[0],r=!!Ac.upToDate,E&&(Q=(Bi=Ac.shouldAutoSyncMetadata)!=null?Bi:!0,e=(ar=Ac.shouldAutoSyncVideos)!=
null?ar:!0,Ac.checkInSeconds&&(h=Ac.checkInSeconds)));if(r||!Q)return aL.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));nk=[];Y=K[0];if(!Y.downloadState){Pi=void 0;aL.bQ(15);break}return g.v(aL,t3(R.Z,Y.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:Pi=aL.Z;case 15:return wq=Pi,pX=((Rt=wq)==null?0:Rt.addedTimestampMillis)?String(wq.addedTimestampMillis):void 0,g.$7(aL,17),g.v(aL,bgZ(R,A,pX,h),19);case 19:nk=aL.Z;g.XZ(aL,18);break;case 17:O5=g.TT(aL);if(!(O5 instanceof
Error&&O5.message==="No data for playlist")){if(O5 instanceof Error&&O5.message==="Empty response body for playlist")fB(O5.message);else return pk="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",tK="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O5 instanceof g.cx&&O5.type==="QUOTA_EXCEEDED"&&(pk="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",tK="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),aL.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,pk,tK));
aL.bQ(18);break}return g.v(aL,ud8(A,R.Z,l,R.L),18);case 18:if(!e)return aL.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));c8=[];DU=new Map;if((lN=nk)==null?0:lN.length)for(T=g.u(nk),IL=T.next();!IL.done;IL=T.next())rO=IL.value,fk=rO.offlineVideoData,XS=void 0,((XS=fk)==null?0:XS.videoId)&&DU.set(fk.videoId,fk);F=new Map;y9=[];if((Dc=Y)==null?0:(KG=Dc.videos)==null?0:KG.length)for(U5=g.u(Y.videos),gq=U5.next();!gq.done;gq=U5.next())if(Y7=gq.value,q5=JSON.parse(g.qU(Y7).entityId),N5=
q5.videoId)DU.has(N5)?(F.set(N5,DU.get(N5)),DU.delete(N5)):y9.push(N5);P=Number(((b=l.actionMetadata)==null?void 0:b.priority)||0)+1;X=g.u(DU.entries());for(x=X.next();!x.done;x=X.next())S=x.value,ms=g.u(S),J=ms.next().value,Rr=ms.next().value,I=J,vi=Rr,c8.push(vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",I,"mainVideoEntity",P,Vw,XJK(l,vi,A)));k7=g.u(F.entries());for(sY=k7.next();!sY.done;sY=k7.next())H8=sY.value,dq=g.u(H8),FZ=dq.next().value,YJ=dq.next().value,Qr=FZ,It=YJ,c8.push(vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Qr,"mainVideoEntity",P,Vw,XJK(l,It,A)));bj=g.u(y9);for(P0=bj.next();!P0.done;P0=bj.next())rq=P0.value,v8={playlistId:A},$U={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:v8},c8.push(vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",rq,"mainVideoEntity",0,Vw,$U));return aL.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,c8))}})},v88=function(R,l){var y,f,A,K;
return g.w(function(G){switch(G.X){case 1:return y=Bj(l),g.$7(G,2),f=g.qU(l.entityKey).entityId,f==="!*$_ALL_ENTITIES_!*$"?g.v(G,Q2K(R.Z,l,R.L,(A=l.actionMetadata)==null?void 0:(K=A.offlineLoggingData)==null?void 0:K.offlineDeleteReason),5):g.v(G,ud8(f,R.Z,l,R.L),6);case 6:if(!R.Zq.C("woffle_enable_main_downloads_library")){G.bQ(5);break}return g.v(G,rRK(R.Z,l.entityKey),5);case 5:g.XZ(G,3);break;case 2:return g.TT(G),G.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return G.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y))}})},bgZ=function(R,l,y,f){var A,K,G,B,H,n,m;
return g.w(function(h){switch(h.X){case 1:return g.v(h,kNr([l]),2);case 2:return A=h.Z,g.v(h,znX(R,A[0],y,f),3);case 3:return K=h.Z,G=K.mainPlaylistEntity,B=K.t_x,n=i38(G,(H=B)==null?void 0:H.avatar),g.$7(h,4),g.v(h,Pj(n),6);case 6:g.XZ(h,5);break;case 4:m=g.TT(h),m instanceof Error&&m.message==="Failed to fetch"&&fB(m.message);case 5:return h.return(A[0].videos)}})},znX=function(R,l,y,f){var A,K,G,B,H,n,m,h,c,E,W,Q,e,r,d,z,N;
return g.w(function(D){switch(D.X){case 1:A=Date.now().toString();y||(y=A);K=l.videos;G=l.playlistId;B=[];H=[];if(K)for(n=g.u(K),m=n.next();!m.done;m=n.next()){h=m.value;c=h.offlineVideoData;if(!c||!c.videoId)throw fB("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");E=c.videoId;W={videoId:E,playlistId:G};Q={id:g.tx(JSON.stringify(W),"mainPlaylistVideoEntity"),video:g.tx(E,"mainVideoEntity")};B.push(Q);H.push(Q.id)}r={key:g.tx(G,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:y,lastSyncedTimestampMillis:A};d={key:g.tx(G,"mainPlaylistEntity"),playlistId:G,videos:H,title:l.title,thumbnailStyleData:wJA(l),visibility:x3K(l),downloadState:r.key};l.channel&&(z=l.channel.offlineChannelData,e=IG5(g.tx(G,"ytMainChannelEntity"),z),d.channelOwner=e.id);((N=d)==null?0:N.entityMetadata)?(d.entityMetadata.offlineLastModifiedTimestampSeconds=l.lastModifiedTimestamp,f&&(d.entityMetadata.nextAutoRefreshIntervalSeconds=String(f))):d&&(d.entityMetadata={nextAutoRefreshIntervalSeconds:f?
String(f):void 0,offlineLastModifiedTimestampSeconds:l.lastModifiedTimestamp});g.$7(D,2);return g.v(D,Ct(R.Z,{mode:"readwrite",CA:!0},function(t){var C=ZO(t,d,"mainPlaylistEntity"),Ac=ZO(t,r,"mainPlaylistDownloadStateEntity");C=[C,Ac];Ac=g.u(B);for(var Bi=Ac.next();!Bi.done;Bi=Ac.next())C.push(ZO(t,Bi.value,"mainPlaylistVideoEntity"));e&&C.push(ZO(t,e,"ytMainChannelEntity"));return g.ud.all(C)}),4);
case 4:g.XZ(D,3);break;case 2:throw g.TT(D),fB("PES failure for playlist"),Error("PES failure for playlist");case 3:return D.return({mainPlaylistEntity:d,t_x:e,CoU:B})}})},IG5=function(R,l){return{id:R,
channelId:l.channelId,title:l.title,avatar:l.thumbnail}},wJA=function(R){var l=[],y=R.videos;
y&&y.length>0&&l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:y[0].offlineVideoData.thumbnail}}});if((R=R.additionalMetadadatas)&&R.length>0)for(R=g.u(R),y=R.next();!y.done;y=R.next()){var f=y.value.offlineBundleItemPlaylistData,A=void 0;y=(A=f)==null?void 0:A.style;A=void 0;f={collageThumbnail:{coverThumbnail:(A=f)==null?void 0:A.coverThumbnail}};switch(y){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:f});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:f});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:f});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":l.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:f})}}return l},x3K=function(R){switch(R.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},XJK=function(R,l,y){l={offlineVideoData:l,
playlistId:y};if(R=g.k(R.actionMetadata,d3r))l.maximumDownloadQuality=R.maximumDownloadQuality;return{mainVideoEntityActionMetadata:l}},NxA=function(R,l,y){this.Z=R;
this.Zq=l;this.L=y},Sv8=function(R,l){var y,f,A,K,G,B,H,n,m,h,c,E,W;
return g.w(function(Q){switch(Q.X){case 1:return y=Bj(l),f=g.qU(l.entityKey),A=f.entityId,K=g.k(l.actionMetadata,CB),B=!((G=K)==null?0:G.playlistId),g.$7(Q,2),g.v(Q,pJK(R,A,void 0,(H=K)==null?void 0:H.offlineVideoData,B),4);case 4:g.XZ(Q,3);break;case 2:return n=g.TT(Q),m="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.cx&&n.type==="QUOTA_EXCEEDED"&&(m="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Q.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,m,h));case 3:c=1;c=Number(((E=l.actionMetadata)==null?void 0:E.priority)||0)+1;var e=(e=g.k(l.actionMetadata,CB))?{playbackDataActionMetadata:{maximumDownloadQuality:e.maximumDownloadQuality}}:void 0;W=vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",A,"playbackData",c,U3X,e);return Q.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,[W]))}})},jcK=function(R,l){var y,f,A,K,G,B,H,n,m,h,c,E,W,Q,e,r,d;
return g.w(function(z){switch(z.X){case 1:return y=Bj(l),f=g.qU(l.entityKey),A=f.entityId,g.v(z,t3(R.Z,l.entityKey,"mainVideoEntity"),2);case 2:K=z.Z;if(!K){G=void 0;z.bQ(3);break}return g.v(z,t3(R.Z,K.downloadState,"mainVideoDownloadStateEntity"),4);case 4:G=z.Z;case 3:B=G;if(!K||!B)return z.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));g.$7(z,5);return g.v(z,pJK(R,A,B.addedTimestampMillis,(n=g.k(l.actionMetadata,CB))==null?void 0:n.offlineVideoData),7);case 7:m=1;m=Number(((h=
l.actionMetadata)==null?void 0:h.priority)||0)+1;H=vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",A,"playbackData",m,U3X);g.XZ(z,6);break;case 5:c=g.TT(z);if(!(c instanceof Error&&c.message==="No data")){if(c instanceof Error&&c.message==="Empty response body")fB(c.message);else return E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.cx&&c.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
W="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),z.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,E,W));z.bQ(6);break}return g.v(z,Qw(R.Z,A),9);case 9:Q=z.Z;e=g.k(l.actionMetadata,CB);if(d=(r=e)==null?void 0:r.playlistId)Q.playlistId=d;Q.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.v(z,uB(A,R.Z,l,R.L,Q),6);case 6:return z.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,H?[H]:void 0))}})},k8Z=function(R,l){var y,f,A,K,G,B,H,n,m,h;
return g.w(function(c){switch(c.X){case 1:return y=Bj(l),g.$7(c,2),f=g.qU(l.entityKey).entityId,f==="!*$_ALL_ENTITIES_!*$"?g.v(c,Q2K(R.Z,l,R.L,(m=l.actionMetadata)==null?void 0:(h=m.offlineLoggingData)==null?void 0:h.offlineDeleteReason),5):g.v(c,Qw(R.Z,f),6);case 6:A=c.Z;K=g.k(l.actionMetadata,CB);if(B=(G=K)==null?void 0:G.playlistId)A.playlistId=B;A.offlineDeleteReason=(H=l.actionMetadata)==null?void 0:(n=H.offlineLoggingData)==null?void 0:n.offlineDeleteReason;return g.v(c,uB(f,R.Z,l,R.L,A),7);
case 7:if(!R.Zq.C("woffle_enable_main_downloads_library")){c.bQ(5);break}return g.v(c,rRK(R.Z,l.entityKey),5);case 5:g.XZ(c,3);break;case 2:return g.TT(c),c.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return c.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y))}})},pJK=function(R,l,y,f,A){var K,G,B,H,n,m;
return g.w(function(h){switch(h.X){case 1:if(K=f){h.bQ(2);break}return g.v(h,j28([l]),3);case 3:G=h.Z,K=G[0];case 2:return g.v(h,D3U(R,K,y,A),4);case 4:B=h.Z;H=B.mainVideoEntity;n=B.channelEntity;g.$7(h,5);var c=EZ(H.thumbnail),E=EZ(n.avatar);return g.v(h,Pj(c.concat(E)),7);case 7:g.XZ(h,0);break;case 5:m=g.TT(h),m instanceof Error&&m.message==="Failed to fetch"&&fB(m.message),g.Q9(h)}})},D3U=function(R,l,y,f){var A,K,G,B,H,n,m,h,c,E,W,Q,e;
return g.w(function(r){switch(r.X){case 1:y||(y=Date.now().toString());K=(A=l.channel)==null?void 0:A.offlineChannelData;G={id:g.tx(l.videoId,"ytMainChannelEntity"),channelId:K.channelId,title:K.title,avatar:K.thumbnail};B={key:g.tx(l.videoId,"mainVideoDownloadStateEntity"),playbackData:g.tx(l.videoId,"playbackData"),addedTimestampMillis:y,videoDownloadContextEntity:g.tx(l.videoId,"videoDownloadContextEntity")};H={key:g.tx(l.videoId,"videoPlaybackPositionEntity"),videoId:l.videoId,lastPlaybackPositionSeconds:"0"};
R.Zq.C("html5_offline_playback_position_sync")&&(n={playbackPosition:H.key});m=g.tx(l.videoId,"mainVideoEntity");h={key:m,videoId:l.videoId,title:l.title,thumbnail:l.thumbnail,localizedStrings:{viewCount:l.shortViewCountText},userState:n,lengthSeconds:l.lengthSeconds?Number(l.lengthSeconds):void 0,publishedTimestampMillis:l.publishedTimestamp?(Number(l.publishedTimestamp)*1E3).toString():void 0,formattedDescription:l.description,owner:G.id,downloadState:B.key};if(!R.Zq.C("woffle_enable_main_downloads_library")||
!f){r.bQ(2);break}return g.v(r,TeK(R.Z,[m]),3);case 3:if(W=r.Z)c=W.mainDownloadsLibraryEntity,E=W.mainDownloadsListEntity;case 2:return e=hx5,Q={key:g.tx(l.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.x$(B,e,Q),g.v(r,Ct(R.Z,{mode:"readwrite",CA:!0},function(d){var z=ZO(d,G,"ytMainChannelEntity"),N=ZO(d,B,"mainVideoDownloadStateEntity"),D=ZO(d,h,"mainVideoEntity");z=[z,N,D];R.Zq.C("html5_offline_playback_position_sync")&&(N=ZO(d,H,"videoPlaybackPositionEntity"),
z.push(N));c&&(N=ZO(d,c,"mainDownloadsLibraryEntity"),z.push(N));E&&(N=ZO(d,E,"mainDownloadsListEntity"),z.push(N));Q&&(d=ZO(d,Q,"downloadStatusEntity"),z.push(d));return g.ud.all(z)}),4);
case 4:return r.return({mainVideoEntity:h,channelEntity:G})}})},ZgD=function(R,l,y){this.Z=R;
this.Zq=l;this.L=y},g8d=function(R,l){var y,f,A,K,G,B,H,n,m,h,c,E,W,Q,e,r,d,z,N,D,t,C,Ac,Bi,ar,nk,Y;
return g.w(function(Pi){switch(Pi.X){case 1:return y=Bj(l),f=[],g.v(Pi,pt.getInstance(),2);case 2:A=Pi.Z;if(!A){Pi.bQ(3);break}return g.v(Pi,A.get("sdois"),4);case 4:return K=Pi.Z,g.v(Pi,(B=A)==null?void 0:B.get("lmqf"),5);case 5:G=Pi.Z;case 3:g.$7(Pi,6);if(K===void 0)throw Error("prefStorage or opt-in state is undefined");H=[];if(K){Pi.bQ(8);break}return g.v(Pi,XGd(R.Z),9);case 9:H=Pi.Z,H.reverse();case 8:if(!H.length){Pi.bQ(10);break}n=g.u(H);m=n.next();case 11:if(m.done){Pi.bQ(10);break}h=m.value;
if(!h){Pi.bQ(12);break}c=g.qU(h).entityId;return g.v(Pi,Qw(R.Z,c),14);case 14:return E=Pi.Z,E.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.v(Pi,uB(c,R.Z,{entityKey:h,actionType:l.actionType},R.L,E),12);case 12:m=n.next();Pi.bQ(11);break;case 10:return g.v(Pi,glS(K,(W=G)!=null?W:"SD"),16);case 16:return Q=Pi.Z,g.v(Pi,$lr(Q),17);case 17:e=b3D(Q);if(!R.Zq.C("woffle_enable_main_downloads_library")){Pi.bQ(18);break}if(K){Pi.bQ(19);break}return g.v(Pi,rRK(R.Z,g.Um),19);case 19:return g.v(Pi,
dl8(R.Z,[g.Um]),18);case 18:if((r=e)==null?0:r.length)for(d=g.u(e),z=d.next();!z.done;z=d.next())if(D=N=z.value,t=D.actionType,C=D.entityKey,Ac=D.actionMetadata,t&&C&&Ac&&!g.k(Ac,JUD)){t==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Ac.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Bi=g.k(N.actionMetadata,CB))Bi.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",N.actionMetadata=Object.assign({},N.actionMetadata,{mainVideoEntityActionMetadata:Bi});f.push(N)}g.XZ(Pi,
7);break;case 6:return ar=g.TT(Pi),nk="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",ar instanceof g.cx&&ar.type==="QUOTA_EXCEEDED"&&(nk="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Pi.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,nk,Y));case 7:return Pi.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,f))}})},VxK=function(){Jm.apply(this,
arguments);
this.B="mainVideoEntity"},C0A=function(R,l,y){l=l===void 0?43200:l;
y=y===void 0?!0:y;var f=f===void 0?!1:f;var A,K,G;return g.w(function(B){switch(B.X){case 1:if(!R.D.DX())return B.return([]);A=[];g.$7(B,2);return g.v(B,Z3K(l,y,f),4);case 4:A=B.Z;g.XZ(B,3);break;case 2:K=g.TT(B),K instanceof Error&&K.message==="No data"||K instanceof Error&&K.message==="Empty response body"&&fB(K.message);case 3:return G=QcK(R,A,y,"mainPlaylistEntity"),B.return(G)}})},qvt=function(R,l,y,f){f=f===void 0?!1:f;
var A,K,G,B,H,n,m,h,c,E,W,Q,e,r,d;return g.w(function(z){switch(z.X){case 1:return A=[],g.v(z,JRU(),2);case 2:return(K=z.Z)||f?g.v(z,V1d(l,y),3):z.return([]);case 3:G=z.Z;if((B=G)==null||!B.length)return z.return([]);H={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};n=g.u(G);m=n.next();case 4:if(m.done){z.bQ(6);break}c=h=m.value;E=c.actionType;W=c.entityKey;Q=c.actionMetadata;if(!(E&&W&&Q)||g.k(Q,JUD)){z.bQ(5);break}E==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Q.offlineLoggingData=
H);e=g.qU(W);r=e.entityId;return g.v(z,gK(R,[r],"mainVideoEntity",E,Q),8);case 8:d=z.Z,A=A.concat(d);case 5:m=n.next();z.bQ(4);break;case 6:return z.return(A)}})},txr=function(R,l){this.Z=R;
this.L=l},MxU=function(R,l){var y,f,A,K,G,B,H,n,m,h,c,E,W,Q,e,r;
return g.w(function(d){switch(d.X){case 1:return y=Bj(l),f=g.qU(l.entityKey),A=f.entityId,K=[],g.$7(d,2),g.v(d,YvX(R,A),4);case 4:K=d.Z;if((G=K)==null||!G.length){d.bQ(5);break}return g.v(d,Int(R.Z,l.entityKey),5);case 5:g.XZ(d,3);break;case 2:return B=g.TT(d),H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",n="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.cx&&B.type==="QUOTA_EXCEEDED"&&(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",n="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
d.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,H,n));case 3:return m=[],g.v(d,cRK(R.Z,"musicTrack",K),7);case 7:K=d.Z;if(K.length)for(h=g.u(K),c=h.next();!c.done;c=h.next())if(E=c.value,W=E.offlineVideoData,Q=void 0,(Q=W)==null?0:Q.videoId)e=void 0,r=Number(((e=l.actionMetadata)==null?void 0:e.priority)||0)+1,m.push(vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",W.videoId,"musicTrack",r,q8,Xk(l,W,A)));return d.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,m))}})},
RRO=function(R,l){var y,f,A,K,G,B,H,n,m,h,c,E,W,Q,e,r,d,z,N,D,t,C,Ac,Bi,ar,nk,Y,Pi,wq,Rt,pX,O5,pk,tK,c8,DU,lN,T,IL,rO,fk,XS,F,y9,Dc,KG,U5,gq,Y7,q5,N5,b,P,X,x,S,ms,J,Rr;
return g.w(function(I){switch(I.X){case 1:return y=Bj(l),f=l.entityKey,A=g.qU(f).entityId,K=[],G=!1,A==="!*$_ALL_ENTITIES_!*$"?(G=!0,g.v(I,Yj(R.Z,"musicAlbumRelease"),5)):g.v(I,t3(R.Z,f,"musicAlbumRelease"),4);case 4:(B=I.Z)&&K.push(B);I.bQ(3);break;case 5:K=I.Z;case 3:if((H=K)==null||!H.length)return I.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));if(G){n=[];m=g.u(K);for(h=m.next();!h.done;h=m.next())c=h.value,E=g.qU(c.id).entityId,n.push(vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
E,"musicAlbumRelease",0,q8));return I.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,n))}W=[];Q=K[0];e=void 0;if(!Q.downloadMetadata){I.bQ(6);break}return g.v(I,t3(R.Z,Q.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:r=I.Z,e=Number((z=(d=r)==null?void 0:d.addedTimestampMillis)!=null?z:"0")/1E3;case 6:return g.$7(I,8),g.v(I,YvX(R,A,(N=e)==null?void 0:N.toString()),10);case 10:W=I.Z;g.XZ(I,9);break;case 8:D=g.TT(I);if(!(D instanceof Error&&D.message==="No data")){if(D instanceof
Error&&D.message==="Empty response body")fB(D.message);else return t="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.cx&&D.type==="QUOTA_EXCEEDED"&&(t="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",C="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),I.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,t,C));I.bQ(9);break}return g.v(I,e_(A,"musicAlbumRelease",R.Z,l,R.L),9);case 9:Ac=[];Bi=new Map;
if((ar=W)==null?0:ar.length)for(nk=g.u(W),Y=nk.next();!Y.done;Y=nk.next())Pi=Y.value,wq=Pi.offlineVideoData,Rt=void 0,((Rt=wq)==null?0:Rt.videoId)&&Bi.set(wq.videoId,wq);pX=new Map;O5=[];if((pk=Q)==null?0:(tK=pk.tracks)==null?0:tK.length)for(c8=g.u(Q.tracks),DU=c8.next();!DU.done;DU=c8.next())if(lN=DU.value,T=g.qU(lN).entityId)Bi.has(T)?(pX.set(T,Bi.get(T)),Bi.delete(T)):O5.push(T);rO=Number(((IL=l.actionMetadata)==null?void 0:IL.priority)||0)+1;fk=g.u(Bi.entries());for(XS=fk.next();!XS.done;XS=fk.next())F=
XS.value,y9=g.u(F),Dc=y9.next().value,KG=y9.next().value,U5=Dc,gq=KG,Ac.push(vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",U5,"musicTrack",rO,q8,Xk(l,gq)));Y7=g.u(pX.entries());for(q5=Y7.next();!q5.done;q5=Y7.next())N5=q5.value,b=g.u(N5),P=b.next().value,X=b.next().value,x=P,S=X,Ac.push(vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",x,"musicTrack",rO,q8,Xk(l,S)));ms=g.u(O5);for(J=ms.next();!J.done;J=ms.next())Rr=J.value,Ac.push(vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Rr,"musicTrack",0,q8));return I.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y,Ac))}})},leU=function(R,l){var y,f;
return g.w(function(A){switch(A.X){case 1:return y=Bj(l),g.$7(A,2),f=g.qU(l.entityKey).entityId,f==="!*$_ALL_ENTITIES_!*$"?g.v(A,bB(R.Z,l,R.L),5):g.v(A,e_(f,"musicAlbumRelease",R.Z,l,R.L),6);case 6:return g.v(A,NeU(R.Z,l.entityKey),5);case 5:g.XZ(A,3);break;case 2:return g.TT(A),A.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return A.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y))}})},YvX=function(R,l,y){var f,A,K;
return g.w(function(G){switch(G.X){case 1:return g.v(G,kNr([l]),2);case 2:return f=G.Z,g.v(G,yZS(R,f[0],y),3);case 3:return A=G.Z,K=EZ(A.thumbnailDetails),g.v(G,Pj(K),4);case 4:return G.return(f[0].videos)}})},yZS=function(R,l,y){var f,A,K,G,B,H,n,m,h,c,E,W,Q,e;
return g.w(function(r){if(r.X==1){f=l.additionalMetadadatas;A=void 0;if(f&&f.length>0)for(K=g.u(f),G=K.next();!G.done;G=K.next())if(B=G.value,B.offlineMusicPlaylistData){A=B.offlineMusicPlaylistData;break}H=l.playlistId;n=pGU(l);m=n.bL;h=n.y5;c=y?(Number(y)*1E3).toString():Date.now().toString();E=l.lastModifiedTimestamp?(Number(l.lastModifiedTimestamp)*1E3).toString():"0";W={id:g.tx(H,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:h,lastModifiedTimestampMillis:E,addedTimestampMillis:c,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};Q={id:g.tx(H,"musicAlbumRelease"),title:l.title,audioPlaylistId:H,trackCount:l.totalVideoCount,tracks:m,downloadMetadata:W.id};A&&(Q.thumbnailDetails=(e=A.albumHqThumbnail)!=null?e:A.albumArtistThumbnail,Q.artistDisplayName=A.albumArtistDisplayName,Q.releaseDate=A.albumReleaseDate,Q.contentRating={explicitType:A.albumReleaseExplicitType},Q.releaseType=A.albumReleaseType);return g.v(r,Ct(R.Z,{mode:"readwrite",CA:!0},function(d){var z=ZO(d,Q,"musicAlbumRelease");
d=ZO(d,W,"musicAlbumReleaseDownloadMetadataEntity");return g.ud.all([z,d])}),2)}return r.return(Q)})},feK=function(R,l){this.Z=R;
this.L=l},K85=function(R,l){var y,f,A,K,G,B,H,n,m,h,c,E,W,Q,e,r;
return g.w(function(d){switch(d.X){case 1:return y=Bj(l),f=g.qU(l.entityKey),A=f.entityId,K=[],g.$7(d,2),g.v(d,AZ8(R,A),4);case 4:K=d.Z;if((G=K)==null||!G.length){d.bQ(5);break}return g.v(d,Int(R.Z,l.entityKey),5);case 5:g.XZ(d,3);break;case 2:return B=g.TT(d),H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",n="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.cx&&B.type==="QUOTA_EXCEEDED"&&(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",n="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
d.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,H,n));case 3:return m=[],g.v(d,cRK(R.Z,"musicTrack",K),7);case 7:K=d.Z;if(K.length)for(h=g.u(K),c=h.next();!c.done;c=h.next())if(E=c.value,W=E.offlineVideoData,Q=void 0,(Q=W)==null?0:Q.videoId)e=void 0,r=Number(((e=l.actionMetadata)==null?void 0:e.priority)||0)+1,m.push(vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",W.videoId,"musicTrack",r,tm,Xk(l,W,A)));return d.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,m))}})},
GDK=function(R,l){var y,f,A,K,G,B,H,n,m,h,c,E,W,Q,e,r,d,z,N,D,t,C,Ac,Bi,ar,nk,Y,Pi,wq,Rt,pX,O5,pk,tK,c8,DU,lN,T,IL,rO,fk,XS,F,y9,Dc,KG,U5,gq,Y7,q5,N5,b,P,X,x,S,ms,J,Rr,I,vi,k7,sY,H8,dq,FZ,YJ,Qr,It,bj,P0;
return g.w(function(rq){switch(rq.X){case 1:return y=Bj(l),f=l.entityKey,A=g.qU(f).entityId,K=[],G=!1,A==="!*$_ALL_ENTITIES_!*$"?(G=!0,g.v(rq,Yj(R.Z,"musicPlaylist"),5)):g.v(rq,t3(R.Z,f,"musicPlaylist"),4);case 4:(B=rq.Z)&&K.push(B);rq.bQ(3);break;case 5:K=rq.Z;case 3:if((H=K)==null||!H.length)return rq.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));n=g.k(l.actionMetadata,Ult);h=(m=n)==null?void 0:m.autoSync;c=[];W=E=!0;Q=!1;e=void 0;if(!G&&h===!1){rq.bQ(6);break}g.$7(rq,7);return g.v(rq,
CGK(0,!!h,!0,K),9);case 9:c=rq.Z;g.XZ(rq,8);break;case 7:r=g.TT(rq);if(!(r instanceof Error&&r.message==="No data")){r instanceof Error&&r.message==="Empty response body"&&fB(r.message);rq.bQ(8);break}return A==="!*$_ALL_ENTITIES_!*$"?g.v(rq,bB(R.Z,l,R.L),8):g.v(rq,e_(A,"musicPlaylist",R.Z,l,R.L),8);case 8:if(!c.length||!G&&c[0].playlistId!==A)return rq.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));case 6:if(G){d=[];z=g.u(c);for(N=z.next();!N.done;N=z.next())D=N.value,D.upToDate||
h&&!D.shouldAutoSyncMetadata||!D.playlistId||(t={autoSync:h},d.push(vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",D.playlistId,"musicPlaylist",0,tm,{musicPlaylistEntityActionMetadata:t})));return rq.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,d))}c.length&&(C=c[0],Q=!!C.upToDate,h&&(E=(Ac=C.shouldAutoSyncMetadata)!=null?Ac:!0,W=(Bi=C.shouldAutoSyncVideos)!=null?Bi:!0,C.checkInSeconds&&(e=C.checkInSeconds)));if(Q||!E)return rq.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y));ar=[];nk=K[0];Y=void 0;if(!nk.downloadMetadata){rq.bQ(15);break}return g.v(rq,t3(R.Z,nk.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:Pi=rq.Z,Y=Number((Rt=(wq=Pi)==null?void 0:wq.addedTimestampMillis)!=null?Rt:"0")/1E3;case 15:return g.$7(rq,17),g.v(rq,AZ8(R,A,(pX=Y)==null?void 0:pX.toString(),e),19);case 19:ar=rq.Z;g.XZ(rq,18);break;case 17:O5=g.TT(rq);if(!(O5 instanceof Error&&O5.message==="No data")){if(O5 instanceof Error&&O5.message==="Empty response body")fB(O5.message);
else return pk="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",tK="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O5 instanceof g.cx&&O5.type==="QUOTA_EXCEEDED"&&(pk="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",tK="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),rq.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,pk,tK));rq.bQ(18);break}return g.v(rq,e_(A,"musicPlaylist",R.Z,l,R.L),18);case 18:if(!W)return rq.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y));c8=[];DU=new Map;if((lN=ar)==null?0:lN.length)for(T=g.u(ar),IL=T.next();!IL.done;IL=T.next())rO=IL.value,fk=rO.offlineVideoData,XS=void 0,((XS=fk)==null?0:XS.videoId)&&DU.set(fk.videoId,fk);F=new Map;y9=[];if((Dc=nk)==null?0:(KG=Dc.tracks)==null?0:KG.length)for(U5=g.u(nk.tracks),gq=U5.next();!gq.done;gq=U5.next())if(Y7=gq.value,q5=g.qU(Y7).entityId)DU.has(q5)?(F.set(q5,DU.get(q5)),DU.delete(q5)):y9.push(q5);b=Number(((N5=l.actionMetadata)==null?void 0:N5.priority)||0)+1;P=g.u(DU.entries());for(X=
P.next();!X.done;X=P.next())x=X.value,S=g.u(x),ms=S.next().value,J=S.next().value,Rr=ms,I=J,c8.push(vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Rr,"musicTrack",b,tm,Xk(l,I)));vi=g.u(F.entries());for(k7=vi.next();!k7.done;k7=vi.next())sY=k7.value,H8=g.u(sY),dq=H8.next().value,FZ=H8.next().value,YJ=dq,Qr=FZ,c8.push(vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",YJ,"musicTrack",b,tm,Xk(l,Qr)));It=g.u(y9);for(bj=It.next();!bj.done;bj=It.next())P0=bj.value,c8.push(vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
P0,"musicTrack",0,tm));return rq.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,c8))}})},aeS=function(R,l){var y,f;
return g.w(function(A){switch(A.X){case 1:return y=Bj(l),g.$7(A,2),f=g.qU(l.entityKey).entityId,f==="!*$_ALL_ENTITIES_!*$"?g.v(A,bB(R.Z,l,R.L),5):g.v(A,e_(f,"musicPlaylist",R.Z,l,R.L),6);case 6:return g.v(A,NeU(R.Z,l.entityKey),5);case 5:g.XZ(A,3);break;case 2:return g.TT(A),A.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return A.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y))}})},AZ8=function(R,l,y,f){var A,K,G;
return g.w(function(B){switch(B.X){case 1:return g.v(B,kNr([l]),2);case 2:return A=B.Z,g.v(B,s8O(R,A[0],y,f),3);case 3:return K=B.Z,G=EZ(K.thumbnailDetails),g.v(B,Pj(G),4);case 4:return B.return(A[0].videos)}})},s8O=function(R,l,y,f){var A,K,G,B,H,n,m,h,c;
return g.w(function(E){return E.X==1?(A=l.playlistId,K=pGU(l),G=K.bL,B=K.y5,H=y?(Number(y)*1E3).toString():Date.now().toString(),n=l.lastModifiedTimestamp?(Number(l.lastModifiedTimestamp)*1E3).toString():"0",m={id:g.tx(A,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:B,lastModifiedTimestampMillis:n,addedTimestampMillis:H,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},h={id:g.tx(A,"musicPlaylist"),title:l.title,playlistId:A,thumbnailDetails:l.thumbnail,visibility:B_t(l),trackCount:l.totalVideoCount,
tracks:G,downloadMetadata:m.id},f&&(((c=h)==null?0:c.entityMetadata)?h.entityMetadata.nextAutoRefreshIntervalSeconds=String(f):h&&(h.entityMetadata={nextAutoRefreshIntervalSeconds:String(f)})),g.v(E,Ct(R.Z,{mode:"readwrite",CA:!0},function(W){var Q=ZO(W,h,"musicPlaylist");W=ZO(W,m,"musicPlaylistDownloadMetadataEntity");return g.ud.all([Q,W])}),2)):E.return(h)})},B_t=function(R){switch(R.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},HEr=function(R,l){this.Z=R;
this.L=l},hRr=function(R,l){var y,f,A,K,G,B,H,n,m,h,c,E,W;
return g.w(function(Q){switch(Q.X){case 1:return y=Bj(l),f=g.qU(l.entityKey),A=f.entityId,K=g.k(l.actionMetadata,nOD),g.$7(Q,2),g.v(Q,mMK(R,A,void 0,(G=K)==null?void 0:G.track,(B=K)==null?void 0:B.albumRelease),4);case 4:if((H=K)==null?0:H.playlistId){Q.bQ(5);break}return g.v(Q,Int(R.Z,l.entityKey),5);case 5:g.XZ(Q,3);break;case 2:return n=g.TT(Q),m="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.cx&&n.type==="QUOTA_EXCEEDED"&&
(m="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Q.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,m,h));case 3:E=Number(((c=l.actionMetadata)==null?void 0:c.priority)||0)+1;var e=(e=g.k(l.actionMetadata,nOD))?{playbackDataActionMetadata:{maximumDownloadQuality:e.maximumDownloadQuality}}:void 0;W=vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",A,"playbackData",E,oOA,e);return Q.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y,[W]))}})},cZU=function(R,l){var y,f,A,K,G,B,H,n,m,h,c,E,W,Q,e;
return g.w(function(r){switch(r.X){case 1:return y=Bj(l),f=g.qU(l.entityKey),A=f.entityId,g.v(r,t3(R.Z,l.entityKey,"musicTrack"),2);case 2:K=r.Z;if(!K){G=void 0;r.bQ(3);break}return g.v(r,t3(R.Z,K.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:G=r.Z;case 3:B=G;if(!K||!B)return r.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));n=g.k(l.actionMetadata,nOD);g.$7(r,5);return g.v(r,mMK(R,A,B.addedTimestampMillis,(m=n)==null?void 0:m.track,(h=n)==null?void 0:h.albumRelease),
7);case 7:E=Number(((c=l.actionMetadata)==null?void 0:c.priority)||0)+1;H=vj("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",A,"playbackData",E,oOA);g.XZ(r,6);break;case 5:W=g.TT(r);if(!(W instanceof Error&&W.message==="No data")){if(W instanceof Error&&W.message==="Empty response body")fB(W.message);else return Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",W instanceof g.cx&&W.type==="QUOTA_EXCEEDED"&&(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
e="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),r.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,Q,e));r.bQ(6);break}return g.v(r,$p(A,R.Z,l,R.L),6);case 6:return r.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,H?[H]:void 0))}})},EOS=function(R,l){var y,f;
return g.w(function(A){switch(A.X){case 1:return y=Bj(l),g.$7(A,2),f=g.qU(l.entityKey).entityId,f==="!*$_ALL_ENTITIES_!*$"?g.v(A,bB(R.Z,l,R.L),5):g.v(A,$p(f,R.Z,l,R.L),6);case 6:return g.v(A,NeU(R.Z,l.entityKey),5);case 5:g.XZ(A,3);break;case 2:return g.TT(A),A.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return A.return(new zy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y))}})},mMK=function(R,l,y,f,A){var K,G,B,H,n,m;
return g.w(function(h){switch(h.X){case 1:if(K=f){h.bQ(2);break}return g.v(h,j28([l]),3);case 3:G=h.Z,B=G[0],K=xlD(B);case 2:return g.v(h,W8O(R,K,l,A,y),4);case 4:H=h.Z;n=H.musicTrackEntity;m=H.l1;var c=EZ(n.thumbnailDetails),E=[];m&&(E=EZ(m.thumbnailDetails));return g.v(h,Pj(c.concat(E)),0)}})},W8O=function(R,l,y,f,A){var K;
return g.w(function(G){return G.X==1?(A||(A=Date.now().toString()),K={id:g.tx(y,"musicTrackDownloadMetadataEntity"),playbackData:g.tx(y,"playbackData"),addedTimestampMillis:A,videoDownloadContextEntity:g.tx(y,"videoDownloadContextEntity")},f&&(l.albumRelease=f.id),g.v(G,Ct(R.Z,{mode:"readwrite",CA:!0},function(B){var H=[],n=ZO(B,K,"musicTrackDownloadMetadataEntity");H.push(n);n=ZO(B,l,"musicTrack");H.push(n);f&&(B=ZO(B,f,"musicAlbumRelease"),H.push(B));return g.ud.all(H)}),2)):G.X!=3?g.v(G,o5(y,"musicTrackDownloadMetadataEntity",
R.Z,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):G.return({musicTrackEntity:l,
l1:f})})},Yp=function(){Jm.apply(this,arguments);
this.B="musicTrack"},L8U=function(R,l,y){l=l===void 0?43200:l;
y=y===void 0?!0:y;var f=f===void 0?!1:f;var A,K;return g.w(function(G){switch(G.X){case 1:if(!R.D.DX())return G.return([]);A=[];g.$7(G,2);return g.v(G,CGK(l,y,f),4);case 4:A=G.Z;g.XZ(G,3);break;case 2:g.TT(G);case 3:return K=QcK(R,A,y,"musicPlaylist"),G.return(K)}})},OEO=function(){g.Fc.apply(this,arguments);
var R=this;this.events=new g.QW(this);this.Zq=this.player.U();this.yu={MTQ:function(){return R.Z},
Ou:function(){return R.Ou()},
PL:function(l){return R.PL(l)}}},iEt=function(R){var l;
R=g.k((l=R.getWatchNextResponse())==null?void 0:l.currentVideoEndpoint,g.mh);if(R==null?0:R.playlistId)var y=R.playlistId;return y},P85=function(R,l){var y,f,A,K;
return g.w(function(G){if(G.X==1){y=l.clientPlaybackNonce;f={cpn:y,offlineSourceVisualElement:g.Ll(l.CX||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};l.X&&(f.videoFmt=Number(l.X.itag));l.Y&&(f.audioFmt=Number(l.Y.itag));if((A=iEt(l))&&l.videoId){var B=l.videoId;B=A!=="PPSV"?Promise.resolve(!1):R.Z.vB(B);G=g.v(G,B,3)}else G=G.bQ(2);return G}G.X!=2&&(K=G.Z)&&(f.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");R.X=y;g.sE("offlinePlaybackStarted",f);g.Q9(G)})};
g.wn.prototype.nh=g.Kk(45,function(R){return this.app.nh(R)});
g.i_.prototype.nh=g.Kk(44,function(R){return g.xRs(this,9,R)});
g.O(IO,xj);g.GT.Object.defineProperties(IO.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.Z.entityMetadata},
set:function(R){this.Z.entityMetadata=R}}});
g.O(nZS,IO);nZS.prototype.X=function(){return[]};
g.O(mXK,IO);mXK.prototype.X=function(){return[]};
g.O(oZS,IO);oZS.prototype.X=function(){return[]};
g.O(hmU,IO);hmU.prototype.X=function(){return[]};
g.O(clr,IO);clr.prototype.X=function(){var R=[];this.Z.alternateChannel&&R.push(this.Z.alternateChannel);this.Z.alternateChannelList&&R.push.apply(R,g.ci(this.Z.alternateChannelList));this.Z.oneofChannelEntity&&R.push(this.Z.oneofChannelEntity);return[].concat(g.ci(new Set(R)))};
g.O(EZr,IO);EZr.prototype.X=function(){var R=[];this.Z.entryCollection&&R.push(this.Z.entryCollection);return[].concat(g.ci(new Set(R)))};
g.O(W_t,xj);W_t.prototype.X=function(){var R=[];this.Z.video&&R.push(this.Z.video);return[].concat(g.ci(new Set(R)))};
g.O(L_Z,IO);L_Z.prototype.X=function(){var R=[];this.Z.parentPlaylist&&R.push(this.Z.parentPlaylist);if(this.Z.entries)for(var l=g.u(this.Z.entries),y=l.next();!y.done;y=l.next())R.push.apply(R,g.ci((new W_t(y.value)).X()));return[].concat(g.ci(new Set(R)))};
g.O(OaX,IO);OaX.prototype.X=function(){var R=[];this.Z.descriptionEntity&&R.push(this.Z.descriptionEntity);this.Z.creators&&R.push.apply(R,g.ci(this.Z.creators));this.Z.theBiggestFan&&R.push(this.Z.theBiggestFan);return[].concat(g.ci(new Set(R)))};
g.O(iaO,IO);iaO.prototype.X=function(){return[]};
g.O(PnU,IO);PnU.prototype.X=function(){return[]};
g.O(ubK,IO);ubK.prototype.X=function(){return[]};
g.O(F_d,IO);F_d.prototype.X=function(){return[]};
g.O(QkK,IO);QkK.prototype.X=function(){return[]};
g.O($XU,IO);$XU.prototype.X=function(){return[]};
g.O(emU,IO);emU.prototype.X=function(){return[]};
g.O(baU,IO);baU.prototype.X=function(){return[]};
g.O(XXS,IO);XXS.prototype.X=function(){return[]};
g.O(Tr5,IO);Tr5.prototype.X=function(){var R=[];this.Z.downloadsList&&R.push(this.Z.downloadsList);this.Z.smartDownloadsList&&R.push(this.Z.smartDownloadsList);this.Z.recommendedDownloadsList&&R.push(this.Z.recommendedDownloadsList);this.Z.refresh&&R.push(this.Z.refresh);return[].concat(g.ci(new Set(R)))};
g.O(dXD,xj);dXD.prototype.X=function(){var R=[];this.Z.video&&R.push(this.Z.video);this.Z.playlist&&R.push(this.Z.playlist);this.Z.videoItem&&R.push(this.Z.videoItem);this.Z.playlistItem&&R.push(this.Z.playlistItem);return[].concat(g.ci(new Set(R)))};
g.O(rlU,IO);rlU.prototype.X=function(){var R=[];this.Z.refresh&&R.push(this.Z.refresh);if(this.Z.downloads)for(var l=g.u(this.Z.downloads),y=l.next();!y.done;y=l.next())R.push.apply(R,g.ci((new dXD(y.value)).X()));return[].concat(g.ci(new Set(R)))};
g.O(vZD,IO);vZD.prototype.X=function(){var R=[];this.Z.localImageEntities&&R.push.apply(R,g.ci(this.Z.localImageEntities));return[].concat(g.ci(new Set(R)))};
g.O(zmO,IO);zmO.prototype.X=function(){var R=[];this.Z.playbackData&&R.push(this.Z.playbackData);this.Z.localImageEntities&&R.push.apply(R,g.ci(this.Z.localImageEntities));this.Z.videoDownloadContextEntity&&R.push(this.Z.videoDownloadContextEntity);return[].concat(g.ci(new Set(R)))};
g.O(wXD,IO);wXD.prototype.X=function(){return[]};
g.O(xXt,IO);xXt.prototype.X=function(){var R=[];this.Z.fakeChildren&&R.push.apply(R,g.ci(this.Z.fakeChildren));return[].concat(g.ci(new Set(R)))};
g.O(ITX,IO);ITX.prototype.X=function(){var R=[];this.Z.video&&R.push(this.Z.video);this.Z.playbackData&&R.push(this.Z.playbackData);this.Z.offlineVideoPolicy&&R.push(this.Z.offlineVideoPolicy);return[].concat(g.ci(new Set(R)))};
g.O(NrS,IO);NrS.prototype.X=function(){return[]};
g.O(pXO,IO);pXO.prototype.X=function(){var R=[];this.Z.channelOwner&&R.push(this.Z.channelOwner);this.Z.videos&&R.push.apply(R,g.ci(this.Z.videos));this.Z.collaboratorChannels&&R.push.apply(R,g.ci(this.Z.collaboratorChannels));this.Z.downloadState&&R.push(this.Z.downloadState);this.Z.refresh&&R.push(this.Z.refresh);return[].concat(g.ci(new Set(R)))};
g.O(UX8,IO);UX8.prototype.X=function(){var R=[];this.Z.video&&R.push(this.Z.video);this.Z.channelContributor&&R.push(this.Z.channelContributor);return[].concat(g.ci(new Set(R)))};
g.O(SOU,xj);SOU.prototype.X=function(){var R=[];this.Z.localImageEntities&&R.push.apply(R,g.ci(this.Z.localImageEntities));this.Z.videoDownloadContextEntity&&R.push(this.Z.videoDownloadContextEntity);return[].concat(g.ci(new Set(R)))};
g.O(jkS,xj);jkS.prototype.X=function(){var R=[];this.Z.recommendedVideoMetadata&&R.push.apply(R,g.ci((new SOU(this.Z.recommendedVideoMetadata)).X()));return[].concat(g.ci(new Set(R)))};
g.O(kgK,xj);kgK.prototype.X=function(){var R=[];this.Z.playbackPosition&&R.push(this.Z.playbackPosition);return[].concat(g.ci(new Set(R)))};
g.O(DXU,IO);DXU.prototype.X=function(){var R=[];this.Z.owner&&R.push(this.Z.owner);this.Z.downloadState&&R.push(this.Z.downloadState);this.Z.userState&&R.push.apply(R,g.ci((new kgK(this.Z.userState)).X()));this.Z.additionalMetadata&&R.push.apply(R,g.ci((new jkS(this.Z.additionalMetadata)).X()));return[].concat(g.ci(new Set(R)))};
g.O(ZaO,IO);ZaO.prototype.X=function(){var R=[];this.Z.userChannelDetails&&R.push(this.Z.userChannelDetails);return[].concat(g.ci(new Set(R)))};
g.O(Jlt,IO);Jlt.prototype.X=function(){var R=[];this.Z.channelOwner&&R.push(this.Z.channelOwner);this.Z.playbackPosition&&R.push(this.Z.playbackPosition);this.Z.localImageEntities&&R.push.apply(R,g.ci(this.Z.localImageEntities));this.Z.downloadStatus&&R.push(this.Z.downloadStatus);return[].concat(g.ci(new Set(R)))};
g.O(gZO,IO);gZO.prototype.X=function(){return[]};
g.O(Vld,IO);Vld.prototype.X=function(){return[]};
g.O(CnZ,IO);CnZ.prototype.X=function(){return[]};
g.O(qOZ,IO);qOZ.prototype.X=function(){return[]};
g.O(tlU,IO);tlU.prototype.X=function(){return[]};
g.O(YOA,IO);YOA.prototype.X=function(){return[]};
g.O(MlS,IO);MlS.prototype.X=function(){return[]};
g.O(RqU,IO);RqU.prototype.X=function(){return[]};
g.O(l9Z,IO);l9Z.prototype.X=function(){return[]};
g.O(yg5,IO);yg5.prototype.X=function(){return[]};
g.O(f9K,IO);f9K.prototype.X=function(){return[]};
g.O(Agt,IO);Agt.prototype.X=function(){return[]};
g.O(Kod,IO);Kod.prototype.X=function(){var R=[];this.Z.trackDownloadMetadatas&&R.push.apply(R,g.ci(this.Z.trackDownloadMetadatas));return[].concat(g.ci(new Set(R)))};
g.O(GYU,IO);
GYU.prototype.X=function(){var R=[];this.Z.downloadedTracks&&R.push.apply(R,g.ci(this.Z.downloadedTracks));this.Z.smartDownloadedTracks&&R.push.apply(R,g.ci(this.Z.smartDownloadedTracks));this.Z.downloadedEpisodes&&R.push.apply(R,g.ci(this.Z.downloadedEpisodes));this.Z.downloadedAlbumReleases&&R.push.apply(R,g.ci(this.Z.downloadedAlbumReleases));this.Z.smartDownloadedAlbumReleases&&R.push.apply(R,g.ci(this.Z.smartDownloadedAlbumReleases));this.Z.downloadedPlaylists&&R.push.apply(R,g.ci(this.Z.downloadedPlaylists));this.Z.smartDownloadedPlaylists&&
R.push.apply(R,g.ci(this.Z.smartDownloadedPlaylists));this.Z.metadataOnlyTracks&&R.push.apply(R,g.ci(this.Z.metadataOnlyTracks));return[].concat(g.ci(new Set(R)))};
g.O(a9O,IO);a9O.prototype.X=function(){var R=[];this.Z.trackDownloadMetadatas&&R.push.apply(R,g.ci(this.Z.trackDownloadMetadatas));return[].concat(g.ci(new Set(R)))};
g.O(sst,IO);sst.prototype.X=function(){var R=[];this.Z.playbackData&&R.push(this.Z.playbackData);this.Z.localImageEntities&&R.push.apply(R,g.ci(this.Z.localImageEntities));this.Z.videoDownloadContextEntity&&R.push(this.Z.videoDownloadContextEntity);return[].concat(g.ci(new Set(R)))};
g.O(BJX,IO);BJX.prototype.X=function(){var R=[];this.Z.musicLibraryStatusEntity&&R.push(this.Z.musicLibraryStatusEntity);this.Z.primaryArtists&&R.push.apply(R,g.ci(this.Z.primaryArtists));this.Z.details&&R.push(this.Z.details);this.Z.userDetails&&R.push(this.Z.userDetails);this.Z.tracks&&R.push.apply(R,g.ci(this.Z.tracks));this.Z.share&&R.push(this.Z.share);this.Z.downloadMetadata&&R.push(this.Z.downloadMetadata);this.Z.refresh&&R.push(this.Z.refresh);return[].concat(g.ci(new Set(R)))};
g.O(Hrr,IO);Hrr.prototype.X=function(){var R=[];this.Z.albumRelease&&R.push(this.Z.albumRelease);this.Z.tracks&&R.push.apply(R,g.ci(this.Z.tracks));return[].concat(g.ci(new Set(R)))};
g.O(n25,IO);n25.prototype.X=function(){var R=[];this.Z.albumRelease&&R.push(this.Z.albumRelease);return[].concat(g.ci(new Set(R)))};
g.O(mgS,IO);mgS.prototype.X=function(){var R=[];this.Z.details&&R.push(this.Z.details);this.Z.userDetails&&R.push(this.Z.userDetails);return[].concat(g.ci(new Set(R)))};
g.O(o2r,IO);o2r.prototype.X=function(){var R=[];this.Z.parentArtist&&R.push(this.Z.parentArtist);return[].concat(g.ci(new Set(R)))};
g.O(hqS,IO);hqS.prototype.X=function(){var R=[];this.Z.parentArtist&&R.push(this.Z.parentArtist);return[].concat(g.ci(new Set(R)))};
g.O(cgS,IO);cgS.prototype.X=function(){return[]};
g.O(E2d,IO);E2d.prototype.X=function(){return[]};
g.O(WoS,xj);WoS.prototype.X=function(){var R=[];this.Z.creatorEntity&&R.push(this.Z.creatorEntity);return[].concat(g.ci(new Set(R)))};
g.O(LoU,IO);
LoU.prototype.X=function(){var R=[];this.Z.tracks&&R.push.apply(R,g.ci(this.Z.tracks));this.Z.refresh&&R.push(this.Z.refresh);this.Z.musicLibraryStatusEntity&&R.push(this.Z.musicLibraryStatusEntity);this.Z.details&&R.push(this.Z.details);this.Z.downloadMetadata&&R.push(this.Z.downloadMetadata);this.Z.sideloadMetadata&&R.push(this.Z.sideloadMetadata);this.Z.userDetails&&R.push(this.Z.userDetails);this.Z.entryCollection&&R.push(this.Z.entryCollection);this.Z.share&&R.push(this.Z.share);this.Z.podcastShowAdditionalMetadata&&
R.push.apply(R,g.ci((new WoS(this.Z.podcastShowAdditionalMetadata)).X()));return[].concat(g.ci(new Set(R)))};
g.O(OrA,IO);OrA.prototype.X=function(){return[]};
g.O(ird,IO);
ird.prototype.X=function(){var R=[];this.Z.musicLibraryStatusEntity&&R.push(this.Z.musicLibraryStatusEntity);this.Z.artists&&R.push.apply(R,g.ci(this.Z.artists));this.Z.audioModeVersion&&R.push(this.Z.audioModeVersion);this.Z.videoModeVersion&&R.push(this.Z.videoModeVersion);this.Z.userDetails&&R.push(this.Z.userDetails);this.Z.details&&R.push(this.Z.details);this.Z.albumRelease&&R.push(this.Z.albumRelease);this.Z.share&&R.push(this.Z.share);this.Z.libraryEdit&&R.push(this.Z.libraryEdit);this.Z.downloadMetadata&&
R.push(this.Z.downloadMetadata);this.Z.playbackPosition&&R.push(this.Z.playbackPosition);this.Z.lyrics&&R.push(this.Z.lyrics);return[].concat(g.ci(new Set(R)))};
g.O(POX,IO);POX.prototype.X=function(){var R=[];this.Z.parentTrack&&R.push(this.Z.parentTrack);return[].concat(g.ci(new Set(R)))};
g.O(u4K,IO);u4K.prototype.X=function(){var R=[];this.Z.parentTrack&&R.push(this.Z.parentTrack);return[].concat(g.ci(new Set(R)))};
g.O(FoA,IO);FoA.prototype.X=function(){return[]};
g.O(QsU,IO);QsU.prototype.X=function(){return[]};
g.O($gt,IO);$gt.prototype.X=function(){return[]};
g.O(eqU,IO);eqU.prototype.X=function(){return[]};
g.O(brD,IO);brD.prototype.X=function(){var R=[];this.Z.transfer&&R.push(this.Z.transfer);this.Z.adsPlaybackData&&R.push.apply(R,g.ci(this.Z.adsPlaybackData));this.Z.drmLicense&&R.push(this.Z.drmLicense);this.Z.offlineVideoPolicy&&R.push(this.Z.offlineVideoPolicy);this.Z.videoDownloadContextEntity&&R.push(this.Z.videoDownloadContextEntity);return[].concat(g.ci(new Set(R)))};
g.O(XbS,IO);XbS.prototype.X=function(){return[]};
g.O(TJK,IO);TJK.prototype.X=function(){var R=[];this.Z.offlineVideoStreams&&R.push.apply(R,g.ci(this.Z.offlineVideoStreams));this.Z.captionTrack&&R.push.apply(R,g.ci(this.Z.captionTrack));return[].concat(g.ci(new Set(R)))};
g.O(dg5,IO);dg5.prototype.X=function(){return[]};
g.O(rgd,IO);rgd.prototype.X=function(){return[]};
g.O(v2t,IO);v2t.prototype.X=function(){return[]};
g.O(zq5,IO);zq5.prototype.X=function(){return[]};
g.O(wbU,IO);wbU.prototype.X=function(){return[]};
g.O(xg8,IO);xg8.prototype.X=function(){return[]};
g.O(I9U,IO);I9U.prototype.X=function(){return[]};
g.O(NJK,IO);NJK.prototype.X=function(){return[]};
g.O(pbD,IO);pbD.prototype.X=function(){return[]};
g.O(UgU,IO);UgU.prototype.X=function(){return[]};
g.O(Sjd,IO);Sjd.prototype.X=function(){return[]};
g.O(js8,IO);js8.prototype.X=function(){return[]};
g.O(kYr,IO);kYr.prototype.X=function(){return[]};
g.O(Dgt,IO);Dgt.prototype.X=function(){return[]};
g.O(ZrU,IO);ZrU.prototype.X=function(){return[]};
g.O(Jg5,IO);Jg5.prototype.X=function(){return[]};
g.O(g2r,IO);g2r.prototype.X=function(){return[]};
g.O(VHA,IO);VHA.prototype.X=function(){return[]};
g.O(COr,IO);COr.prototype.X=function(){return[]};
g.O(qjS,IO);qjS.prototype.X=function(){return[]};
g.O(tHS,IO);tHS.prototype.X=function(){return[]};
var qPZ=["browse","music/browse","unplugged/browse"],lFr=["offline/playlist_sync_check"],SPD=["offline"],t1d=["offline/offline_video_playback_position_sync"],M1K=["offline/get_playback_data_entity"],Nm;pt.getInstance=function(){return g.w(function(R){return R.return(new Promise(function(l){g.tv().then(function(y){y?(pt.instance||(pt.instance=new pt(y)),l(pt.instance)):l(void 0)})}))})};
pt.prototype.get=function(R){var l=this,y,f,A;return g.w(function(K){if(K.X==1)return g.v(K,lYS(l.token),2);if(K.X!=3)return y=K.Z,g.v(K,y.get("prefs",R),3);f=K.Z;if(!f)return K.return();A=(0,g.eY)();return f.expirationTimestampMs<=A?K.return():K.return(f.value)})};
pt.prototype.set=function(R,l,y){y=y===void 0?31536E3:y;var f=this,A,K,G;return g.w(function(B){if(B.X==1)return A=(0,g.eY)(),K={key:R,value:l,expirationTimestampMs:A+y*1E3},g.v(B,lYS(f.token),2);G=B.Z;return g.v(B,g.vx(G,"prefs",K),0)})};
pt.prototype.remove=function(R){var l=this,y;return g.w(function(f){if(f.X==1)return g.v(f,lYS(l.token),2);y=f.Z;return g.v(f,y.delete("prefs",R),0)})};
g.O(UL,g.JD);g.O(Ss,GZA);Ss.prototype.L=function(R,l){l=sut(l);R=(new TextEncoder).encode(JSON.stringify(R));return this.Z.encrypt(R,l)};
Ss.prototype.X=function(R,l){if(!(R instanceof Uint8Array))throw y_O(1);var y=new TextDecoder;l=sut(l);R=this.Z.decrypt(R,l);return JSON.parse(y.decode(R))};
var BCU={accountLinkStatusEntity:ubK,booleanEntity:oZS,buttonEntity:Dgt,captionTrack:FoA,channelHandle:nZS,chipEntity:I9U,commerceAcquisitionClientPayloadEntity:Jg5,commerceCartListEntity:g2r,contextNoteFeedEntityPayload:mXK,continuationTokenEntity:NrS,downloadQualityPickerEntity:emU,downloadsPageRefreshTokenEntity:XXS,downloadsPageViewConfigurationEntity:gZO,downloadStatusEntity:baU,dismissState:NJK,sfvAudioItemCurrentlyPlayingEntity:zq5,emojiFountainDataEntity:js8,emojiCustomizationSetEntity:Sjd,
fakeChannel:clr,fakePlaylist:EZr,fakePlaylistEntryCollection:L_Z,fakeVideo:OaX,fakeVideoDescription:iaO,featuredProductsEntity:yg5,flowStateEntity:PnU,iconBadgeEntity:VHA,interstitialInteractionStateEntity:QkK,likeButtonAnimationEntity:Vld,liveChatPollStateEntity:$XU,liveViewerLeaderboardChatEntryPointStateEntity:rgd,liveViewerLeaderboardPointsEntity:v2t,liveReactionsDataEntity:kYr,logoEntity:F_d,macroMarkerEntity:CnZ,mainDownloadsLibraryEntity:Tr5,mainDownloadsListEntity:rlU,mainPlaylistDownloadStateEntity:vZD,
mainPlaylistEntity:pXO,mainPlaylistVideoEntity:UX8,mainVideoDownloadStateEntity:zmO,mainVideoEntity:DXU,markersEngagementPanelSyncEntity:qOZ,markersVisibilityOverrideEntity:tlU,musicAlbumReleaseDetail:Hrr,musicAlbumReleaseDownloadMetadataEntity:Kod,musicAlbumRelease:BJX,musicAlbumReleaseUserDetail:n25,musicArtistDetail:o2r,musicArtist:mgS,musicArtistUserDetail:hqS,musicDownloadsLibraryEntity:GYU,musicLibraryEdit:cgS,musicLibraryStatusEntity:E2d,musicPlaylist:LoU,musicPlaylistDownloadMetadataEntity:a9O,
musicShare:OrA,musicTrackDetail:POX,musicTrackDownloadMetadataEntity:sst,musicTrack:ird,musicTrackUserDetail:u4K,offlineOrchestrationActionWrapperEntity:QsU,offlineVideoPolicy:$gt,offlineVideoStreams:eqU,offlineabilityEntity:wXD,orchestrationWebSamplingEntity:xXt,pageHeaderEntity:pbD,pdpStateEntity:COr,pinnedProductEntity:f9K,playbackData:brD,playerStateEntity:YOA,quantityIncrementerEntity:qjS,refresh:XbS,saveToPlaylistListEntity:wbU,selectedChipIndexEntityPayload:MlS,settingEntity:xg8,stringEntity:hmU,
suggestedFeedbackChipStateEntity:RqU,transfer:TJK,trendingOfferEntity:Agt,videoDownloadContextEntity:dg5,videoOverviewAsyncDataEntity:tHS,videoPlaybackPositionEntity:ZrU,votingEntity:UgU,ytMainChannelEntity:ZaO,youchatPendingResponseEntity:l9Z,ytMainDownloadedVideoEntity:ITX,ytMainVideoEntity:Jlt};g.O(g6,GZA);g6.prototype.L=function(R){return R};
g6.prototype.X=function(R){if(R instanceof Uint8Array)throw y_O(0);return R};
g.O(V4,g.p);V4.prototype.observe=function(R){var l=this;this.observers.push(R);return function(){var y=l.observers.indexOf(R);y>=0&&l.observers.splice(y,1)}};
V4.prototype.X=function(R){FyS(this,R.data)};
V4.prototype.G4=function(){this.channel.close()};
var XKU,exA=new g.QX("elementsCommand");var Fk=new g.QX("entityBatchUpdate");var hx5=new g.QX("downloadStatusEntity");var d3r=new g.QX("mainPlaylistEntityActionMetadata");var CB=new g.QX("mainVideoEntityActionMetadata");var Ult=new g.QX("musicPlaylistEntityActionMetadata");var nOD=new g.QX("musicTrackEntityActionMetadata");var JUD=new g.QX("localImageEntityActionMetadata");var wK=new g.QX("playbackDataActionMetadata");var bzX=new g.QX("transferEntityActionMetadata");var mTt=new g.QX("videoPlaybackPositionEntityActionMetadata");var D_5;new g.o2;new g.o2;CxD.prototype.request=function(R,l,y){l=l===void 0?{}:l;return this.locks.request(R,l,function(f){return y(f)})};var yw=g.Mo.caches,lB,Rxr;R5.prototype.open=function(R){return yw.open(YTd(R))};
R5.prototype.has=function(R){return yw.has(YTd(R))};
R5.prototype.delete=function(R){return yw.delete(YTd(R))};
R5.prototype.match=function(R,l){var y=this,f,A,K,G,B,H;return g.w(function(n){switch(n.X){case 1:return g.v(n,y.keys(),2);case 2:f=n.Z,A=g.u(f),K=A.next();case 3:if(K.done){n.bQ(5);break}G=K.value;return g.v(n,y.open(G),6);case 6:return B=n.Z,g.v(n,B.match(R,l),7);case 7:if(H=n.Z)return n.return(H);K=A.next();n.bQ(3);break;case 5:return n.return()}})};
g.O(tfZ,R5);tfZ.prototype.keys=function(){var R,l,y,f,A,K,G,B,H;return g.w(function(n){if(n.X==1)return R=[],l=g.g0("CacheStorage keys"),g.v(n,yw.keys(),2);y=n.Z;f=g.u(y);for(A=f.next();!A.done;A=f.next()){K=A.value;var m=K.indexOf(":");G=m===-1?{kU:K}:{kU:K.substring(0,m),datasyncId:K.substring(m+1)};B=G.kU;H=G.datasyncId;H===l&&R.push(B)}return n.return(R)})};g.O(Am,g.p);Am.prototype.L=function(R){this.api.KX("onOfflineOperationFailure",R.data)};
Am.prototype.Y=function(R){this.api.publish("offlinetransferpause",R.data)};
Am.prototype.G4=function(){var R;(R=this.Z)==null||R.close();var l;(l=this.X)==null||l.close()};fnr.prototype.cA=function(){this.Z&&Gy(this)};
fnr.prototype.eM=function(){this.X&&this.X.resolve();this.L=this.Z=!1;this.B()};var DTU=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var FgK="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var wGU="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.O(fFZ,rK);fFZ.prototype.X=function(R){return Hj(R)?GS5(this,R):nB(R)?BUO(this,R):Promise.reject(Error("Unsupported action type: "+R.actionType))};g.O(HzK,rK);HzK.prototype.X=function(R){return nB(R)?nAA(this,R):ol5(R)?oAX(this,R):m4(R)?hWK(this,R):Promise.reject(Error("Unsupported action type: "+R.actionType))};g.L=cIr.prototype;g.L.qLL=function(R){var l=this,y,f,A,K;return g.w(function(G){if(!g.V(R.state,128))return G.bQ(0);y=R.state.WE;var B=(f=y)==null?void 0:f.errorCode,H=(A=y)==null?void 0:A.gi;K=B==="net.connect"&&H===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(B==null?0:B.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.v(G,l.vt(l.player.getVideoData().videoId,K),0)})};
g.L.vt=function(R,l){var y=this;return g.w(function(f){if(f.X==1){if(y.X)return f.return();y.X=!0;return l==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(N8(y,R,!1,!0),f.bQ(0)):g.v(f,I5(y,R),3)}g.Jn(R,4);return g.v(f,y.Z.vt(l),0)})};
g.L.oZ=function(R){R.status===2?(R.status!==this.L&&(n8U(this.Z),g.Jn(R.videoId,2)),R.LP&&E8K(this.Z,R.videoId,R.LP)):R.status===4?(I5(this,R.videoId),this.vt(R.videoId,R.Rr?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):R.status===1&&cUK(this.Z);this.L=R.status;this.api.KX("localmediachange",{videoId:R.videoId,status:R.status})};
g.L.xE=function(){var R=this,l;return g.w(function(y){if(y.X==1){if(R.X)return y.return();R.X=!0;l=R.player.getVideoData().videoId;return g.v(y,I5(R,l),2)}return g.v(y,R.Z.xE(),0)})};
g.L.tK=function(R){switch(R){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.L.C=function(R){return this.api.U().C(R)};g.O(uDA,rK);uDA.prototype.X=function(R){return Hj(R)?Qj8(this,R):nB(R)?$TK(this,R):ol5(R)?eW5(this,R):Promise.reject(Error("Unsupported action type: "+R.actionType))};vAr.prototype.Z=function(R,l){var y=R.action.actionMetadata.priority-l.action.actionMetadata.priority;y===0&&(R.Z<l.Z?y=-1:R.Z>l.Z&&(y=1));return y};g.O(pB,g.p);pB.prototype.G4=function(){this.B&&this.B();g.p.prototype.G4.call(this)};
pB.prototype.createAction=function(R,l){var y=g.qU(R.entityKey).entityType,f=g.L6(16);return new Wj(y,f,R,l.actionId,l.rootActionId)};
pB.prototype.Yb=function(R){var l=this,y,f,A,K,G,B,H,n,m;return g.w(function(h){if(h.X==1){if(l.Fx())return h.return();f=(y=R.offlineOrchestrationActionWrapperEntity)!=null?y:new Set;A=[];K=g.u(f);for(G=K.next();!G.done;G=K.next())B=G.value,H=g.qU(B),n=H.entityId,xTO(l.Z,n)||A.push(B);return g.v(h,gAZ(l,A),2)}m=h.Z;return g.v(h,JIK(l,m),0)})};
pB.prototype.retry=function(){var R=this;return g.w(function(l){return g.v(l,VCU(R),0)})};qlS.prototype.W0=function(R,l){l=l===void 0?!0:l;var y=this,f,A,K,G,B,H,n,m;return g.w(function(h){switch(h.X){case 1:if(!y.Z)return h.return();f=[];A=g.Kq(y.Z.X,l);K=[];for(G={ud:0};G.ud<A.length;G={ud:G.ud},G.ud++)B=A[G.ud],H=y.Z.Ao(B,"json3"),n=g.Xy(H,{withCredentials:!0,format:"RAW"},3,500).then(function(c){return function(E){E={metadata:g.d3(A[c.ud]),trackData:E.xhr.responseText};K.push(E)}}(G)).H6(function(c){fB("Caption fetch error",c)}),f.push(n);
return g.v(h,HaA(f),2);case 2:return g.$7(h,3),g.v(h,IYK(R,K),5);case 5:g.XZ(h,0);break;case 3:m=g.TT(h),fB("Caption DB transaction error",m),g.Q9(h)}})};g.O(UZ,g.p);UZ.prototype.G4=function(){this.X&&this.X();g.p.prototype.G4.call(this)};
UZ.prototype.L=function(R){var l=this,y,f,A,K,G,B,H,n;return g.w(function(m){f=(y=R.transfer)!=null?y:new Set;A=[];K=g.u(f);for(G=K.next();!G.done;G=K.next())B=G.value,H=g.qU(B),n=H.entityId,A.push(n);return A.length===0?m.return():g.v(m,MCK(l,A),0)})};g.O(AUU,g.p);g.L=AUU.prototype;g.L.G4=function(){this.xb&&this.xb();this.Dq.dispose();this.Y.dispose();this.CX&&g.Y2(this.D.Dj,this.CX);this.P1&&g.Y2(this.D.Dj,this.P1);g.p.prototype.G4.call(this)};
g.L.z0U=function(R){var l=this,y,f,A;return g.w(function(K){switch(K.X){case 1:y=g.tx(R,"transfer");if(l.Z&&y===l.Z.key){N8(l.V,l.J,!0);l.Y.stop();K.bQ(0);break}return g.v(K,Ct(l.X,{mode:"readwrite",CA:!0},function(G){return js(G,y,"transfer").then(function(B){if(B&&B.transferState!=="TRANSFER_STATE_COMPLETE"&&B.transferState!=="TRANSFER_STATE_FAILED")return B.transferState="TRANSFER_STATE_PAUSED_BY_USER",ZO(G,B,"transfer").then(function(){return B})})}),3);
case 3:f=K.Z;if(!f){K.bQ(0);break}if(!R||!l.L){K.bQ(5);break}return g.v(K,o5(R,l.L,l.X,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.v(K,kp(l,R),7);case 7:A=K.Z,nlU({videoId:R,ly:f,offlineModeType:A}),g.Q9(K)}})};
g.L.o6L=function(){var R=this;if(this.Z&&this.J){N8(this.V,this.J,!1);var l=this.Z,y=(l==null?0:l.key)?g.qU(l.key).entityId:"";y&&this.L&&(new Promise(function(f,A){o5(y,R.L,R.X,"DOWNLOAD_STATE_PAUSED").catch(function(K){A(K)})})).catch(function(f){fB("Download state setting error",f)})}this.Y.stop()};
g.L.N1=function(){this.Z?aGU(this,this.Z):j_(this)};
g.L.FV=function(R){var l=this;return g.w(function(y){switch(y.X){case 1:if(!l.Z){y.bQ(2);break}if(l.Z.transferState==="TRANSFER_STATE_COMPLETE"||l.Z.transferState==="TRANSFER_STATE_FAILED"||!R.transfer||!R.transfer.has(l.Z.key)){y.bQ(3);break}return g.v(y,t3(l.X,l.Z.key,"transfer"),4);case 4:l.Z=y.Z;if(l.Z){y.bQ(3);break}return g.v(y,scr(l),3);case 3:if(l.Z)return y.return();case 2:return g.v(y,j_(l),0)}})};
g.L.vt=function(R,l){var y=this,f,A,K,G,B;return g.w(function(H){switch(H.X){case 1:if(!y.Z){DL(y,"onTransferFailure: "+R);H.bQ(2);break}f=y.Z;K=((A=f)==null?0:A.key)?g.qU(f.key).entityId:"";a:switch(R){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var n=!1;break a;default:n=!0}return n&&WOD(y)?g.v(H,ZL(y,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.v(H,
LOd(y,R),5);case 5:if(!K||!y.L){H.bQ(2);break}return g.v(H,o5(K,y.L,y.X,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.v(H,kp(y,K),9);case 9:G=H.Z;sZ({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:K,ly:f,offlineModeType:G});if(!K||!y.L){H.bQ(2);break}return g.v(H,o5(K,y.L,y.X,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:S_(y),B=j_(y,!0),l&&l(B),g.Q9(H)}})};
g.L.xE=function(R){var l=this,y,f,A,K,G,B,H,n,m,h,c,E;return g.w(function(W){switch(W.X){case 1:if(!l.Z){DL(l,"onMaybeTransferStreamsExpired");W.bQ(2);break}return WOD(l)?g.v(W,ZL(l,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.v(W,LOd(l,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!l.L){W.bQ(2);break}y=l.Z;A=((f=y)==null?0:f.key)?g.qU(y.key).entityId:"";if(!A){W.bQ(2);break}return g.v(W,o5(A,l.L,l.X,"DOWNLOAD_STATE_FAILED"),2);case 9:return l.Z||DL(l,"onMaybeTransferStreamsExpiredRetryAttempting"),
K=l.Z,B=((G=K)==null?0:G.key)?g.qU(K.key).entityId:"",g.v(W,kp(l,B),10);case 10:return H=W.Z,sZ({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:B,ly:K,offlineModeType:H}),n=WgU(),g.x$(n,wK,{isEnqueuedForExpiredStreamUrlRefetch:!0}),m=g.tx(B,"playbackData"),h={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:m,actionMetadata:n},c=OZ(new Wj("playbackData",B,h)),g.v(W,qm(l.X,c,"offlineOrchestrationActionWrapperEntity"),2);case 2:S_(l),E=j_(l,!0),
R&&R(E),g.Q9(W)}})};
var uIS={},OgU=(uIS.TRANSFER_STATE_TRANSFERRING=1,uIS.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,uIS);g.L=Jm.prototype;g.L.wK=function(){return this.J.promise};
g.L.Tb=function(){if(this.X&&this.V)return this.J.promise;utU(this).then(this.J.resolve).catch(this.J.reject);return this.J.promise};
g.L.Lj=function(R){var l={};return l.playbackData=new fFZ(R,this.Zq,this.Z),l.transfer=new uDA(R,this.Zq),l.videoPlaybackPositionEntity=new HzK(R,this.Zq),l};
g.L.Fs=function(){var R=this;return g.w(function(l){return R.X?g.v(l,KO8(R.X),0):l.bQ(0)})};
g.L.xB=function(){var R=this,l,y;return g.w(function(f){if(f.X==1)return R.X||R.V?g.v(f,R.wK(),2):f.return();R.W!==void 0&&(g.Wh(R.W),R.W=void 0);R.Y!==void 0&&(g.Wh(R.Y),R.Y=void 0);(l=R.X)==null||l.dispose();R.X=void 0;(y=R.V)==null||y.dispose();R.V=void 0;R.api.KX("onOrchestrationLostLeader");R.J=new g.o2;g.Q9(f)})};
g.L.isOrchestrationLeader=function(){return this.L.Z};
g.L.vB=function(){return g.w(function(R){return R.return(!1)})};
g.L.Uf=function(R){var l=this.Z;l.api.publish("offlinetransferpause",R);var y;(y=l.X)==null||y.postMessage(R)};
g.L.N1=function(R){var l,y;return g.w(function(f){if(f.X==1)return g.v(f,Mm(),2);l=f.Z;if(!l)return f.return();y=g.tx(R,"transfer");return g.v(f,Ct(l,{mode:"readwrite",CA:!0},function(A){var K=js(A,y,"transfer"),G=js(A,g.tx(R,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.ud.all([K,G]).then(function(B){B=g.u(B);var H=B.next().value;var n=B.next().value;return H&&H.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(H.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",ZO(A,H,"transfer").then(function(){sZ({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:R,ly:H,offlineModeType:n==null?void 0:n.offlineModeType});return g.ud.resolve(null)})):g.ud.resolve(null)})}),0)})};
g.L.ZC=function(R){R=R===void 0?43200:R;var l=this,y,f,A,K,G,B,H,n;return g.w(function(m){if(m.X==1)return l.D.DX()?g.v(m,Mm(),2):m.return(FOX());if(m.X!=3){y=m.Z;if(!y)return m.return([]);f=Date.now()/1E3;return g.v(m,Yj(y,"offlineVideoPolicy"),3)}A=m.Z;K=[];G=g.u(A);for(B=G.next();!B.done;B=G.next())H=B.value,Number(H.lastUpdatedTimestampSeconds)+R<=f&&(n=g.qU(H.key).entityId,K.push(n));return K.length?m.return(gK(l,K,l.B,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):m.return([])})};
g.L.deleteAll=function(){return gK(this,["!*$_ALL_ENTITIES_!*$"],this.B,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.L.refreshAllStaleEntities=function(R){var l=this;return g.w(function(y){return y.X==1?g.v(y,l.ZC(R),2):y.return(y.Z)})};
g.L.setUpPositionSyncInterval=function(R){var l=this;this.Y!==void 0&&(g.Wh(this.Y),this.Y=void 0);var y=R!=null?R:864E5;this.Y=g.ch(function(){l.xm(y)},y)};
g.L.xm=function(R){var l=this,y,f,A,K,G,B;return g.w(function(H){switch(H.X){case 1:return g.$7(H,2),g.v(H,pt.getInstance(),4);case 4:y=H.Z;if(!y)throw Error("prefStorage is undefined");return g.v(H,y.get("psi"),5);case 5:f=H.Z;K=((A=f)==null?0:A.Qn)?Number(f.Qn)/1E3:0;G=Date.now();if(!(K+R<=G)){H.bQ(6);break}return g.v(H,gK(l,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.XZ(H,0);break;case 2:B=g.TT(H),fB("Offline manager error",B),
g.Q9(H)}})};
g.L.Rk=function(){var R=this,l,y,f,A,K,G,B;return g.w(function(H){if(H.X==1)return g.v(H,Mm(),2);if(H.X!=3)return(l=H.Z)?g.v(H,Yj(l,"transfer"),3):H.return([]);y=H.Z;f=[];A=g.u(y);for(K=A.next();!K.done;K=A.next())G=K.value,G.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&G.key&&(B=g.qU(G.key).entityId,f.push(B));return H.return($3A(R,f))})};
g.L.v8=function(){return g.w(function(R){return R.return([])})};
g.L.IC=function(){return g.w(function(R){g.Q9(R)})};
g.L.o3=function(){return g.w(function(R){g.Q9(R)})};g.O(enK,rK);enK.prototype.X=function(R){return Hj(R)?TxX(this,R):nB(R)?rUA(this,R):m4(R)?v88(this,R):Promise.reject(Error("Unsupported action type: "+R.actionType))};
var Vw=[10];g.O(NxA,rK);NxA.prototype.X=function(R){return Hj(R)?Sv8(this,R):nB(R)?jcK(this,R):m4(R)?k8Z(this,R):Promise.reject(Error("Unsupported action type: "+R.actionType))};
var U3X=[10];g.O(ZgD,rK);ZgD.prototype.X=function(R){return nB(R)?g8d(this,R):Promise.reject(Error("Unsupported action type: "+R.actionType))};g.O(VxK,Jm);g.L=VxK.prototype;g.L.Lj=function(R){var l=Jm.prototype.Lj.call(this,R);l.mainVideoEntity=new NxA(R,this.Zq,this.Z);l.mainPlaylistEntity=new enK(R,this.Zq,this.Z);l.mainDownloadsListEntity=new ZgD(R,this.Zq,this.Z);return l};
g.L.refreshAllStaleEntities=function(R,l){var y=this,f,A,K,G,B,H,n,m,h,c,E;return g.w(function(W){switch(W.X){case 1:f=[];if(!y.Zq.C("web_player_offline_playlist_auto_refresh")){W.bQ(2);break}return g.v(W,C0A(y,R,l),3);case 3:f=W.Z;case 2:return g.v(W,pt.getInstance(),4);case 4:return A=W.Z,g.v(W,(K=A)==null?void 0:K.get("sdois"),5);case 5:return G=W.Z,g.v(W,(B=A)==null?void 0:B.get("lmqf"),6);case 6:H=W.Z;if(!G){W.bQ(7);break}m=f;h=m.concat;return g.v(W,qvt(y,G,(n=H)!=null?n:"SD",R===0),8);case 8:f=
h.call(m,W.Z);case 7:return c=f,E=c.concat,g.v(W,Jm.prototype.refreshAllStaleEntities.call(y,R,l),9);case 9:return f=E.call(c,W.Z),W.return(f)}})};
g.L.vB=function(R){var l,y,f,A,K,G,B,H;return g.w(function(n){if(n.X==1)return g.v(n,Mm(),2);if(n.X!=3)return(l=n.Z)?g.v(n,t3(l,g.Um,"mainDownloadsListEntity"),3):n.return(!1);y=n.Z;if((f=y)==null?0:(A=f.downloads)==null?0:A.length)for(K=g.tx(R,"mainVideoEntity"),G=g.u(y.downloads),B=G.next();!B.done;B=G.next())if(H=B.value,H.videoItem===K)return n.return(!0);return n.return(!1)})};
g.L.v8=function(){var R=this,l,y,f,A,K,G,B,H;return g.w(function(n){if(n.X==1)return g.v(n,Mm(),2);if(n.X!=3)return(l=n.Z)?g.v(n,Yj(l,"downloadStatusEntity"),3):n.return([]);y=n.Z;f=[];A=g.u(y);for(K=A.next();!K.done;K=A.next())G=K.value,G.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&G.key&&(B=g.qU(G.key).entityId,f.push(B));return f.length?(H={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},n.return(gK(R,f,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
H))):n.return([])})};
g.L.o3=function(){var R;return g.w(function(l){return l.X==1?g.v(l,Mm(),2):(R=l.Z)?g.v(l,Ct(R,{mode:"readwrite",CA:!0},function(y){return kj(y,"mainVideoEntity").then(function(f){var A=[];f=g.u(f);for(var K=f.next();!K.done;K=f.next()){K=K.value;var G=void 0;(G=K.userState)!=null&&G.playbackPosition||(G=g.qU(K.key).entityId,G={key:g.tx(G,"videoPlaybackPositionEntity"),videoId:G,lastPlaybackPositionSeconds:"0"},A.push(ZO(y,G,"videoPlaybackPositionEntity")),K.userState={playbackPosition:G.key},A.push(ZO(y,
K,"mainVideoEntity")))}return g.ud.all(A)})}),0):l.return()})};
g.L.IC=function(){var R,l,y,f,A,K,G,B,H,n,m,h,c,E,W,Q,e,r,d,z,N,D,t,C,Ac,Bi,ar,nk,Y,Pi,wq,Rt,pX,O5,pk,tK,c8,DU;return g.w(function(lN){if(lN.X==1)return g.v(lN,Mm(),2);if(lN.X!=3){R=lN.Z;if(!R)return lN.return();l=g.tx("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.v(lN,Ct(R,{mode:"readonly",CA:!0},function(T){return g.ud.all([js(T,l,"mainDownloadsListEntity"),js(T,g.Um,"mainDownloadsListEntity"),kj(T,"mainVideoEntity"),kj(T,"mainPlaylistEntity")])}),3)}y=lN.Z;
f=g.u(y);A=f.next().value;K=f.next().value;G=f.next().value;B=f.next().value;H=A;n=K;m=G;h=B;c=new Set;if((E=H)==null?0:(W=E.downloads)==null?0:W.length)for(Q=g.u(H.downloads),e=Q.next();!e.done;e=Q.next())r=e.value,d=void 0,(z=(d=r.videoItem)!=null?d:r.playlistItem)&&c.add(z);if((N=n)==null?0:(D=N.downloads)==null?0:D.length)for(t=g.u(n.downloads),C=t.next();!C.done;C=t.next())Ac=C.value,Ac.videoItem&&c.add(Ac.videoItem);Bi=new Set;ar=[];nk=g.u(h);for(Y=nk.next();!Y.done;Y=nk.next()){Pi=Y.value;
if(Pi.videos)for(wq=g.u(Pi.videos),Rt=wq.next();!Rt.done;Rt=wq.next())pX=Rt.value,(O5=JSON.parse(g.qU(pX).entityId).videoId)&&Bi.add(O5);Pi.key&&!c.has(Pi.key)&&ar.push(Pi.key)}pk=g.u(m);for(tK=pk.next();!tK.done;tK=pk.next())c8=tK.value,c8.key&&!c.has(c8.key)&&(DU=g.qU(c8.key).entityId,Bi.has(DU)||ar.push(c8.key));return ar.length?g.v(lN,dl8(R,ar),0):lN.bQ(0)})};g.O(txr,rK);txr.prototype.X=function(R){return Hj(R)?MxU(this,R):nB(R)?RRO(this,R):m4(R)?leU(this,R):Promise.reject(Error("Unsupported action type: "+R.actionType))};
var q8=[10];g.O(feK,rK);feK.prototype.X=function(R){return Hj(R)?K85(this,R):nB(R)?GDK(this,R):m4(R)?aeS(this,R):Promise.reject(Error("Unsupported action type: "+R.actionType))};
var tm=[10];g.O(HEr,rK);HEr.prototype.X=function(R){return Hj(R)?hRr(this,R):nB(R)?cZU(this,R):m4(R)?EOS(this,R):Promise.reject(Error("Unsupported action type: "+R.actionType))};
var oOA=[10];g.O(Yp,Jm);Yp.prototype.Lj=function(R){var l=Jm.prototype.Lj.call(this,R);l.musicTrack=new HEr(R,this.Z);l.musicPlaylist=new feK(R,this.Z);l.musicAlbumRelease=new txr(R,this.Z);return l};
Yp.prototype.refreshAllStaleEntities=function(R,l){var y=this,f,A,K;return g.w(function(G){if(G.X==1)return g.v(G,L8U(y,R,l),2);if(G.X!=3)return A=f=G.Z,K=A.concat,g.v(G,Jm.prototype.refreshAllStaleEntities.call(y,R,l),3);f=K.call(A,G.Z);return G.return(f)})};g.O(OEO,g.Fc);g.L=OEO.prototype;g.L.create=function(){var R=this;g.U(this,this.events);if(g.Hm(this.Zq))this.Z=new VxK(this.Zq,this.player);else if(g.xi(this.Zq)||g.mQ(this.Zq))this.Z=new Yp(this.Zq,this.player);this.events.N(this.player,"onPlaybackStartExternal",function(){R.Ou()});
this.events.N(this.player,"videodatachange",function(){R.Ou()});
this.Zq.C("html5_offline_playback_position_sync")&&this.events.N(this.player,"presentingplayerstatechange",this.PL)};
g.L.Km=function(){return!1};
g.L.W5=function(R,l,y,f){var A=this;return g.w(function(K){return A.Z?K.return(gK(A.Z,R,l,y,f)):K.return(Promise.reject())})};
g.L.deleteAll=function(){return this.Z.deleteAll()};
g.L.ZC=function(R){return this.Z.ZC(R)};
g.L.refreshAllStaleEntities=function(R){return this.Z.refreshAllStaleEntities(R)};
g.L.setUpPositionSyncInterval=function(R){this.Z.setUpPositionSyncInterval(R)};
g.L.Uf=function(R){this.Z.Uf(R)};
g.L.N1=function(R){return this.Z.N1(R)};
g.L.Ou=function(){var R=this,l;return g.w(function(y){l=R.player.getVideoData();return g.KM(l)?iEt(l)&&R.X!==l.clientPlaybackNonce?g.v(y,P85(R,l),0):y.bQ(0):y.return()})};
g.L.PL=function(R){var l=this,y,f,A,K,G,B,H;return g.w(function(n){if(n.X==1)return y=l.player.getVideoData(),f=y.OF,g.m2(R,2)||g.m2(R,512)?g.v(n,Mm(),2):n.return();if(n.X!=3){A=n.Z;if(!A)return fB("PES is undefined"),n.return();K=y.videoId;return g.v(n,t3(A,g.tx(K,"mainVideoEntity"),"mainVideoEntity"),3)}G=n.Z;if(!G)return n.return();B=Math.floor(f).toString();H={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:B}};return g.v(n,l.W5([K],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
H),0)})};
g.L.isOrchestrationLeader=function(){return this.Z.isOrchestrationLeader()};
g.L.updateDownloadState=function(R,l){var y,f,A,K;return g.w(function(G){if(G.X==1)return g.v(G,Mm(),2);y=G.Z;if(!y)return fB("PES is undefined"),G.return();f=g.qU(R);A=f.entityType;K=f.entityId;return g.v(G,o5(K,A,y,l,!0),0)})};g.uR("offline",OEO);})(_yt_player);
